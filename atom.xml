<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[ç™½é©¼å±±åº„]]></title>
  <link href="https://chenrenyi.github.io/atom.xml" rel="self"/>
  <link href="https://chenrenyi.github.io/"/>
  <updated>2020-08-23T21:54:59+08:00</updated>
  <id>https://chenrenyi.github.io/</id>
  <author>
    <name><![CDATA[]]></name>
    
  </author>
  <generator uri="http://www.mweb.im">MWeb</generator>

  
  <entry>
    <title type="html"><![CDATA[åˆ†å¸ƒå¼]]></title>
    <link href="https://chenrenyi.github.io/15981744394317.html"/>
    <updated>2020-08-23T17:20:39+08:00</updated>
    <id>https://chenrenyi.github.io/15981744394317.html</id>
    <content type="html"><![CDATA[
<h2 id="toc_0">åˆ†å¸ƒå¼é”</h2>

<h3 id="toc_1">Reidsåˆ†å¸ƒå¼é”</h3>

<pre><code class="language-java">public class RedisTool {

    private static final String LOCK_SUCCESS = &quot;OK&quot;;
    private static final String SET_IF_NOT_EXIST = &quot;NX&quot;;
    private static final String SET_WITH_EXPIRE_TIME = &quot;PX&quot;;

    /**
     * å°è¯•è·å–åˆ†å¸ƒå¼é”
     * @param jedis Rediså®¢æˆ·ç«¯
     * @param lockKey é”
     * @param requestId è¯·æ±‚æ ‡è¯†
     * @param expireTime è¶…æœŸæ—¶é—´
     * @return æ˜¯å¦è·å–æˆåŠŸ
     */
    public static boolean tryGetDistributedLock(Jedis jedis, String lockKey, String requestId, int expireTime) {

        String result = jedis.set(lockKey, requestId, SET_IF_NOT_EXIST, SET_WITH_EXPIRE_TIME, expireTime);

        if (LOCK_SUCCESS.equals(result)) {
            return true;
        }
        return false;

    }

    /**
     * é‡Šæ”¾åˆ†å¸ƒå¼é”
     * @param jedis Rediså®¢æˆ·ç«¯
     * @param lockKey é”
     * @param requestId è¯·æ±‚æ ‡è¯†
     * @return æ˜¯å¦é‡Šæ”¾æˆåŠŸ
     */
    public static boolean releaseDistributedLock(Jedis jedis, String lockKey, String requestId) {

        String script = &quot;if redis.call(&#39;get&#39;, KEYS[1]) == ARGV[1] then return redis.call(&#39;del&#39;, KEYS[1]) else return 0 end&quot;;
        Object result = jedis.eval(script, Collections.singletonList(lockKey), Collections.singletonList(requestId));

        if (RELEASE_SUCCESS.equals(result)) {
            return true;
        }
        return false;

    }
}    
</code></pre>
<br>
<p><strong>ä¸ºä½•éœ€è¦requestId</strong></p>

<ul>
<li>çº¿ç¨‹1æ‰§è¡Œé€»è¾‘ä¸ºï¼šåŠ é”ã€æ‰§è¡Œé€»è¾‘ã€è§£é”</li>
<li>è‹¥çº¿ç¨‹1æ‰§è¡Œé€»è¾‘æ—¶é—´ï¼Œè¶…è¿‡é”æœ‰æ•ˆæœŸï¼Œåˆ™è§£é”æ—¶æœ‰å¯èƒ½è§£é™¤äº†åˆ«äººçš„é”</li>
</ul>

<p><strong>ç¼ºç‚¹</strong></p>

<ul>
<li>Redis ä¸»ä»å¤åˆ¶æ˜¯å¼‚æ­¥çš„ï¼Œä¸»æŒ‚æ‰åˆ‡æ¢ä¸»åï¼Œå¯èƒ½æœ‰éƒ¨åˆ†æ•°æ®ä¸¢å¤±ï¼Œå¯¼è‡´é”ä¸¢å¤±</li>
</ul>

<h3 id="toc_2">æ•°æ®åº“åˆ†å¸ƒå¼é”</h3>

<ul>
<li>select for update</li>
<li>å”¯ä¸€ç´¢å¼•</li>
<li>ç‰ˆæœ¬å·</li>
</ul>

<h3 id="toc_3">Zookeeperåˆ†å¸ƒå¼é”</h3>

<ul>
<li>åˆ›å»ºä¸´æ—¶æœ‰åºèŠ‚ç‚¹æ¥åˆ›å»ºé”</li>
<li>è·å–æ‰€æœ‰èŠ‚ç‚¹ï¼Œåˆ¤æ–­åºå·æ˜¯å¦æœ€å°æ¥åˆ¤æ–­æ˜¯å¦æœ‰é”</li>
<li>ç›‘å¬ä¸Šä¸€èŠ‚ç‚¹æ¥å®ç°ç­‰å¾…é”</li>
</ul>

<p><strong>ç¼ºç‚¹</strong></p>

<ul>
<li>åˆ›å»ºä¸´æ—¶é”çš„ç›®çš„ï¼Œæ˜¯é˜²æ­¢ç¨‹åºæŒ‚æ‰æ— æ³•é‡Šæ”¾é”</li>
<li>ä¹Ÿå¯èƒ½å› ä¸ºç½‘ç»œæ•…éšœè€Œé”™è¯¯é‡Šæ”¾é”</li>
</ul>

<h2 id="toc_4">åˆ†å¸ƒå¼äº‹åŠ¡</h2>

<h3 id="toc_5">ä¸¤é˜¶æ®µæäº¤åè®®</h3>

<p>å•†ä¸šæ•°æ®åº“è‡ªå¸¦</p>

<p>è¿‡ç¨‹ï¼š<br/>
<img src="media/15981744394317/15981925713829.jpg" alt=""/><br/>
<img src="media/15981744394317/15981925853892.jpg" alt=""/></p>

<h3 id="toc_6">ä¸‰é˜¶æ®µæäº¤</h3>

<p><img src="media/15981744394317/15981926125149.jpg" alt=""/></p>

<p><img src="media/15981744394317/15981926185170.jpg" alt=""/></p>

<h3 id="toc_7">MQäº‹åŠ¡</h3>

<p><img src="media/15981744394317/15981778819286.jpg" alt=""/></p>

<h2 id="toc_8">è´Ÿè½½å‡è¡¡</h2>

<h3 id="toc_9">ç®—æ³•</h3>

<ul>
<li>è½®è¯¢</li>
<li>åŠ æƒè½®è¯¢</li>
<li>éšæœº</li>
<li>æœ€å°‘è¿æ¥</li>
<li>åŠ æƒæœ€å°è¿æ¥</li>
</ul>

<h3 id="toc_10">å®ç°</h3>

<ul>
<li>DNS è§£æ</li>
<li>ä¿®æ”¹ Macåœ°å€</li>
<li>ä¿®æ”¹ IP åœ°å€</li>
<li>Http é‡å®šå‘</li>
<li>Nginx åå‘ä»£ç†</li>
</ul>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[è¿ç»´ç›¸å…³]]></title>
    <link href="https://chenrenyi.github.io/15981529091955.html"/>
    <updated>2020-08-23T11:21:49+08:00</updated>
    <id>https://chenrenyi.github.io/15981529091955.html</id>
    <content type="html"><![CDATA[
<h2 id="toc_0">å‘å¸ƒç­–ç•¥</h2>

<ul>
<li>è“ç»¿éƒ¨ç½²
<ul>
<li>éƒ¨ç½²ä¸€å¥—å®ä¾‹æ•°å®Œå…¨ç›¸åŒçš„æ–°ç‰ˆæœ¬</li>
</ul></li>
<li>æ»šåŠ¨éƒ¨ç½²
<ul>
<li>å‘å¸ƒä¸€å®šæ¯”ä¾‹çš„æ–°ç‰ˆæœ¬ï¼Œå…³é—­è€ç‰ˆæœ¬ã€‚ç›´è‡³å®Œå…¨åˆ‡æ¢</li>
</ul></li>
<li>ç°åº¦å‘å¸ƒ/é‡‘ä¸é›€å‘å¸ƒ
<ul>
<li>å¯¹åº”ABTestï¼Œå…ˆå‘å¸ƒä¸€éƒ¨åˆ†åˆ°çº¿ä¸Šï¼Œè§‚å¯Ÿæ— é—®é¢˜ååˆ‡æ¢</li>
</ul></li>
</ul>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[ç½‘ç»œ]]></title>
    <link href="https://chenrenyi.github.io/15981528120452.html"/>
    <updated>2020-08-23T11:20:12+08:00</updated>
    <id>https://chenrenyi.github.io/15981528120452.html</id>
    <content type="html"><![CDATA[
<h2 id="toc_0">ç½‘ç»œåˆ†å±‚æ¨¡å‹</h2>

<p><img src="media/15981528120452/15981528491746.jpg" alt=""/></p>

<p><img src="media/15981528120452/15981528604902.jpg" alt=""/></p>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[LRUï¼ˆlast recent usedï¼‰]]></title>
    <link href="https://chenrenyi.github.io/15981504896199.html"/>
    <updated>2020-08-23T10:41:29+08:00</updated>
    <id>https://chenrenyi.github.io/15981504896199.html</id>
    <content type="html"><![CDATA[
<pre><code class="language-java">package fighting.algorithm.project;

import java.util.HashMap;
import java.util.Map;

/**
 * LRUï¼šå³last recent usedï¼Œæœ€è¿‘ä½¿ç”¨çš„é˜Ÿåˆ—
 * &lt;p&gt;
 * ä½œç”¨ï¼š
 * ç”¨äºç¼“å­˜ï¼Œå½“å†…å­˜æ»¡æ—¶ï¼Œåˆ é™¤æœ€è¿‘æœªä½¿ç”¨çš„å…ƒç´ 
 * &lt;p&gt;
 * æ“ä½œï¼š
 * put(k, v)ï¼šæ’å…¥å…ƒç´ ï¼Œå½“å†…å­˜æ»¡æ—¶éœ€è¦å…ˆåšæ¸…é™¤ã€‚æ»¡è¶³O(1)å¤æ‚åº¦
 * get(k)ï¼šè·å–ï¼ŒåŒæ—¶è®¾ä¸ºæœ€è¿‘ä½¿ç”¨ã€‚æ»¡è¶³O(1)å¤æ‚åº¦
 * &lt;p&gt;
 * åˆ†æï¼š
 * æœ€è¿‘ä½¿ç”¨å…³ç³»ï¼Œå¯ä½¿ç”¨å…ƒç´ é¡ºåºæ¥è¡¨ç¤ºï¼Œå³é˜Ÿå¤´æ˜¯æœ€è¿‘ä½¿ç”¨çš„ï¼Œé˜Ÿå°¾çš„æ˜¯æœ€åä½¿ç”¨çš„
 * éœ€è¦æ»¡è¶³å¿«é€ŸæŸ¥è¯¢ï¼šå“ˆå¸Œè¡¨
 * æ»¡è¶³å…ƒç´ é¡ºåºï¼šé“¾è¡¨
 * &lt;p&gt;
 * ç»“è®ºï¼š
 * ä½¿ç”¨åŒå‘é“¾è¡¨ä½œä¸ºåŸºç¡€ï¼Œæœ€è¿‘ä½¿ç”¨çš„ç§»åˆ°é˜Ÿå¤´ï¼Œå†…å­˜ä¸è¶³æ—¶åˆ é™¤é˜Ÿå°¾çš„ã€‚åŒå‘çš„ç›®çš„æ˜¯åšO(1)åˆ é™¤
 * ç”¨å“ˆå¸Œè¡¨æ¥åŠ é€ŸæŸ¥è¯¢
 */
public class LRU {

    private Map&lt;Integer, Node&gt; map;

    private DoubleLinkedList doubleLinkedList;

    private int maxSize;

    private int size;

    public LRU(int maxSize) {
        this.maxSize = maxSize;
        doubleLinkedList = new DoubleLinkedList();
        map = new HashMap&lt;&gt;();
    }

    /**
     * æ·»åŠ å…ƒç´ å¹¶ç§»åˆ°é˜Ÿå¤´
     * 1ã€å·²å­˜åœ¨
     * 2ã€å·²æ»¡
     * 3ã€æ³¨æ„ç§»åˆ°é˜Ÿå¤´å¹¶æ›´æ–°size
     */
    public void put(int k, int value) {
        if (map.containsKey(k)) {
            doubleLinkedList.remove(map.get(k));
        } else if (size == maxSize) {
            Node deletedNode = doubleLinkedList.removeLast();
            map.remove(deletedNode.key);
        } else {
            size++;
        }

        Node newNode = new Node(k, value);
        doubleLinkedList.addFirst(newNode);
        map.put(k, newNode);
    }

    /**
     * è·å–å…ƒç´ å¹¶ç§»åˆ°é˜Ÿå¤´
     */
    public int get(int key) {
        if (!map.containsKey(key)) {
            return -1;
        }
        Node node = map.get(key);
        doubleLinkedList.remove(node);
        doubleLinkedList.addFirst(node);
        return node.value;
    }

    public static void main(String[] args) {
        LRU lru = new LRU(3);
        lru.put(1, 1);
        lru.put(2, 2);
        lru.put(3, 3);
        lru.put(4, 4);
        lru.doubleLinkedList.print();

        System.out.println(lru.get(2));
        lru.put(5, 5);
        lru.doubleLinkedList.print();
    }

    public static void doubleLinkedListTest() {
        Node node1 = new Node(1, 1);
        Node node2 = new Node(2, 2);
        Node node3 = new Node(3, 3);
        Node node4 = new Node(4, 4);

        DoubleLinkedList linkedList = new DoubleLinkedList();
        linkedList.addFirst(node4);
        linkedList.addFirst(node3);
        linkedList.addFirst(node2);
        linkedList.addFirst(node1);

        linkedList.print();
        linkedList.removeLast();
        linkedList.remove(node1);
        linkedList.print();
        linkedList.remove(node2);
        linkedList.removeLast();
        linkedList.print();
    }
}

/**
 * é“¾è¡¨èŠ‚ç‚¹
 */
class Node {
    public int key, value;
    public Node prev, next;

    public Node(int key, int value) {
        this.key = key;
        this.value = value;
    }
}

/**
 * åŒå‘é“¾è¡¨
 * æ³¨æ„sizeä¸º0ï¼ˆç©ºé˜Ÿåˆ—ï¼‰ï¼Œsizeä¸º1ï¼ˆå¤´å°¾ç›¸åŒï¼‰çš„æƒ…å†µ
 * æ³¨æ„å¯¹sizeåšåŠ å‡æ“ä½œ
 */
class DoubleLinkedList {
    private Node head, tail;
    private int size;

    /**
     * æ·»åŠ åˆ°é˜Ÿå¤´
     */
    public void addFirst(Node node) {
        if (size == 0) {
            head = tail = node;
            node.prev = node.next = null;
            size++;
            return;
        }

        node.next = head;
        head.prev = node;
        head = node;
        size++;
    }

    /**
     * ç§»é™¤ç»™å®šå…ƒç´ 
     */
    public void remove(Node node) {
        if (node == tail) {
            removeLast();
            return;
        }

        size--;
        if (head == node) {
            head = node.next;
            return;
        }

        node.prev.next = node.next;
    }

    /**
     * ç§»é™¤æœ€åä¸€ä¸ªå…ƒç´ 
     */
    public Node removeLast() {
        if (size == 0) {
            return null;
        }

        if (size == 1) {
            Node last = tail;
            head = tail = null;
            size = 0;
            return last;
        }

        Node last = tail;
        Node secondLast = tail.prev;
        secondLast.next = null;
        tail = secondLast;
        size--;
        return last;
    }

    public void print() {
        Node node = head;
        System.out.println();
        while (node != null) {
            System.out.println(node.value);
            node = node.next;
        }
        System.out.println();
    }
}

</code></pre>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[è¡¨è¾¾å¼æ±‚å€¼]]></title>
    <link href="https://chenrenyi.github.io/15981499416448.html"/>
    <updated>2020-08-23T10:32:21+08:00</updated>
    <id>https://chenrenyi.github.io/15981499416448.html</id>
    <content type="html"><![CDATA[
<p>é¢˜ç›®ï¼š<br/>
<a href="https://leetcode-cn.com/problems/basic-calculator-ii/">https://leetcode-cn.com/problems/basic-calculator-ii/</a></p>

<pre><code class="language-java">class Solution {
     public int calculate(String s) {
        LinkedList&lt;Integer&gt; integers = new LinkedList&lt;&gt;();
        LinkedList&lt;Character&gt; ops = new LinkedList&lt;&gt;();

        for (int i = 0; i &lt; s.length(); i++) {
            char c = s.charAt(i);
            if (c == &#39; &#39;) {
                continue;
            }
            if (!Character.isDigit(c)) {
                ops.push(c);
                continue;
            }
            int number = c - &#39;0&#39;;
            while (i + 1 &lt; s.length() &amp;&amp; Character.isDigit(s.charAt(i + 1))) {
                i++;
                number = number * 10 + s.charAt(i) - &#39;0&#39;;
            }

            if (!ops.isEmpty()) {
                char lastOp = ops.peek();
                if (lastOp == &#39;*&#39;) {
                    ops.pop();
                    integers.push(integers.pop() * number);
                    continue;
                } else if (lastOp == &#39;/&#39;) {
                    ops.pop();
                    integers.push(integers.pop() / number);
                    continue;
                }
            }
            integers.push(number);
        }

        int res = integers.removeLast();
        while (!ops.isEmpty()) {
            char lastOp = ops.removeLast();
            if (lastOp == &#39;+&#39;) {
                res += integers.removeLast();
            } else {
                res -= integers.removeLast();
            }
        }
        return res;
    }
}
</code></pre>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[BFSï¼ˆå¹¿åº¦ä¼˜å…ˆæœç´¢ï¼‰é—®é¢˜]]></title>
    <link href="https://chenrenyi.github.io/15981493832715.html"/>
    <updated>2020-08-23T10:23:03+08:00</updated>
    <id>https://chenrenyi.github.io/15981493832715.html</id>
    <content type="html"><![CDATA[
<h2 id="toc_0">æ¡†æ¶</h2>

<pre><code class="language-cpp">// è®¡ç®—ä»èµ·ç‚¹ start åˆ°ç»ˆç‚¹ target çš„æœ€è¿‘è·ç¦»
int BFS(Node start, Node target) {
    Queue&lt;Node&gt; q; // æ ¸å¿ƒæ•°æ®ç»“æ„
    Set&lt;Node&gt; visited; // é¿å…èµ°å›å¤´è·¯

    q.offer(start); // å°†èµ·ç‚¹åŠ å…¥é˜Ÿåˆ—
    visited.add(start);
    int step = 0; // è®°å½•æ‰©æ•£çš„æ­¥æ•°

    while (q not empty) {
        int sz = q.size();
        /* å°†å½“å‰é˜Ÿåˆ—ä¸­çš„æ‰€æœ‰èŠ‚ç‚¹å‘å››å‘¨æ‰©æ•£ */
        for (int i = 0; i &lt; sz; i++) {
            Node cur = q.poll();
            /* åˆ’é‡ç‚¹ï¼šè¿™é‡Œåˆ¤æ–­æ˜¯å¦åˆ°è¾¾ç»ˆç‚¹ */
            if (cur is target)
                return step;
            /* å°† cur çš„ç›¸é‚»èŠ‚ç‚¹åŠ å…¥é˜Ÿåˆ— */
            for (Node x : cur.adj())
                if (x not in visited) {
                    q.offer(x);
                    visited.add(x);
                }
        }
        /* åˆ’é‡ç‚¹ï¼šæ›´æ–°æ­¥æ•°åœ¨è¿™é‡Œ */
        step++;
    }
}
</code></pre>

<h2 id="toc_1">äºŒå‰æ ‘çš„æœ€å°æ·±åº¦</h2>

<p>é¢˜ç›®ï¼š<br/>
<a href="https://leetcode-cn.com/problems/minimum-depth-of-binary-tree/">https://leetcode-cn.com/problems/minimum-depth-of-binary-tree/</a></p>

<pre><code class="language-java">/**
 * Definition for a binary tree node.
 * public class TreeNode {
 *     int val;
 *     TreeNode left;
 *     TreeNode right;
 *     TreeNode(int x) { val = x; }
 * }
 */
class Solution {
    // é€’å½’ç‰ˆæœ¬
    int min2(TreeNode root) {
        if(root == null) return 0;
        int left = min2(root.left);
        int right = min2(root.right);
        if(left != 0 &amp;&amp; right != 0) {
            return 1 + Math.min(left, right);
        } else {
            return 1 + left + right;
        }
    }

    public int minDepth(TreeNode root) {
        return min2(root);
    }

    // éé€’å½’ç‰ˆæœ¬
    public int minDepth2(TreeNode root) {
        if(root == null) {
            return 0;
        }
        LinkedList&lt;TreeNode&gt; list = new LinkedList&lt;&gt;();
        LinkedList&lt;TreeNode&gt; nextList = new LinkedList&lt;&gt;();
        int depth = 1;
        list.add(root);
        while(true) {
            if(list.isEmpty()) {
                if(nextList.isEmpty()) break;
                depth++;
                list = nextList;
                nextList = new LinkedList();
            }
            TreeNode node = list.removeFirst();
            if(node == null) {
                continue;
            }
            if(node.left == null &amp;&amp; node.right == null) {
                break;
            }
            nextList.add(node.left);
            nextList.add(node.right);
        }

        return depth;
    }
}
</code></pre>

<h2 id="toc_2">è½¬ç›˜é”</h2>

<p>é¢˜ç›®ï¼š<br/>
<a href="https://leetcode-cn.com/problems/open-the-lock/">https://leetcode-cn.com/problems/open-the-lock/</a></p>

<pre><code class="language-java">class Solution {

    List&lt;Character&gt; nums;
    
    public int openLock(String[] deadLocks, String target) {
        nums = Arrays.asList(&#39;0&#39;, &#39;1&#39;, &#39;2&#39;, &#39;3&#39;, &#39;4&#39;, &#39;5&#39;, &#39;6&#39;, &#39;7&#39;, &#39;8&#39;, &#39;9&#39;);
        List&lt;String&gt; deadLockList = Arrays.asList(deadLocks);

        Set&lt;String&gt; list = new HashSet&lt;&gt;();
        Set&lt;String&gt; list2 = new HashSet&lt;&gt;();
        list.add(&quot;0000&quot;);
        list2.add(target);
        Set&lt;String&gt; visited = new HashSet&lt;&gt;(list);

        if (deadLockList.contains(target) || deadLockList.contains(&quot;0000&quot;)) {
            return -1;
        }

        visited.addAll(deadLockList);
        int step = 0;
        while (!list.isEmpty()) {
            Set&lt;String&gt; tmp = new HashSet&lt;&gt;(list);
            for (String lock : tmp) {
                list.remove(lock);
                if (list2.contains(lock)) {
                    return step;
                }
                visited.add(lock);

                LinkedList&lt;String&gt; nextLocks = getNextLocks(lock);
                for (String nextLock : nextLocks) {
                    if (visited.contains(nextLock)) {
                        continue;
                    }
                    list.add(nextLock);
                }
            }
            step++;
            Set&lt;String&gt; swap = list;
            list = list2;
            list2 = swap;
        }

        return -1;
    }

    LinkedList&lt;String&gt; getNextLocks(String lock) {
        LinkedList&lt;String&gt; nextLocks = new LinkedList&lt;&gt;();
        for (int i = 0; i &lt; lock.length(); i++) {
            StringBuilder newLock = new StringBuilder(lock);
            int index = nums.indexOf(newLock.charAt(i));
            char nextChar = nums.get((index + 10 + 1) % 10);
            newLock.replace(i, i + 1, String.valueOf(nextChar));
            nextLocks.add(newLock.toString());

            nextChar = nums.get((index + 10 - 1) % 10);
            newLock.replace(i, i + 1, String.valueOf(nextChar));
            nextLocks.add(newLock.toString());
        }
        return nextLocks;
    }

}
</code></pre>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[åŠ¨æ€è§„åˆ™ç¬”è®°]]></title>
    <link href="https://chenrenyi.github.io/15981488069038.html"/>
    <updated>2020-08-23T10:13:26+08:00</updated>
    <id>https://chenrenyi.github.io/15981488069038.html</id>
    <content type="html"><![CDATA[
<h2 id="toc_0">æ¡†æ¶</h2>

<pre><code class="language-text"># åˆå§‹åŒ– base case
dp[0][0][...] = base
# è¿›è¡ŒçŠ¶æ€è½¬ç§»
for çŠ¶æ€1 in çŠ¶æ€1çš„æ‰€æœ‰å–å€¼ï¼š
    for çŠ¶æ€2 in çŠ¶æ€2çš„æ‰€æœ‰å–å€¼ï¼š
        for ...
            dp[çŠ¶æ€1][çŠ¶æ€2][...] = æ±‚æœ€å€¼(é€‰æ‹©1ï¼Œé€‰æ‹©2...)
</code></pre>

<h2 id="toc_1">æ–æ³¢é‚£å¥‘æ•°</h2>

<pre><code class="language-java">class Solution {

    public int fib(int n) {
        if(n == 0 || n==1) {
            return n;
        }
        int answer = 0;
        int last = 1;
        int last_last = 0;
        for(int i=2; i&lt;=n; i++) {
            answer = last + last_last;
            last_last = last;
            last = answer;
        }
        return answer;
    }
}
</code></pre>

<h2 id="toc_2">é›¶é’±å…‘æ¢</h2>

<pre><code class="language-text">é¢˜ç›®ï¼š
ç»™å®šä¸åŒé¢é¢çš„ç¡¬å¸ coins å’Œä¸€ä¸ªæ€»é‡‘é¢ amountã€‚
ç¼–å†™ä¸€ä¸ªå‡½æ•°æ¥è®¡ç®—å¯ä»¥å‡‘æˆæ€»é‡‘é¢æ‰€éœ€çš„æœ€å°‘çš„ç¡¬å¸ä¸ªæ•°ã€‚
å¦‚æœæ²¡æœ‰ä»»ä½•ä¸€ç§ç¡¬å¸ç»„åˆèƒ½ç»„æˆæ€»é‡‘é¢ï¼Œè¿”å›Â -1ã€‚
</code></pre>

<pre><code class="language-java">class Solution {
    Map&lt;Integer, Integer&gt; map = new HashMap&lt;&gt;();


    // éé€’å½’ç‰ˆæœ¬
    public int coinChange(int[] coins, int amount) {
        if(amount == 0) {
            return 0;
        }
        int[] arr = new int[amount + 1];
        for(int i=1; i&lt;arr.length; i++) {
            arr[i] = -1;
        }
        for(int coin: coins) {
            if(coin &lt; arr.length) arr[coin] = 1;
        }
        for(int i=1; i&lt;=amount; i++) {
            if(arr[i] != -1) continue;
            int min = i;
            boolean hasAnawer = false;
            for(int coin: coins) {
                if(i-coin &lt; 0) continue;
                if(arr[i-coin] == -1) continue;
                min = Math.min(min, arr[i-coin] + 1);
                hasAnawer = true;
            }
            if(hasAnawer) arr[i] = min;
        }
        return arr[amount];
    }

    // é€’å½’ç‰ˆæœ¬
    public int coinChange2(int[] coins, int amount) {
        if(map.containsKey(amount)) return map.get(amount);

        if(amount == 0) {
            map.put(amount, 0);
            return 0;
        }

        if(amount &lt; 0) {
            map.put(amount, -1);
            return -1;
        }

        int min = amount;
        boolean hasAnawer = false;
        for(int coin : coins) {
            if(amount - coin &lt; 0) continue;
            int subAnswer = coinChange(coins, amount - coin);
            if (subAnswer == -1) continue;
            min = Math.min(min, subAnswer + 1);
            hasAnawer = true;
        }
        if (!hasAnawer) min = -1;
        map.put(amount, min);
        return min;
    }
}
</code></pre>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[å›æº¯ç®—æ³•]]></title>
    <link href="https://chenrenyi.github.io/15924514980743.html"/>
    <updated>2020-06-18T11:38:18+08:00</updated>
    <id>https://chenrenyi.github.io/15924514980743.html</id>
    <content type="html"><![CDATA[
<h2 id="toc_0">æ¡†æ¶</h2>

<pre><code class="language-text">å›æº¯é—®é¢˜ç®—æ³•æ¡†æ¶
result = []
def backtrack(è·¯å¾„, é€‰æ‹©åˆ—è¡¨):
    if æ»¡è¶³ç»“æŸæ¡ä»¶:
        result.add(è·¯å¾„)
        return

    for é€‰æ‹© in é€‰æ‹©åˆ—è¡¨:
        åšé€‰æ‹©
        backtrack(è·¯å¾„, é€‰æ‹©åˆ—è¡¨)
        æ’¤é”€é€‰æ‹©
</code></pre>

<h2 id="toc_1">å…¨æ’åˆ—é—®é¢˜</h2>

<pre><code class="language-java">package fighting.algorithm.backtrack;

import java.util.ArrayList;
import java.util.LinkedList;
import java.util.List;

/**
 * å…¨æ’åˆ—é—®é¢˜
 */
public class Sequence {

    public static int answer_num = 0;

    /**
     * å›æº¯
     *
     * @param numbers ç”¨äºæ’åˆ—çš„æ•°å­—
     * @param track   è·¯å¾„
     */
    public static void backtrack(List&lt;Integer&gt; numbers, LinkedList&lt;Integer&gt; track) {
        if (numbers.size() == track.size()) {
            System.out.println(track);
            answer_num++;
            return;
        }

        for (int i : numbers) {
            // å¦‚æœè¯¥æ•°å·²åœ¨è·¯å¾„ä¸­ï¼Œå¿½ç•¥
            if (track.contains(i)) {
                continue;
            }
            // åšé€‰æ‹©
            track.add(i);
            // é€’å½’è¿›å…¥ä¹‹åçš„é€‰æ‹©
            backtrack(numbers, track);
            // æ’¤é”€é€‰æ‹©
            track.removeLast();
        }
    }

    /**
     * æµ‹è¯•
     */
    public static void main(String ars[]) {
        List&lt;Integer&gt; numbers = new ArrayList&lt;&gt;();
        numbers.add(1);
        numbers.add(2);
        numbers.add(3);
        numbers.add(4);

        LinkedList&lt;Integer&gt; chooseList = new LinkedList&lt;&gt;();

        backtrack(numbers, chooseList);

        System.out.println(answer_num);
    }
}

</code></pre>

<h2 id="toc_2">Nçš‡åé—®é¢˜</h2>

<pre><code class="language-java">package fighting.algorithm.backtrack;

import java.util.ArrayList;
import java.util.Collections;
import java.util.List;

/**
 * Nçš‡åé—®é¢˜
 */
public class Queen {

    public static final int QUEEN_NUM = 8;

    public static List&lt;List&lt;List&lt;String&gt;&gt;&gt; results = new ArrayList&lt;&gt;();

    public static void queen(List&lt;List&lt;String&gt;&gt; board, int row) {
        if (row &gt;= QUEEN_NUM) {
            List&lt;List&lt;String&gt;&gt; boardCopy = initBoard();
            Collections.copy(boardCopy, board);
            results.add(boardCopy);
            return;
        }
        for (int column = 0; column &lt; QUEEN_NUM; column++) {
            if (isValid(board, row, column)) {
                board.get(row).set(column, &quot;Q&quot;);
                queen(board, row + 1);
                board.get(row).set(column, &quot;&quot;);
            }
        }
    }

    public static boolean isValid(List&lt;List&lt;String&gt;&gt; board, int row, int column) {
        // false if q exists in the same column
        for (int i = 0; i &lt; row; i++) {
            if (board.get(i).get(column).equals(&quot;Q&quot;)) {
                return false;
            }
        }

        for (int i = row - 1, j = column - 1; i &gt;= 0 &amp;&amp; j &gt;= 0; i--, j--) {
            if (board.get(i).get(j).equals(&quot;Q&quot;)) {
                return false;
            }
        }

        for (int i = row - 1, j = column + 1; i &gt;= 0 &amp;&amp; j &lt; QUEEN_NUM; i--, j++) {
            if (board.get(i).get(j).equals(&quot;Q&quot;)) {
                return false;
            }
        }

        return true;
    }

    public static List&lt;List&lt;String&gt;&gt; initBoard() {
        List&lt;List&lt;String&gt;&gt; board = new ArrayList&lt;&gt;();
        for (int i = 0; i &lt; QUEEN_NUM; i++) {
            board.add(new ArrayList&lt;&gt;());
            for (int j = 0; j &lt; QUEEN_NUM; j++) {
                board.get(i).add(&quot;&quot;);
            }
        }

        return board;
    }

    public static void printBoard(List&lt;List&lt;String&gt;&gt; board) {
        for (int i = 0; i &lt; QUEEN_NUM; i++) {
            for (int j = 0; j &lt; QUEEN_NUM; j++) {
                if (board.get(i).get(j).equals(&quot;Q&quot;)) {
                    System.out.print(&quot; â— &quot;);
                } else {
                    System.out.print(&quot; â—‹ &quot;);
                }
            }
            System.out.println();
        }
        System.out.println();
    }

    public static void main(String args[]) {
        List&lt;List&lt;String&gt;&gt; board = initBoard();
        queen(board, 0);

        System.out.println(results.size());
    }
}

</code></pre>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Zuul ç½‘å…³è®°å½•è¯·æ±‚å…¨ç”Ÿå‘½å‘¨æœŸæ—¥å¿—]]></title>
    <link href="https://chenrenyi.github.io/15913291441737.html"/>
    <updated>2020-06-05T11:52:24+08:00</updated>
    <id>https://chenrenyi.github.io/15913291441737.html</id>
    <content type="html"><![CDATA[
<p>å¾®æœåŠ¡æ¶æ„ä¸­ç½‘å…³æ˜¯æ‰€æœ‰å¯¹å¤–æä¾›æœåŠ¡çš„å…¥å£ï¼Œä¸€ä¸ªå¸¸è§çš„éœ€æ±‚æ˜¯å¯¹æ¯ä¸ªè¯·æ±‚è®°å½•è¯¦ç»†æ—¥å¿—ï¼ŒåŒ…æ‹¬urlã€methodã€headerã€request bodyã€response statusã€response bodyç­‰ï¼Œæ–¹ä¾¿é—®é¢˜æ’æŸ¥è€Œä¸ç”¨æ¯ä¸ªå†…éƒ¨æœåŠ¡å†åšä¸€å¥—æ—¥å¿—äº†ã€‚</p>

<p>ä»¥ä¸‹ä¸ºzuulæ¡†æ¶æ­å»ºçš„ç½‘å…³è®°å½•å…¨é“¾è·¯æ—¥å¿—çš„æ–¹æ³•ã€‚</p>

<h3 id="toc_0">æ€è·¯ä»‹ç»</h3>

<p>zuulæœ‰ä¸ªå¤„ç†ä»£ç†è¯·æ±‚å·¥å…·ç±»<code>ProxyRequestHelper</code>ï¼Œç”¨åœ¨å…³é”®çš„è¯·æ±‚è½¬å‘å¤„ç†ä¸Šã€‚å¹¶ä¸”å®˜æ–¹å¸¦ä¸€ä¸ªå­ç±»<code>TraceProxyRequestHelper</code>ï¼Œå…¶ä¸­è®°å½•äº†ä¸å°‘debugä¿¡æ¯å’Œä¸€äº›å…³é”®çš„é’©å­æ–¹æ³•ï¼ŒåŒ…æ‹¬æˆ‘ä»¬éœ€è¦çš„è¯·æ±‚æ•°æ®ã€è½¬å‘æ¨¡å¼ç­‰ã€‚å› æ­¤ç»§æ‰¿è¿™ä¸ªå­ç±»ï¼Œé‡å†™ä¸€äº›æ–¹æ³•å¹¶æŠŠéœ€è¦çš„ä¿¡æ¯ï¼Œå¯¼å‡ºæ¥å­˜æˆæ—¥å¿—å³okã€‚</p>

<h3 id="toc_1">æ­¥éª¤æºç </h3>

<p>1ã€å¦‚ä¸Šé¢æ€è·¯ä»‹ç»ï¼Œæ–°å»ºå­ç±»å¹¶ç»§æ‰¿<code>TraceProxyRequestHelper</code>ï¼Œå…·ä½“ä¸ºä»€ä¹ˆè¿™ä¹ˆæ”¹å¯ä»¥å‚è§æ³¨é‡Š</p>

<pre><code class="language-java">import com.netflix.zuul.context.RequestContext;
import com.netflix.zuul.util.HTTPRequestUtils;
import lombok.extern.slf4j.Slf4j;
import org.springframework.cloud.netflix.zuul.filters.TraceProxyRequestHelper;
import org.springframework.http.HttpHeaders;
import org.springframework.util.CollectionUtils;
import org.springframework.util.MultiValueMap;
import org.springframework.util.StreamUtils;
import org.springframework.util.StringUtils;

import java.io.ByteArrayInputStream;
import java.io.IOException;
import java.io.InputStream;
import java.io.InputStreamReader;
import java.nio.charset.StandardCharsets;
import java.util.ArrayList;
import java.util.HashMap;
import java.util.List;
import java.util.Map;

import static org.springframework.http.HttpHeaders.CONTENT_ENCODING;
import static org.springframework.http.HttpHeaders.CONTENT_LENGTH;

/**
 * ç»§æ‰¿zuulçš„å®ç°ï¼Œæ·»åŠ è°ƒè¯•æ—¥å¿—
 */
@Slf4j
public class MyTraceProxyRequestHelper extends TraceProxyRequestHelper {

    public static final String REQUEST_TRACE_DATA_KEY = &quot;MyRequestTraceData&quot;;

    public static final String RESPONSE_TRACE_DATA_KEY = &quot;MyResponseTraceData&quot;;

    /**
     * åœ¨è¿™é‡Œä¿å­˜ request çš„ç›¸å…³ä¿¡æ¯ä¾›ä¹‹åå¯¼å‡ºæ¥
     */
    @Override
    public Map&lt;String, Object&gt; debug(String verb, String uri, MultiValueMap&lt;String, String&gt; headers, MultiValueMap&lt;String, String&gt; params, InputStream requestEntity) throws IOException {
        Map&lt;String, Object&gt; result = super.debug(verb, uri, headers, params, requestEntity);
        RequestContext.getCurrentContext().getRequest().setAttribute(REQUEST_TRACE_DATA_KEY, result);
        return result;
    }

    /**
     * åœ¨è¿™é‡Œä¿å­˜ response çš„ç›¸å…³ä¿¡æ¯ä¾›ä¹‹åå¯¼å‡ºæ¥
     * å¤§éƒ¨åˆ†ä»£ç å¤åˆ¶è‡ªçˆ¶ç±»
     */
    @Override
    public void setResponse(int status, InputStream entity, MultiValueMap&lt;String, String&gt; headers) throws IOException {
        RequestContext context = RequestContext.getCurrentContext();
        context.setResponseStatusCode(status);

        // è®°å½•responseæ—¥å¿—
        debugResponse(status, entity, headers);

        HttpHeaders httpHeaders = new HttpHeaders();
        for (Map.Entry&lt;String, List&lt;String&gt;&gt; header : headers.entrySet()) {
            List&lt;String&gt; values = header.getValue();
            for (String value : values) {
                httpHeaders.add(header.getKey(), value);
            }
        }
        boolean isOriginResponseGzipped = false;
        if (httpHeaders.containsKey(CONTENT_ENCODING)) {
            List&lt;String&gt; collection = httpHeaders.get(CONTENT_ENCODING);
            for (String header : collection) {
                if (HTTPRequestUtils.getInstance().isGzipped(header)) {
                    isOriginResponseGzipped = true;
                    break;
                }
            }
        }
        context.setResponseGZipped(isOriginResponseGzipped);

        for (Map.Entry&lt;String, List&lt;String&gt;&gt; header : headers.entrySet()) {
            String name = header.getKey();
            for (String value : header.getValue()) {
                context.addOriginResponseHeader(name, value);
                if (name.equalsIgnoreCase(CONTENT_LENGTH)) {
                    context.setOriginContentLength(value);
                }
                if (isIncludedHeader(name)) {
                    context.addZuulResponseHeader(name, value);
                }
            }
        }
    }

    /**
     * æ–°å¢çš„è¾…åŠ©æ–¹æ³•ï¼Œåªæœ‰jsonç­‰è¿”å›ç±»å‹æ—¶æ‰è®°å½•responseæ—¥å¿—
     * åˆ¤æ–­response content-typeæ˜¯å¦æ˜¯jsonã€xmlç­‰æ­£å¸¸æ¥å£è¿”å›ç±»å‹
     */
    private boolean matchesMimeType(MultiValueMap&lt;String, String&gt; headers) {
        if (CollectionUtils.isEmpty(headers)) {
            return false;
        }
        String contentType = null;
        for (Map.Entry entry : headers.entrySet()) {
            if (entry.getKey().toString().equalsIgnoreCase(HttpHeaders.CONTENT_TYPE)) {
                List list = (ArrayList) entry.getValue();
                contentType = (String) list.get(0);
                break;
            }
        }
        if (StringUtils.isEmpty(contentType)) {
            return false;
        }
        String[] mimeTypes = new String[]{&quot;text/html&quot;, &quot;text/xml&quot;, &quot;application/xml&quot;, &quot;application/json&quot;};
        for (String mimeType : mimeTypes) {
            if (contentType.contains(mimeType)) {
                return true;
            }
        }
        return false;
    }

    /**
     * è¾…åŠ©æ–¹æ³•
     * å®é™…è®°å½•responseè¿”å›æ—¥å¿—
     */
    private void debugResponse(int status, InputStream entity, MultiValueMap&lt;String, String&gt; headers) throws IOException {
        if (entity == null) {
            return;
        }

        // ééœ€è¦è§£æçš„content-typeï¼Œä¸åšå¤„ç†
        RequestContext context = RequestContext.getCurrentContext();
        if (!matchesMimeType(headers)) {
            context.setResponseDataStream(entity);
            return;
        }

        byte[] entityByteArray = StreamUtils.copyToByteArray(entity);
        InputStream wrappedEntity = new ByteArrayInputStream(entityByteArray);

        //è®°å½•response
        char[] buffer = new char[4096];
        int count;
        boolean isSmallBody = true;
        try (InputStreamReader input = new InputStreamReader(wrappedEntity, StandardCharsets.UTF_8)) {
            count = input.read(buffer, 0, buffer.length);
            if (input.read() != -1) {
                isSmallBody = false;
            }
        }
        if (count &gt; 0) {
            String resp = new String(buffer).substring(0, count);
            context.getRequest().setAttribute(RESPONSE_TRACE_DATA_KEY, (isSmallBody ? resp : resp + &quot;&lt;truncated&gt;&quot;));
        }
        wrappedEntity.reset();
        context.setResponseDataStream(wrappedEntity);
    }

}
</code></pre>
<br>
<p>2ã€å¯ç”¨æ–°å»ºå¥½çš„å­ç±»ã€‚æ–°å»ºä¸ªé…ç½®é¡¹ï¼Œå°†è‡ªå®šä¹‰çš„å­ç±»ï¼Œè®¾ç½®ä¸º<code>proxyRequestHelper</code>è¿™ä¸ª<code>bean</code>çš„é»˜è®¤å®ç°(<code>@Primary</code>)</p>

<pre><code class="language-java">import org.springframework.boot.actuate.trace.InMemoryTraceRepository;
import org.springframework.cloud.netflix.zuul.ZuulProxyAutoConfiguration;
import org.springframework.cloud.netflix.zuul.filters.ProxyRequestHelper;
import org.springframework.cloud.netflix.zuul.filters.ZuulProperties;
import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;
import org.springframework.context.annotation.Primary;

@Configuration
public class MyZuulAutoConfiguration extends ZuulProxyAutoConfiguration {
    @Bean
    @Primary
    public ProxyRequestHelper proxyRequestHelper(ZuulProperties zuulProperties) {
        MyTraceProxyRequestHelper helper = new MyTraceProxyRequestHelper();
        helper.setTraces(new InMemoryTraceRepository());
        helper.setIgnoredHeaders(zuulProperties.getIgnoredHeaders());
        helper.setTraceRequestBody(zuulProperties.isTraceRequestBody());
        return helper;
    }
}

</code></pre>
<br>
<p>3ã€è·å–æ—¥å¿—å†…å®¹å¹¶å®é™…å†™å…¥æ—¥å¿—ã€‚è¿™å„¿å¯ä»¥å»ºä¸€ä¸ªspringçš„è¯·æ±‚æ‹¦æˆªå™¨<code>OncePerRequestFilter</code>ï¼Œè®°å½•è¯·æ±‚è€—æ—¶å¹¶åœ¨å¤„ç†å®Œæ¯•åå†™å…¥æ—¥å¿—ã€‚</p>

<pre><code class="language-java">import lombok.extern.slf4j.Slf4j;
import org.apache.commons.lang.StringUtils;
import org.springframework.context.annotation.Configuration;
import org.springframework.web.filter.OncePerRequestFilter;

import javax.servlet.FilterChain;
import javax.servlet.ServletException;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;
import java.io.IOException;
import java.util.LinkedHashMap;
import java.util.Map;

/**
 * æ·»åŠ è°ƒè¯•æ—¥å¿—ä¿¡æ¯
 */
@Configuration
@Slf4j
public class LogFilter extends OncePerRequestFilter {

    public static final String REQUEST_BEGIN_TIME = &quot;REQUEST_BEGIN_TIME&quot;;

    @Override
    protected void doFilterInternal(HttpServletRequest httpServletRequest, HttpServletResponse httpServletResponse, FilterChain filterChain) throws ServletException, IOException {
        httpServletRequest.setAttribute(REQUEST_BEGIN_TIME, System.currentTimeMillis());
        filterChain.doFilter(httpServletRequest, httpServletResponse);
        traceLog(httpServletRequest);
    }

    /**
     * è®°å½•æ—¥å¿—
     */
    private void traceLog(HttpServletRequest request) {
        Long begin = (Long) request.getAttribute(REQUEST_BEGIN_TIME);
        if (begin == null || begin == 0L) {
            begin = System.currentTimeMillis();
        }

        Map&lt;String, Object&gt; logData = new LinkedHashMap&lt;&gt;();
        Map&lt;String, Object&gt; requestMap = (Map&lt;String, Object&gt;) request.getAttribute(REQUEST_TRACE_DATA_KEY);
        logData.put(&quot;url&quot;, request.getRequestURL());
        logData.put(&quot;uri&quot;, request.getRequestURI());
        logData.put(&quot;timeCost&quot;, System.currentTimeMillis() - begin);
        if (requestMap != null) {
            logData.putAll(requestMap);
        }
        logData.put(&quot;responseBody&quot;, StringUtils.abbreviate(String.valueOf(request.getAttribute(RESPONSE_TRACE_DATA_KEY)), 128));

        log.info(&quot;{}&quot;, logData);
    }
}

</code></pre>
<br>
<p><strong>okäº†ï¼Œè‡³æ­¤å¤§åŠŸå‘Šæˆï¼</strong></p>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[iText ç”Ÿåƒ»å­—æ˜¾ç¤ºè®¾ç½®ä¸æ±‰å­—æ•°å­—åŒ–]]></title>
    <link href="https://chenrenyi.github.io/15827936185226.html"/>
    <updated>2020-02-27T16:53:38+08:00</updated>
    <id>https://chenrenyi.github.io/15827936185226.html</id>
    <content type="html"><![CDATA[
<h2 id="toc_0">é—®é¢˜æè¿°</h2>

<p>iText ç”Ÿæˆçš„ pdfï¼Œæ— æ³•æ˜¾ç¤ºæŸäº›ç”Ÿåƒ»å­—ï¼Œæ¯”å¦‚ã€ã™“ã€‘ã€ã€ğ …¤ã€‘ã€‚åœ¨é‡åˆ°ç”Ÿåƒ»å­—æ—¶ä¸ä¼šæ˜¾ç¤ºæˆæ–¹å—ï¼Œè€Œæ˜¯ç›´æ¥ä¸æ˜¾ç¤ºã€‚<br/>
<span id="more"></span><!-- more --></p>

<h2 id="toc_1">åŸæ¥ç”Ÿæˆ pdf çš„è¿‡ç¨‹</h2>

<p>1ã€ç”¨ FreeMarker æ¨¡æ¿å¼•æ“ç”Ÿæˆ htmlï¼Œhtml é‡Œé¢çš„ css æŒ‡å®šäº†å­—ä½“æ–‡ä»¶<br/>
<a href="media/15827936185226/docs.css">docs</a></p>

<pre><code class="language-css">body {font-family: SimSun}
</code></pre>

<p>2ã€æ·»åŠ  SimSun å­—ä½“æ–‡ä»¶</p>

<pre><code class="language-java">new ITextRenderer().getFontResolver().addFont(&quot;SimSun.ttf&quot;)
</code></pre>

<p>3ã€ç”¨ iText æ¡†æ¶å°† html è½¬åŒ–æˆ pdf æ–‡ä»¶</p>

<pre><code class="language-java">renderer.setDocumentFromString(content, storagePath);
</code></pre>

<h2 id="toc_2">åŸå› åˆ†æ</h2>

<p>åŸå› ç®€å•è¯´æ¥ï¼Œå°±æ˜¯ SimSun.ttfï¼ˆä¸­æ˜“å®‹ä½“ï¼Œä¹Ÿæ˜¯ windows ç³»ç»Ÿé»˜è®¤å­—ä½“ï¼‰ä¸­æœªæ”¶å½•æŸäº›ç”Ÿåƒ»å­—ï¼Œæ‰€ä»¥ç”Ÿæˆçš„ pdf ä¸­æ˜¾ç¤ºä¸å‡ºæ¥ã€‚</p>

<p>è‡³äºä¸ºå•¥ä¸æ”¶å½•ä»¥åŠå¯¹åº”çš„è§£å†³åŠæ³•ï¼Œéœ€è¦å…ˆäº†è§£ä¸‹è®¡ç®—æœºæ˜¯å¦‚ä½•æ˜¾ç¤ºæ±‰å­—çš„ã€‚æˆ–è€…ä¹Ÿå¯ä»¥ç›´æ¥è·³è¿‡çœ‹æœ€ç»ˆè§£å†³æ–¹æ¡ˆï¼Œå†å›è¿‡å¤´çœ‹åŸç†ã€‚</p>

<h2 id="toc_3">æ±‰å­—çš„æ•°å­—åŒ–å†å²</h2>

<h3 id="toc_4">æ±‰å­—æœ‰å¤šå°‘ä¸ª</h3>

<p>ç”Ÿæ´»ä¸­çš„æƒ…å†µï¼šæˆ‘å›½ä¹‰åŠ¡æ•™è‚²é˜¶æ®µè¦æ±‚è¯†å­— 3500 ä¸ªå·¦å³ï¼Œ2013 å¹´å›½åŠ¡é™¢å‘å¸ƒçš„ã€Šé€šç”¨è§„èŒƒæ±‰å­—è¡¨ã€‹ï¼Œæ”¶å½•æ±‰å­— 8105 ä¸ªï¼Œåˆ†ä¸ºä¸‰çº§ï¼Œå…¶ä¸­ä¸€çº§å­—ä¸ºå¸¸ç”¨å­—å…± 3500ä¸ªï¼ŒäºŒçº§å­— 3000 ä¸ªï¼Œä¸‰çº§å­— 1605 ä¸ªã€‚</p>

<p>ä¹¦æœ¬ä¸­çš„æƒ…å†µï¼šä¸œæ±‰çš„ã€Šè¯´æ–‡è§£å­—ã€‹æ”¶å­— 9353 ä¸ªï¼Œæ¸…æœã€Šåº·ç†™å­—å…¸ã€‹æ”¶å­— 47,035 ä¸ªï¼Œå½“ä»£çš„ã€Šæ±‰è¯­å¤§å­—å…¸ã€‹ï¼ˆ2010 å¹´ç‰ˆ) æ”¶å­— 60,370 ä¸ªã€‚ 1994 å¹´ä¸­åä¹¦å±€ã€ä¸­å›½å‹è°Šå‡ºç‰ˆå…¬å¸å‡ºç‰ˆçš„ã€Šä¸­åå­—æµ·ã€‹æ”¶å­— 85,568 ä¸ªã€‚</p>

<p>æ®ä¼°ç®—æ€»æ±‰å­—çº¦ 10 ä¸‡ä¸ªï¼Œå…·ä½“æ•°å­—æ— äººæ¸…æ¥šã€‚</p>

<h3 id="toc_5">æŠŠæ±‰å­—æ”¾è¿›è®¡ç®—æœºï¼Œæ±‰å­—ç¼–ç å†å²</h3>

<p>æƒ³ç”¨è®¡ç®—æœºä¼ è¾“å­˜å‚¨æ–‡å­—ï¼Œå¿…ç„¶è¦æœ‰ç¼–ç æ–¹æ¡ˆã€‚ä½†æ±‰å­—å®åœ¨å¤ªå¤šï¼Œæ‰€ä»¥ç¼–ç æ–¹æ¡ˆæ˜¯æ¼”è¿›å‹çš„ï¼ŒåˆæœŸåªæ”¶å½•çš„å­—æ•°å¾ˆå°‘ï¼Œåé¢æ‰æ…¢æ…¢æ‰©å……ã€‚</p>

<h4 id="toc_6">å›½æ ‡ï¼š</h4>

<p>1981 å¹´ï¼šå‘å¸ƒ GB2312â€”1980ï¼Œæ”¶å½•æ±‰å­— 6763 ä¸ªå’Œéæ±‰å­—å›¾å½¢å­—ç¬¦ 682 ä¸ª<br/>
1995 å¹´ï¼šå‘å¸ƒ GBKï¼Œæ”¶å½• 21886 ä¸ªæ±‰å­—å’Œå›¾å½¢ç¬¦å·<br/>
2001 å¹´ï¼šå‘å¸ƒ GB18030ï¼Œå…±æ”¶å½•æ±‰å­— 70,244 ä¸ª</p>

<h4 id="toc_7">unicodeï¼š</h4>

<p>unicode çš„ç›®çš„æ˜¯å›½é™…é€šè¡Œï¼Œè€Œå›½é™…ä¸Šæ±‰å­—ä½¿ç”¨é™¤ä¸­å›½å¤–ï¼Œè¿˜æœ‰æ—¥éŸ©ã€‚å› æ­¤ä¸ºäº†ç»Ÿä¸€æ±‰å­—ç¼–ç ï¼Œæœ‰äº†ä¸­æ—¥éŸ©ç»Ÿä¸€è¡¨æ„æ–‡å­— (å³ CJKï¼Œå„å›½è‹±æ–‡åé¦–å­—æ¯)ã€‚ä¸ºå•¥è¦è®² unicode å‘¢ï¼Œå› ä¸ºç¼–ç¨‹è¯­è¨€å¯¹å®ƒçš„æ”¯æŒå¥½å•Šã€‚</p>

<p>ä»1991å¹´åˆ°2018å¹´ï¼Œå…ˆæ˜¯å‘å¸ƒäº†ç¬¬ä¸€ç‰ˆï¼Œåæ¥é™†ç»­å¢åŠ äº†æ‰©å±•è¡¨ Aã€Bã€Cã€Dã€Eã€FåŒº</p>

<h3 id="toc_8">æŠŠæ±‰å­—æ˜¾ç¤ºå‡ºæ¥ï¼Œå­—ä½“æ–‡ä»¶</h3>

<p>æœ‰äº†ç¼–ç æ–¹æ¡ˆï¼Œè¿˜è¦æœ‰å­—ä½“æ–‡ä»¶ï¼ŒçŸ¥é“å¦‚ä½•æŠŠæ±‰å­—ç”»å‡ºæ¥ã€‚å› ä¸ºæ±‰å­—æ•°é‡å¤ªå¤šï¼Œç¼–ç æ–¹æ¡ˆæ˜¯æ¼”è¿›å‹çš„ï¼Œæ‰€ä»¥å­—ä½“æ–‡ä»¶ä¹Ÿåªæä¾›äº†ä¸€éƒ¨åˆ†æ±‰å­—ã€‚</p>

<p>å¸¸ç”¨å­—ä½“æ–‡ä»¶æ ¼å¼ï¼š<br/>
ttfï¼šæœ€å¸¸ç”¨çš„ï¼Œå¾®è½¯å’Œè‹¹æœåˆæ¨çš„<br/>
ttcï¼šæœ¬è´¨æ˜¯å¤šä¸ªttfçš„é›†åˆ<br/>
otfï¼šæ˜¯ttfçš„å‡çº§ç‰ˆï¼Œæµ‹è¯•å‘ç°iTextæ¡†æ¶è²Œä¼¼ä¸æ”¯æŒ</p>

<p>æˆ‘ä»ç½‘ä¸Šä¸‹è½½çš„è®¸å¤šå·ç§°è¶…å¤§å­—ç¬¦é›†çš„å­—ä½“æ–‡ä»¶ï¼Œé‡Œé¢éƒ½æ˜¯åˆ†ä¸ºå¥½å‡ ä¸ª ttf æ–‡ä»¶çš„ã€‚æœ‰ä¸¤ä¸ªåŸå› ï¼Œä¸€æ˜¯å¸¸ç”¨å­—å·²ç»æœ‰å­—ä½“æ–‡ä»¶äº†ï¼Œå› æ­¤åªéœ€è¦å†æä¾›ä¸€ä»½ç”Ÿåƒ»å­—çš„æ–‡ä»¶å³å¯ã€‚äºŒæ˜¯æœ‰ttfæ ¼å¼æœ‰æ•°é‡ä¸Šé™ï¼Œæ²¡æ³•æ”¾ä¸‹å…¨éƒ¨çš„å­—ã€‚</p>

<h2 id="toc_9">å­—ä½“æ˜¾ç¤ºçš„ fallback æœºåˆ¶</h2>

<p>ä¸Šé¢è§£é‡Šäº†ä¸ºä»€ä¹ˆå•ä¸ªå­—ä½“æ–‡ä»¶æ²¡åŒ…å«æ‰€æœ‰å­—ï¼Œä½†å®é™…ä¸Šçš„æƒ…å†µæ˜¯ï¼Œæœ‰äº›å­—åœ¨ç³»ç»Ÿä¸Šå’Œæµè§ˆå™¨ä¸­èƒ½çœ‹åˆ°ï¼Œæ¯”å¦‚ä¸¾ä¾‹ä¸­çš„ã€ğ …¤ã€‘ï¼Œè€Œ pdf ä¸­å´ä¸æ˜¾ç¤ºå‘¢ï¼Ÿ</p>

<h3 id="toc_10">æ“ä½œç³»ç»Ÿ/æµè§ˆå™¨æ˜¯æ€ä¹ˆå¤„ç†å­—ä½“ç¼ºå¤±çš„ï¼Ÿ</h3>

<p>fallbackï¼Œå³å›é€€æœºåˆ¶ï¼šå¦‚æœæŒ‡å®šç”¨å­—ä½“â€†Aâ€†æ¥æ˜¾ç¤ºæŸå­—ç¬¦â€†xï¼Œä½†è¯¥å­—ä½“å¹¶ä¸æ”¯æŒè¿™ä¸ªå­—ç¬¦ï¼ˆç”šè‡³è¯¥å­—ä½“å½“å‰ä¸å¯ç”¨ï¼‰ï¼Œæ’ç‰ˆå¼•æ“é€šå¸¸ä¸ä¼šç›´æ¥æ”¾å¼ƒï¼Œå®ƒä¼šæ ¹æ®ä¸€ä¸ªé¢„å…ˆè®°å¥½çš„åˆ—è¡¨æ¥å°è¯•å¯»æ‰¾èƒ½æ˜¾ç¤ºå­—ç¬¦â€†xâ€†çš„å­—ä½“ï¼Œå¦‚æœæ‰¾åˆ°å­—ä½“â€†Bâ€†èƒ½è¡Œï¼Œé‚£å°±ç”¨å­—ä½“â€†Bâ€†æ¥æ˜¾ç¤ºå­—ç¬¦â€†xã€‚å­—ä½“â€†Bâ€†å°±æ˜¯å½“å‰è¿™ä¸ªæƒ…å†µçš„ fallbackã€‚</p>

<h3 id="toc_11">ç”Ÿæˆ pdf æ—¶ä¸ºå•¥ä¸æ”¯æŒ fallbackï¼Ÿ</h3>

<p>pdfï¼šä¸»è¦ç”¨äºæ‰“å°å’Œé˜…è¯»ï¼Œè€Œéç¼–è¾‘ã€‚æœ‰ä¸€ä¸ªç‰¹ç‚¹æ˜¯ï¼šå®ƒå¯ä»¥å°†æ–‡å­—ã€å­—å‹ã€æ ¼å¼ã€é¢œè‰²åŠç‹¬ç«‹äºè®¾å¤‡å’Œåˆ†è¾¨ç‡çš„å›¾å½¢å›¾åƒç­‰å°è£…åœ¨ä¸€ä¸ªæ–‡ä»¶ä¸­ï¼Œä¸ªäººç†è§£å°±æ˜¯è·Ÿå›¾ç‰‡ä¸€æ ·ï¼Œå°è£…äº†æ‰€æœ‰çš„æ˜¾ç¤ºæ•ˆæœï¼Œæ‰€ä»¥æ— è®ºåœ¨ä»€ä¹ˆå¹³å°æ‰“å¼€ï¼Œæ’ç‰ˆæ•ˆæœéƒ½æ˜¯ä¸€æ ·çš„ã€‚</p>

<p>æ‰€ä»¥å®ƒæ˜¯ä¸€ä¸ªç‹¬ç«‹çš„ä¸ä¾èµ–äºå¹³å°çš„æ ¼å¼ï¼Œä¸ªäººçŒœæµ‹è¿™ä¹Ÿå°±æ˜¯ä¸ºä»€ä¹ˆå®ƒä¸æ”¯æŒæ“ä½œç³»ç»Ÿçš„fallbackæœºåˆ¶ã€‚</p>

<h2 id="toc_12">è§£å†³æ–¹æ¡ˆ</h2>

<p>çŸ¥é“äº†å•ä¸ªå­—ä½“ä¸åŒ…å«æ‰€æœ‰æ–‡ä»¶ï¼Œpdf ä¹Ÿä¸æ”¯æŒ fallback æœºåˆ¶åï¼Œè§£å†³æ–¹æ¡ˆå¦‚ä¸‹ï¼š</p>

<p>1ã€å¼•å…¥æœ€æ–°ç‰ˆ SimSun.ttfï¼ŒSimSun-extB.ttf ä¸¤ä¸ªæ–‡ä»¶ï¼Œæˆ‘ä» win10 æœ€æ–°ç‰ˆä¸­å¯¼å…¥çš„ï¼Œç»æµ‹è¯•å‰è€…åŒ…å« cjk ä¸æ‰©å±• A åŒºçš„å­—ä½“ï¼Œåè€…åŒ…å«å…¶å®ƒåŒºçš„å­—ä½“ã€‚</p>

<p>2ã€iText æ¡†æ¶æ·»åŠ ä¸Šé¢ä¸¤ä¸ªå­—ä½“ï¼Œå‚è§ 2.2</p>

<p>3ã€html ä¸­æŒ‡å®šé»˜è®¤å­—ä½“ä¸º SimSunï¼Œå‚è§ 2.1</p>

<p>4ã€éå† html å†…å®¹ï¼Œæ‰«æå‡º B åŒºåŠä»¥åçš„å­—ä½“ï¼Œæ‰‹åŠ¨æŒ‡å®šå­—ä½“æ ¼å¼ SimSun-ExtBã€‚ä»£ç å¦‚ä¸‹ï¼š</p>

<pre><code class="language-java">    /**
     * æ‰«æå¾…è½¬åŒ–æˆpdfçš„htmlå†…å®¹ï¼Œä¸ºç”Ÿåƒ»å­—æŒ‡å®šç”Ÿåƒ»å­—ä½“ï¼Œè§£å†³ç”Ÿåƒ»å­—ä¸æ˜¾ç¤ºçš„é—®é¢˜
     */
    private String addFontFamilyForUncommonWords(String string) {
        int[] stringUnicodes = StringUtils.toCodePoints(string);
        StringBuffer resultString = new StringBuffer();

        for (int charUnicode : stringUnicodes) {
            // ä¸­æ˜“å®‹ä½“(simsun)å«æœ‰å¸¸è§„å­—ç¬¦åŠcjkæ‰©å±•è¡¨Açš„å†…å®¹ï¼Œä¸­æ˜“å®‹ä½“æ‰©å±•ç‰ˆ(simsun-extb)æœ‰cjkå…¶å®ƒæ‰©å±•è¡¨åŒºå†…å®¹
            Character.UnicodeBlock ub = Character.UnicodeBlock.of(charUnicode);
            if (ub == Character.UnicodeBlock.CJK_UNIFIED_IDEOGRAPHS_EXTENSION_B
                    || ub == Character.UnicodeBlock.CJK_UNIFIED_IDEOGRAPHS_EXTENSION_C
                    || ub == Character.UnicodeBlock.CJK_UNIFIED_IDEOGRAPHS_EXTENSION_D) {
                resultString.append(&quot;&lt;font style=&#39;font-family: SimSun-ExtB&#39;&gt;&quot;);
                resultString.append(Character.toChars(charUnicode));
                resultString.append(&quot;&lt;/font&gt;&quot;);
            } else {
                resultString.append(Character.toChars(charUnicode));
            }
        }

        return resultString.toString();
    }
</code></pre>

<h2 id="toc_13">å…¶å®ƒæ–¹æ¡ˆ</h2>

<h3 id="toc_14">1ã€æ¢æ¡†æ¶ï¼Œä¸ç”¨ iTextã€‚</h3>

<p>ç½‘ä¸Šæœç´¢å…¶å®ƒ pdf æ¡†æ¶ç»“æœå¾ˆå°‘ï¼Œå› æ­¤æœªä½œå°è¯•</p>

<h3 id="toc_15">2ã€css ä¸­æŒ‡å®šå¤šä¸ªå­—ä½“è§£å†³</h3>

<p>ç»æµ‹è¯•ï¼Œåœ¨ css çš„ font-family ä¸­æŒ‡å®šå¤šä¸ªå­—ä½“ï¼Œç”Ÿæˆ pdf æ—¶åªæŒ‰é¡ºåºä½¿ç”¨ç¬¬ä¸€ä¸ªå­˜åœ¨çš„å­—ä½“ï¼Œå³å¸¸ç”¨å­—ä½“åœ¨å‰åªæ˜¾ç¤ºå¸¸ç”¨å­—ï¼Œç”Ÿåƒ»å­—ä½“åœ¨å‰åªæ˜¾ç¤ºç”Ÿåƒ»å­—ã€‚åŸå› ç›¸å…³çŸ¥è¯†ä¸­æœ‰å†™ï¼Œç”Ÿæˆ pdf æ—¶ä¸æ”¯æŒ fallback æœºåˆ¶ã€‚</p>

<h3 id="toc_16">3ã€é»˜è®¤å­—ä½“æŒ‡å®šä¸ºä¸€ä¸ªè¶…å…¨è¶…å¤§çš„å­—ä½“æ–‡ä»¶</h3>

<p>ç›¸å…³çŸ¥è¯†ä¸­æœ‰ä»‹ç»ï¼Œttf æ ¼å¼æœ‰å­—å½¢ä¸Šé™ï¼Œæ”¶å½•å­—å½¢æƒ³å…¨å¿…é¡»å­˜åœ¨å¤šä¸ªæ–‡ä»¶ã€‚åŒæ—¶ iText ä¸æ”¯æŒ otf æ ¼å¼ï¼Œæ”¯æŒ ttc æ ¼å¼ä½†å¿…é¡»æŒ‡å®šåºå·ï¼Œå³ç”¨ ttc ä¸­åŒ…å«çš„å“ªä¸€ä¸ª ttfï¼Œå› æ­¤ä¸è¡Œã€‚</p>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[ç¬¬ä¸€ç¯‡æ–‡ç« ]]></title>
    <link href="https://chenrenyi.github.io/15818551802185.html"/>
    <updated>2020-02-16T20:13:00+08:00</updated>
    <id>https://chenrenyi.github.io/15818551802185.html</id>
    <content type="html"><![CDATA[
<p>å› æ–°å† è‚ºç‚ç–«æƒ…å‘†åœ¨å®¶é‡Œçš„ç¬¬ 26 å¤©ï¼Œé—²æ¥æ— äº‹ç¬¬ n æ¬¡æ­å»ºåšå®¢ï¼Œå†™ä¸‹åŒæ ·ç¬¬ n æ¬¡çš„å¼€ç¯‡æ–‡ç« ã€‚</p>

<span id="more"></span><!-- more -->

<p>è¿™ä¸€æ¬¡ç”¨çš„ Mwebï¼ˆé¡µè„šæƒé™å£°æ˜é‚£æœ‰å®˜ç½‘é“¾æ¥ï¼‰ï¼ŒMac ä¸Šä¸€ä¸ª Markdown å†™ä½œè½¯ä»¶ï¼Œè‡ªå¸¦é™æ€åšå®¢åˆ›å»ºå’Œå‘å¸ƒåŠŸèƒ½ï¼Œæ”¯æŒè‡ªå®šä¹‰å‘å¸ƒè„šæœ¬ã€‚æ—¥å¸¸åœ¨ç¼–è¾‘å™¨ä¹¦å†™ï¼Œå®Œæˆåä¸€é”®å‘å¸ƒå³å¯ã€‚</p>

<p>å½“ç„¶äº†ï¼Œè¿™è½¯ä»¶æ˜¯æ”¶è´¹çš„ã€‚å›½å†…å¼€å‘è€…ï¼Œåšå¾—æŒºç”¨å¿ƒã€‚æ¯”å¦‚æˆ‘ä¸ªäººå¾ˆå–œæ¬¢çš„ä¸€ä¸ªå°åŠŸèƒ½æ˜¯ï¼Œâ€œåœ¨ä¸­æ–‡å’ŒåŠè§’çš„è‹±æ–‡ã€æ•°å­—ä¹‹é—´æ’å…¥ç©ºæ ¼â€ï¼ŒGithub ä¸Šä¹Ÿæœ‰å¼€æºå®ç°ï¼Œç§°å‘¼è¿™ç§ç©ºæ ¼ä¸ºç›˜å¤ç™½ï¼Œå„ç¼–ç¨‹è¯­è¨€ç‰ˆæœ¬éƒ½æœ‰ã€‚ä¸ Word å’Œæ‰‹æœºå¾®ä¿¡çš„èŠå¤©æ¡†æ˜¾ç¤ºæ•ˆæœç±»ä¼¼ã€‚å…¶å®ä»£ç å®ç°å¹¶ä¸å¤æ‚ï¼Œä½†èƒ½ä»ä¸­ä¸€çª¥ä½œè€…å¯¹æ’ç‰ˆå’Œç”¨æˆ·ä½“éªŒçš„ç»†èŠ‚è¿½æ±‚ã€‚</p>

<p>æœ‰ç¼˜çœ‹åˆ°çš„å…„å¼Ÿå¯ä»¥è¯•è¯•ã€‚å¦‚æœè½¯ä»¶ä½œè€…çœ‹åˆ°äº†ï¼Œè®°å¾—ç»™æˆ‘æ‰“é’±å•ŠğŸ˜†</p>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[å®‰å…¨]]></title>
    <link href="https://chenrenyi.github.io/15981025908754.html"/>
    <updated>2020-08-22T21:23:10+08:00</updated>
    <id>https://chenrenyi.github.io/15981025908754.html</id>
    <content type="html"><![CDATA[
<h2 id="toc_0">å¤§çº²</h2>

<ul>
<li>ç³»ç»Ÿè®¾è®¡
<ul>
<li>ç²¾ç»†åŒ–çš„æƒé™æ¨¡å‹</li>
<li>æ¯”å¦‚ ID éå†é—®é¢˜ä¿¡æ¯æ³„æ¼é—®é¢˜</li>
</ul></li>
<li>å¸¸è§å®‰å…¨é—®é¢˜
<ul>
<li>è§åé¢è¯¦è¿°</li>
</ul></li>
<li>ç¯å¢ƒå®‰å…¨
<ul>
<li>æ¯”å¦‚æ–‡ä»¶ç³»ç»Ÿæƒé™åº”ç²¾ç»†è®¾ç½®ï¼Œä¸èƒ½ä¸€æ¦‚ 777</li>
<li>php.ini è®¾ç½®ã€mysql è®¾ç½®åº”é‡‡ç”¨å®‰å…¨è®¾ç½®ï¼Œç¦ç”¨æ‰å±é™©å‡½æ•°é…ç½®ç­‰</li>
<li>åŠæ—¶æ‰“è¡¥ä¸ä¿®å¤æ¼æ´</li>
<li>æ¡†æ¶é‡‡ç”¨é•¿æœŸç‰ˆæœ¬ LTS ç‰ˆæœ¬</li>
</ul></li>
</ul>

<h2 id="toc_1">XSS è·¨ç«™è„šæœ¬ Cross-site scripting</h2>

<p>è§£å†³åŠæ³•ï¼š</p>

<ul>
<li>è¿‡æ»¤ç‰¹æ®Šå­—ç¬¦</li>
<li>ä½¿ç”¨ HTTP å¤´æŒ‡å®šç±»å‹</li>
</ul>

<h2 id="toc_2">CSRF è·¨ç«™è¯·æ±‚ä¼ªé€  Cross-site request forgery</h2>

<p>æ˜¯æ”»å‡»è€…é€šè¿‡ä¸€äº›æŠ€æœ¯æ‰‹æ®µæ¬ºéª—ç”¨æˆ·çš„æµè§ˆå™¨å»è®¿é—®ä¸€ä¸ªè‡ªå·±æ›¾ç»è®¤è¯è¿‡çš„ç½‘ç«™å¹¶è¿è¡Œä¸€äº›æ“ä½œ</p>

<p>è¿™åˆ©ç”¨äº† web ä¸­ç”¨æˆ·èº«ä»½éªŒè¯çš„ä¸€ä¸ªæ¼æ´ï¼šç®€å•çš„èº«ä»½éªŒè¯åªèƒ½ä¿è¯è¯·æ±‚å‘è‡ªæŸä¸ªç”¨æˆ·çš„æµè§ˆå™¨ï¼Œå´ä¸èƒ½ä¿è¯è¯·æ±‚æœ¬èº«æ˜¯ç”¨æˆ·è‡ªæ„¿å‘å‡ºçš„ã€‚</p>

<p>è§£å†³åŠæ³•ï¼š</p>

<ul>
<li>æ£€æŸ¥ Referer å­—æ®µ</li>
<li>æ·»åŠ æ ¡éªŒ token</li>
</ul>

<h2 id="toc_3">SQLæ³¨å…¥</h2>

<p>æ‰«æå·¥å…·ï¼šsqlmap</p>

<p>è§£å†³åŠæ³•ï¼š</p>

<ul>
<li>å‚æ•°é¢„ç»‘å®šï¼Œæˆ–è€…ä½¿ç”¨ORMæ¡†æ¶çš„å‚æ•°ç»‘å®š</li>
</ul>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Zookeeper]]></title>
    <link href="https://chenrenyi.github.io/15981025270346.html"/>
    <updated>2020-08-22T21:22:07+08:00</updated>
    <id>https://chenrenyi.github.io/15981025270346.html</id>
    <content type="html"><![CDATA[
<p>åˆ†å¸ƒå¼åè°ƒæ¡†æ¶</p>

<h2 id="toc_0">åœºæ™¯</h2>

<ul>
<li>æ•°æ®å‘å¸ƒ/è®¢é˜…ï¼ˆé…ç½®ä¸­å¿ƒï¼‰
<ul>
<li>æ ‘å½¢ç»“æ„ä¸”èŠ‚ç‚¹å¯å­˜å‚¨æ•°æ®ï¼Œå¤©ç„¶é…ç½®ä¸­å¿ƒã€‚</li>
<li>å…³æ³¨èŠ‚ç‚¹ä»¥æ¥æ”¶é€šçŸ¥ï¼Œç„¶åå¯ä»¥åŠ¨æ€è·å–é…ç½®ä¿¡æ¯</li>
</ul></li>
<li>å‘½åæœåŠ¡ / è´Ÿè½½å‡è¡¡
<ul>
<li>ç”Ÿæˆå…¨å±€å”¯ä¸€ID</li>
</ul></li>
<li>åˆ†å¸ƒå¼åè°ƒ/é€šçŸ¥</li>
<li>å¿ƒè·³æ£€æµ‹
<ul>
<li>AæœåŠ¡åˆ›å»ºä¸´æ—¶èŠ‚ç‚¹ï¼ŒAå…³é—­åä¸´æ—¶èŠ‚ç‚¹å³æ–­æ‰</li>
<li>BæœåŠ¡æŸ¥çœ‹æœ‰å¤šå°‘ä¸´æ—¶èŠ‚ç‚¹ï¼Œå³çŸ¥é“æœ‰å¤šå°‘æœåŠ¡æ´»ç€</li>
</ul></li>
<li>é›†ç¾¤ç®¡ç†</li>
<li>Masteré€‰ä¸¾
<ul>
<li>é€‰ä¸¾æ—¶ï¼Œå„å¤‡é€‰æœºå™¨åˆ›å»ºä¸€ä¸ªç›¸åŒä¸´æ—¶çš„znode</li>
<li>è°åˆ›å»ºæˆåŠŸï¼Œè°æˆä¸ºmaster</li>
<li>å¤±è´¥çš„ï¼Œå…³æ³¨è¯¥èŠ‚ç‚¹</li>
<li>è‹¥masteræŒ‚æ‰ï¼Œå…¶ä½™èŠ‚ç‚¹èƒ½å¤Ÿç«‹åˆ»æ„ŸçŸ¥ï¼Œä»è€Œé‡æ–°é€‰ä¸¾</li>
</ul></li>
<li>åˆ†å¸ƒå¼é”å’Œåˆ†å¸ƒå¼é˜Ÿåˆ—
<ul>
<li>æ’å®ƒé”
<ul>
<li>ä¸´æ—¶znodeï¼Œæ»¡è¶³åªæœ‰ä¸€ä¸ªäº‹åŠ¡å¯ä»¥è·å¾—é”ï¼Œé‡Šæ”¾åèƒ½é€šçŸ¥çš„åŠŸèƒ½</li>
</ul></li>
<li>å…±äº«é”
<ul>
<li>åˆ›å»ºä¸´æ—¶æœ‰åºznodeï¼Œvalueæ ‡è®°ä¸º å†™ã€è¯»</li>
<li>è·å–è¯»é”ï¼šè‹¥æ¯”å½“å‰èŠ‚ç‚¹åºå·å°çš„éƒ½æ˜¯è¯»é”ï¼Œåˆ™è®¤ä¸ºè·å–æˆåŠŸ</li>
<li>è·å–å†™é”ï¼šè‹¥è‡ªå·±å°±æ˜¯æœ€å°èŠ‚ç‚¹ï¼Œåˆ™è®¤ä¸ºè·å–æˆåŠŸ</li>
<li>å¦åˆ™æ³¨å†Œç›‘å¬äº‹ä»¶</li>
</ul></li>
</ul></li>
</ul>

<h2 id="toc_1">ä¿è¯çš„ç‰¹æ€§</h2>

<ul>
<li>é¡ºåºä¸€è‡´æ€§
<ul>
<li>åŒä¸€å®¢æˆ·ç«¯å‘èµ·çš„è¯·æ±‚ï¼Œä¼šæŒ‰é¡ºåºåº”ç”¨åˆ°æœåŠ¡å™¨</li>
</ul></li>
<li>åŸå­æ€§
<ul>
<li>äº‹åŠ¡ç»“æœåœ¨æ‰€æœ‰æœºå™¨ä¸Šä¸€æ ·</li>
</ul></li>
<li>å•ä¸€è§†å›¾
<ul>
<li>å®¢æˆ·ç«¯è¿æ¥ä»»æ„æœåŠ¡å™¨ï¼Œçœ‹åˆ°çš„ç»“æœä¸€æ ·</li>
</ul></li>
<li>å¯é æ€§
<ul>
<li>æŒä¹…åŒ–</li>
</ul></li>
<li>å®æ—¶æ€§
<ul>
<li>åœ¨ä¸€å®šçš„æ—¶å€™å†…ï¼Œèƒ½çœ‹åˆ°æœ€æ–°çš„æ•°æ®</li>
</ul></li>
</ul>

<h2 id="toc_2">é›†ç¾¤è§’è‰²</h2>

<ul>
<li>Leader</li>
<li>Follower</li>
<li>Observer
<ul>
<li>é»˜è®¤æ— è¯¥è§’è‰²</li>
<li>å¯æä¾›è¯»ï¼Œä¸æä¾›å†™</li>
<li>ä¸å‚ä¸å†™çš„è¿‡åŠå†™æˆåŠŸç­–ç•¥</li>
<li>ä¸å‚ä¸ Leader é€‰ä¸¾</li>
<li>ä½œç”¨ï¼šåœ¨ä¸å½±å“å†™çš„æ€§èƒ½ä¸‹ï¼Œå¢åŠ è¯»æ€§èƒ½</li>
</ul></li>
</ul>

<h2 id="toc_3">æ•°æ®</h2>

<pre><code class="language-text">[zk: localhost:2181(CONNECTED) 23] get /yarn-leader-election/appcluster-yarn/ActiveBreadCrumb

appcluster-yarnrm1
cZxid = 0x1b00133dc0    //Created ZXID,è¡¨ç¤ºè¯¥ZNodeè¢«åˆ›å»ºæ—¶çš„äº‹åŠ¡ID
ctime = Tue Jan 03 15:44:42 CST 2017    //Created Time,è¡¨ç¤ºè¯¥ZNodeè¢«åˆ›å»ºçš„æ—¶é—´
mZxid = 0x1d00000063    //Modified ZXIDï¼Œè¡¨ç¤ºè¯¥ZNodeæœ€åä¸€æ¬¡è¢«æ›´æ–°æ—¶çš„äº‹åŠ¡ID
mtime = Fri Jan 06 08:44:25 CST 2017    //Modified Timeï¼Œè¡¨ç¤ºè¯¥èŠ‚ç‚¹æœ€åä¸€æ¬¡è¢«æ›´æ–°çš„æ—¶é—´
pZxid = 0x1b00133dc0    //è¡¨ç¤ºè¯¥èŠ‚ç‚¹çš„å­èŠ‚ç‚¹åˆ—è¡¨æœ€åä¸€æ¬¡è¢«ä¿®æ”¹æ—¶çš„äº‹åŠ¡IDã€‚æ³¨æ„ï¼Œåªæœ‰å­èŠ‚ç‚¹åˆ—è¡¨å˜æ›´äº†æ‰ä¼šå˜æ›´pZxidï¼Œå­èŠ‚ç‚¹å†…å®¹å˜æ›´ä¸ä¼šå½±å“pZxidã€‚
cversion = 0    //å­èŠ‚ç‚¹çš„ç‰ˆæœ¬å·
dataVersion = 11    //æ•°æ®èŠ‚ç‚¹çš„ç‰ˆæœ¬å·
aclVersion = 0    //ACLç‰ˆæœ¬å·
ephemeralOwner = 0x0    //åˆ›å»ºè¯¥èŠ‚ç‚¹çš„ä¼šè¯çš„seddionIDã€‚å¦‚æœè¯¥èŠ‚ç‚¹æ˜¯æŒä¹…èŠ‚ç‚¹ï¼Œé‚£ä¹ˆè¿™ä¸ªå±æ€§å€¼ä¸º0ã€‚
dataLength = 22    //æ•°æ®å†…å®¹çš„é•¿åº¦
numChildren = 0    //å­èŠ‚ç‚¹çš„ä¸ªæ•°
</code></pre>

<h2 id="toc_4">å…¶å®ƒæ¦‚å¿µ</h2>

<h3 id="toc_5">Watcher</h3>

<pre><code class="language-text">Watcherï¼ˆäº‹ä»¶ç›‘å¬å™¨ï¼‰ï¼Œæ˜¯ZooKeeperä¸­ä¸€ä¸ªå¾ˆé‡è¦çš„ç‰¹æ€§ã€‚
ZooKeeperå…è®¸ç”¨æˆ·åœ¨æŒ‡å®šèŠ‚ç‚¹ä¸Šæ³¨å†Œä¸€äº›Watcherï¼Œå¹¶ä¸”åœ¨ä¸€äº›ç‰¹å®šäº‹ä»¶è§¦å‘çš„æ—¶å€™ï¼ŒZooKeeperæœåŠ¡ç«¯ä¼šå°†äº‹ä»¶é€šçŸ¥åˆ°æ„Ÿå…´è¶£çš„å®¢æˆ·ç«¯ä¸Šå»ã€‚
è¯¥æœºåˆ¶æ˜¯ZooKeeperå®ç°åˆ†å¸ƒå¼åè°ƒæœåŠ¡çš„é‡è¦ç‰¹æ€§ã€‚
</code></pre>

<h3 id="toc_6">äº‹åŠ¡</h3>

<p>èƒ½æ”¹å˜zookeeperæœåŠ¡å™¨çŠ¶æ€çš„ç§°ä¸ºäº‹åŠ¡ï¼Œå¦‚èŠ‚ç‚¹åˆ›å»ºã€åˆ é™¤ã€æ›´æ–°ç­‰ã€‚äº‹åŠ¡å·ä¸ºzxid</p>

<h3 id="toc_7">ACL</h3>

<p>access control Lists æ§åˆ¶æƒé™</p>

<ul>
<li>CREATE: åˆ›å»ºå­èŠ‚ç‚¹çš„æƒé™ã€‚</li>
<li>READ: è·å–èŠ‚ç‚¹æ•°æ®å’Œå­èŠ‚ç‚¹åˆ—è¡¨çš„æƒé™ã€‚</li>
<li>WRITEï¼šæ›´æ–°èŠ‚ç‚¹æ•°æ®çš„æƒé™ã€‚</li>
<li>DELETE: åˆ é™¤å­èŠ‚ç‚¹çš„æƒé™ã€‚</li>
<li>ADMIN: è®¾ç½®èŠ‚ç‚¹ACLçš„æƒé™ã€‚</li>
</ul>

<h2 id="toc_8">ZABåè®®</h2>

<pre><code class="language-text">æ‰€æœ‰äº‹åŠ¡è¯·æ±‚å¿…é¡»ç”±ä¸€ä¸ªå…¨å±€å”¯ä¸€çš„æœåŠ¡å™¨æ¥åè°ƒå¤„ç†ï¼Œè¿™æ ·çš„æœåŠ¡å™¨è¢«ç§°ä¸ºLeaderæœåŠ¡å™¨ï¼Œè€Œå‰©ä¸‹çš„å…¶ä»–æœåŠ¡å™¨åˆ™æˆä¸ºFolloweræœåŠ¡å™¨ã€‚
LeaderæœåŠ¡å™¨è´Ÿè´£å°†ä¸€ä¸ªå®¢æˆ·ç«¯äº‹åŠ¡è¯·æ±‚è½¬æ¢æˆä¸€ä¸ªäº‹åŠ¡Proposalï¼ˆææ¡ˆï¼‰å¹¶å°†è¯¥Proposalåˆ†å‘ç»™é›†ç¾¤ä¸­æ‰€æœ‰çš„FolloweræœåŠ¡å™¨ã€‚
ä¹‹åLeaderæœåŠ¡å™¨éœ€è¦ç­‰å¾…æ‰€æœ‰FolloweræœåŠ¡å™¨çš„åé¦ˆï¼Œä¸€æ—¦è¶…è¿‡åŠæ•°çš„FolloweræœåŠ¡å™¨è¿›è¡Œäº†æ­£ç¡®çš„åé¦ˆåï¼Œ
Leaderå°±ä¼šå†æ¬¡å‘æ‰€æœ‰çš„FolloweræœåŠ¡å™¨åˆ†å‘Commitæ¶ˆæ¯ï¼Œè¦æ±‚å¯¹åˆšæ‰çš„Proposalè¿›è¡Œæäº¤ã€‚
</code></pre>

<h3 id="toc_9">è¯»å†™è¿‡ç¨‹</h3>

<h4 id="toc_10">å†™Leader</h4>

<ul>
<li>å®¢æˆ·ç«¯å‘Leaderå‘èµ·å†™è¯·æ±‚</li>
<li>Leaderå‘é€ææ¡ˆç»™æ‰€æœ‰Followerå¹¶ç­‰å¾…ACK</li>
<li>è¿‡åŠFollowerå›å¤ACKï¼ŒLeaderè‡ªå·±ä¹Ÿæœ‰ä¸€ç¥¨ACKï¼Œå‘æ‰€æœ‰Followerã€Observerå‘é€commit</li>
<li>è¿”å›ç»“æœç»™å®¢æˆ·ç«¯</li>
</ul>

<h4 id="toc_11">å†™Followerã€Observer</h4>

<ul>
<li>è½¬å‘ç»™Leader</li>
<li>åŒå†™Leader</li>
</ul>

<h4 id="toc_12">è¯»</h4>

<ul>
<li>ç›´æ¥ä»æœ¬åœ°å†…å­˜è¯»å–åè¿”å›</li>
</ul>

<h3 id="toc_13">é€‰ä¸¾è¿‡ç¨‹</h3>

<p><a href="https://dbaplus.cn/news-141-1875-1.html">é€‰ä¸¾è¿‡ç¨‹</a></p>

<h3 id="toc_14">ä¸¤ç§æ¨¡å¼</h3>

<p><strong>æ¢å¤æ¨¡å¼</strong></p>

<p>æœåŠ¡å¯åŠ¨æˆ–LeaderæŒ‚æ‰åï¼Œè¿›å…¥æ¢å¤æ¨¡å¼ã€‚<br/>
Leaderé€‰ä¸¾å®Œæˆï¼Œä¸”å¤§éƒ¨åˆ†èŠ‚ç‚¹å®ŒæˆçŠ¶æ€åŒæ­¥åï¼Œé€€å‡ºæ¢å¤æ¨¡å¼</p>
<br>
<p><strong>å¹¿æ’­æ¨¡å¼</strong></p>

<p>æ­£å¸¸ç»´æŒåœ¨å¹¿æ’­çŠ¶æ€<br/>
æ–°èŠ‚ç‚¹åŠ å…¥æ—¶ï¼Œä¼šåœ¨æ¢å¤æ¨¡å¼ä¸‹å¯åŠ¨ï¼Œä»¥å®ŒæˆçŠ¶æ€åŒæ­¥</p>

<h2 id="toc_15">é¢è¯•é—®é¢˜</h2>

<h3 id="toc_16">å¦‚ä½•ä¿è¯äº‹åŠ¡çš„é¡ºåºä¸€è‡´æ€§</h3>

<p>é€šè¿‡äº‹åŠ¡å·zxidï¼Œ</p>

<ul>
<li>é«˜32ä½ï¼šä¸–ä»£å·ï¼Œæ¯æ¬¡å‡ºç°æ–°Leaderå³åŠ 1</li>
<li>ä½32ä½ï¼šæ¯æ¬¡æ–°äº‹åŠ¡åŠ 1</li>
</ul>

<h3 id="toc_17">éƒ¨ç½²æ¨¡å¼</h3>

<ul>
<li>å•æœº</li>
<li>é›†ç¾¤</li>
<li>ä¼ªé›†ç¾¤ï¼ˆå•æœºå¤šå®ä¾‹ï¼‰</li>
</ul>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Linux]]></title>
    <link href="https://chenrenyi.github.io/15981005517872.html"/>
    <updated>2020-08-22T20:49:11+08:00</updated>
    <id>https://chenrenyi.github.io/15981005517872.html</id>
    <content type="html"><![CDATA[
<h2 id="toc_0">lsofï¼ˆlist open filesï¼‰</h2>

<pre><code class="language-bash"># æŸ¥çœ‹ç«¯å£å ç”¨
lsof -i:80
</code></pre>

<h2 id="toc_1">top</h2>

<p>æ˜¾ç¤ºä¿¡æ¯ï¼š</p>

<ul>
<li>ç³»ç»Ÿæ—¶é—´</li>
<li>cpu</li>
<li>å†…å­˜</li>
<li>äº¤æ¢ç©ºé—´</li>
<li>çº¿ç¨‹</li>
</ul>

<pre><code class="language-text">top - 17:19:17 up 1112 days,  6:25,  4 users,  load average: 0.36, 0.34, 0.61
Tasks: 184 total,   2 running, 181 sleeping,   0 stopped,   1 zombie
Cpu(s): 14.6%us,  9.2%sy,  5.5%ni, 69.9%id,  0.0%wa,  0.0%hi,  0.2%si,  0.6%st
Mem:   1927548k total,  1879924k used,    47624k free,   319916k buffers
Swap:  3145712k total,  1894636k used,  1251076k free,   353284k cached

  PID USER      PR  NI  VIRT  RES  SHR S %CPU %MEM    TIME+  COMMAND
 8448 chenreny  20   0  215m  14m 4072 S  5.1  0.8   0:02.99 php-fpm
 2755 nobody    30  10  850m 3384 1044 S  4.3  0.2   3845:50 minos-agent-tk
 8483 chenreny  20   0  215m  14m 4056 S  4.3  0.8   0:02.83 php-fpm
 2546 nobody    30  10  850m 3372 1044 S  4.1  0.2   3855:48 minos-agent
</code></pre>

<h2 id="toc_2">free</h2>

<p>æŸ¥çœ‹å¯ç”¨å†…å­˜</p>

<h2 id="toc_3">vmstat</h2>

<p>æŸ¥çœ‹å†…å­˜ä¿¡æ¯</p>

<h2 id="toc_4">iostat</h2>

<p>æ˜¾ç¤ºioä¿¡æ¯ï¼Œå¯æŸ¥çœ‹cpu idleä¿¡æ¯</p>

<pre><code class="language-text">Linux 2.6.32_1-16-0-0_virtio (cp01-sys-ump-ur-dev14.epc.baidu.com)  11/27/2019  _x86_64_    (1 CPU)

avg-cpu:  %user   %nice %system %iowait  %steal   %idle
          15.32    3.96    9.74    5.49    4.56   60.92

Device:            tps   Blk_read/s   Blk_wrtn/s   Blk_read   Blk_wrtn
vda              12.87       625.63       104.02 60056660458 9985065320
vdb             194.53      1760.93        60.82 169039945506 5838059600
</code></pre>

<h2 id="toc_5">sar System Activity Reporterï¼ˆç³»ç»Ÿæ´»åŠ¨æŠ¥å‘Šï¼‰</h2>

<p>æŸ¥çœ‹ç³»ç»Ÿå†å²ç›‘æ§ä¿¡æ¯ï¼Œæ¯”å¦‚æŸ¥çœ‹è¿‡å»ä¸€æ®µæ—¶é—´å†… idle å˜åŒ–</p>

<h2 id="toc_6">pstack</h2>

<p>æ‰“å°å†…å­˜å †æ ˆä¿¡æ¯ï¼Œç”¨äºè¿›ç¨‹å¡æ­»æ—¶debugï¼Œjava ç¨‹åºå¯ç”¨ jstack</p>

<h2 id="toc_7">æ–‡å­—å¤„ç†</h2>

<h3 id="toc_8">awk æˆ– sed</h3>

<pre><code class="language-text">ls -l | awk &#39;{print $1}&#39;
</code></pre>

<h3 id="toc_9">uniq</h3>

<pre><code class="language-text">uniq testfile # å»é‡æ˜¾ç¤º
uniq -c testfile # å»é‡å¹¶æ˜¾ç¤ºé‡å¤æ•°ï¼Œé‡å¤è¡Œä¸ç›¸é‚»æ—¶æ— æ•ˆ
uniq -d testfile # ä»…æ˜¾ç¤ºé‡å¤è¡Œ
sort  testfile1 | uniq -c
</code></pre>

<h3 id="toc_10">wget</h3>

<pre><code class="language-text">wc -l testfile # ç»Ÿè®¡è¡Œå·
wc -w testfile # ç»Ÿè®¡å­—æ•°
</code></pre>

<h2 id="toc_11">å…¶å®ƒå¸¸ç”¨</h2>

<p>grepã€dfã€dhã€straceï¼ˆè·Ÿè¸ªç³»ç»Ÿè°ƒç”¨ï¼‰</p>

<h2 id="toc_12">å‚è€ƒèµ„æ–™</h2>

<p><a href="https://linuxtools-rst.readthedocs.io/zh_CN/latest/tool/index.html">å·¥å…·å‚è€ƒç¯‡</a></p>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Redis]]></title>
    <link href="https://chenrenyi.github.io/15980994076315.html"/>
    <updated>2020-08-22T20:30:07+08:00</updated>
    <id>https://chenrenyi.github.io/15980994076315.html</id>
    <content type="html"><![CDATA[
<h2 id="toc_0">æ•°æ®ç±»å‹å’Œå‘½ä»¤</h2>

<h3 id="toc_1">string</h3>

<pre><code class="language-text">set
get
</code></pre>

<h3 id="toc_2">list</h3>

<pre><code class="language-text">lpush
lpop
rpush
rpop
</code></pre>

<p>åº•å±‚å®ç°æ˜¯é“¾è¡¨ï¼Œé‡å°‘æ—¶ä¸ºzipsetï¼Œå³æ•°ç»„çš„è¿ç»­åŒºåŸŸã€‚é‡å¤§æ—¶ä¸ºquicksetï¼Œå³å°†å¤šä¸ªzipsetç”¨æŒ‡é’ˆè¿æ¥èµ·æ¥</p>

<h3 id="toc_3">hash</h3>

<pre><code class="language-text">hset
hget
</code></pre>

<h3 id="toc_4">set</h3>

<pre><code class="language-text">sadd
smembers
</code></pre>

<h3 id="toc_5">sortedset</h3>

<pre><code class="language-text">zadd
zrange
</code></pre>

<p>åº•å±‚å®ç°ä¸ºè·³è·ƒåˆ—è¡¨ï¼Œè·³è¡¨</p>

<h2 id="toc_6">è·³è¡¨</h2>

<p>ä¸ªäººæ€»ç»“ï¼š</p>

<ul>
<li>é¦–å…ˆæ˜¯ä¸€ä¸ªæœ‰åºé“¾è¡¨</li>
<li>ä¸ºäº†æé«˜æŸ¥è¯¢é€Ÿåº¦ï¼Œç»™æ¯ä¸ªèŠ‚ç‚¹å¢åŠ å¤šä¸ªç´¢å¼•ï¼ŒæŒ‡å‘æ›´åé¢çš„èŠ‚ç‚¹ã€‚ç”±O(n) â€”â€”&gt; O(log(n))</li>
<li>æŠ›ç¡¬å¸å†³å®šåŠ å‡ å±‚ç´¢å¼•ï¼Œå³ç¬¬ä¸€å±‚100%ï¼Œç¬¬äºŒå±‚50%ï¼Œç¬¬ä¸‰å±‚25%...</li>
</ul>

<p>ä¸ºå•¥ä¸ç”¨å¹³è¡¡æ ‘ï¼ˆå¹³è¡¡æ’åºæ ‘ï¼‰ï¼š</p>

<ul>
<li>æ’å…¥åˆ é™¤ä¸ç”¨è°ƒæ•´å­æ ‘ï¼Œæ›´ç®€å•è¿…é€Ÿ</li>
<li>èŒƒå›´æŸ¥æ‰¾æ¯”å¹³è¡¡æ ‘å¥½</li>
<li>ç®—æ³•å®ç°ç®€å•</li>
</ul>

<p><img src="media/15980994076315/%E8%B7%B3%E8%A1%A8.svg" alt="è·³è¡¨"/></p>

<h2 id="toc_7">é›†ç¾¤æ¨¡å¼</h2>

<h3 id="toc_8">ä¸»ä»å¤åˆ¶</h3>

<p>ä»‹ç»ï¼š</p>

<ul>
<li>ä¸»æœåŠ¡å™¨è¯»å†™</li>
<li>ä»æœåŠ¡å™¨å¤‡ä»½ï¼Œæä¾›è¯»</li>
</ul>

<p>ç‰¹ç‚¹ï¼š</p>

<ul>
<li>è¯»å†™åˆ†ç¦»</li>
<li>å®¹ç¾æ¢å¤</li>
</ul>

<p>ç¼ºç‚¹ï¼š</p>

<ul>
<li>å†™èƒ½åŠ›æœªæé«˜</li>
<li>ä¸æ”¯æŒè‡ªåŠ¨æ¢å¤</li>
<li>æ•…éšœæ—¶å¯èƒ½æœ‰éƒ¨åˆ†æ•°æ®æœªåŒæ­¥</li>
</ul>

<h3 id="toc_9">å“¨å…µæ¨¡å¼</h3>

<p>å¸¦å“¨å…µçš„ä¸»ä»å¤åˆ¶æ¨¡å¼ï¼Œå¯ä»¥è‡ªåŠ¨åˆ‡æ¢master</p>

<h3 id="toc_10">é›†ç¾¤æ¨¡å¼</h3>

<p>åˆ†å¸ƒå¼çš„å¤šèŠ‚ç‚¹<br/>
æ¯ä¸ªèŠ‚ç‚¹å¸¦ä»èŠ‚ç‚¹ï¼Œå¸¦ç›‘æ§æ¨¡å¼ï¼Œå¯ä»¥è‡ªåŠ¨åˆ‡æ¢ master</p>

<h2 id="toc_11">åº”ç”¨åœºæ™¯</h2>

<ul>
<li>åˆ†å¸ƒå¼ç¼“å­˜</li>
<li>åˆ†å¸ƒå¼é”</li>
</ul>

<h2 id="toc_12">å‚è€ƒæ–‡ç« ï¼š</h2>

<p><a href="https://juejin.im/post/5b53ee7e5188251aaa2d2e16">é€šä¿—æ˜“æ‡‚çš„Redisæ•°æ®ç»“æ„åŸºç¡€æ•™ç¨‹</a></p>

<p><a href="https://lotabout.me/2018/skip-list/">è·³è¡¨â”€â”€æ²¡å¬è¿‡ä½†å¾ˆçŠ€åˆ©çš„æ•°æ®ç»“æ„</a></p>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[JavaåŸºç¡€]]></title>
    <link href="https://chenrenyi.github.io/15980638067464.html"/>
    <updated>2020-08-22T10:36:46+08:00</updated>
    <id>https://chenrenyi.github.io/15980638067464.html</id>
    <content type="html"><![CDATA[
<h2 id="toc_0">String</h2>

<p>StringBufferï¼šçº¿ç¨‹å®‰å…¨<br/>
StringBuilderï¼šçº¿ç¨‹ä¸å®‰å…¨</p>

<h2 id="toc_1">é›†åˆ</h2>

<p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly9pbWcyMDE4LmNuYmxvZ3MuY29tL290aGVyLzE0MDgxODMvMjAxOTExLzE0MDgxODMtMjAxOTExMTkxODQxNDk1NTktMTU3MTU5NTY2OC5qcGc?x-oss-process=image/format,png" alt=""/></p>

<h3 id="toc_2">List</h3>

<ul>
<li>ArrayList</li>
<li>LinkedList</li>
<li>CopyOnWriteList</li>
<li>Collections.synchronizedList å†…éƒ¨åŒ…è£…ç±»ï¼Œç”¨syncä¿®é¥°æ–¹æ³•</li>
</ul>

<h3 id="toc_3">Set</h3>

<ul>
<li>HashSet åŸºäºHashMap</li>
<li>TreeSet åŸºäºTreeMap</li>
</ul>

<h3 id="toc_4">Map</h3>

<p><img src="media/15980638067464/15980649696422.jpg" alt=""/></p>

<h4 id="toc_5">HashMap</h4>

<p><strong>ç‰¹ç‚¹</strong></p>

<ul>
<li>å…è®¸nullå€¼ã€nullé”®</li>
<li>çº¿ç¨‹ä¸å®‰å…¨</li>
</ul>

<p><strong>æ—§ç‰ˆåº•å±‚å®ç°</strong></p>

<ul>
<li>å“ˆå¸Œè¡¨ + é“¾è¡¨</li>
</ul>

<p><strong>æ–°ç‰ˆåº•å±‚å®ç°</strong></p>

<ul>
<li>å“ˆå¸Œè¡¨ + é“¾è¡¨</li>
<li>é“¾è¡¨é•¿åº¦å¤§äº8æ—¶ï¼Œè½¬åŒ–ä¸ºçº¢é»‘æ ‘ï¼ˆé¿å…ä¸¥é‡å“ˆå¸Œå†²çªæ—¶ï¼Œæ€§èƒ½é€€åŒ–ä¸ºå•é“¾è¡¨ï¼‰</li>
</ul>

<p><strong>é•¿åº¦ä¸ºå•¥æ˜¯2çš„æ¬¡æ–¹</strong></p>

<pre><code class="language-text">1ã€å–ä½™(%)æ“ä½œä¸­å¦‚æœé™¤æ•°æ˜¯2çš„å¹‚æ¬¡åˆ™ç­‰ä»·äºä¸å…¶é™¤æ•°å‡ä¸€çš„ä¸(&amp;)æ“ä½œ
2ã€HashMapçš„keyçš„hashé‡‡ç”¨ä¸Šè¿°æ–¹æ³•ï¼Œæ€§èƒ½æ›´é«˜
3ã€æ‰€ä»¥åˆ†å¸ƒåœ¨2çš„æ¬¡æ–¹ç©ºé—´ï¼Œé•¿åº¦å–2çš„æ¬¡æ–¹åˆ†å¸ƒæ‰å‡åŒ€
</code></pre>

<h4 id="toc_6">ConcurrentHashMap</h4>

<p><strong>ç‰¹ç‚¹</strong><br/>
çº¿ç¨‹å®‰å…¨çš„HashMap</p>

<p><strong>ç‰ˆæœ¬1.7åº•å±‚å®ç°</strong><br/>
è¿›ä¸€æ­¥é‡‡ç”¨åˆ†æ®µçš„æ–¹å¼ï¼Œæ¯æ®µé…ç½®ä¸€ä¸ªé”ã€‚Segmentç»§æ‰¿è‡ªReentranLock<br/>
<img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly91c2VyLWdvbGQtY2RuLnhpdHUuaW8vMjAxOC84LzIzLzE2NTY2NzdhNmYwMDhiZTQ?x-oss-process=image/format,png" alt=""/></p>

<p><strong>ç‰ˆæœ¬1.8åº•å±‚å®ç°</strong><br/>
æŠ›å¼ƒäº†åˆ†æ®µæ–¹å¼ï¼Œä½¿ç”¨è‡ªæ—‹é” + Sychronized æ–¹å¼æ¥ä¿è¯å¹¶å‘å®‰å…¨<br/>
putæ—¶ï¼Œè‹¥keyå¯¹åº”çš„valueä¸ºnullï¼Œé€šè¿‡casä¿è¯å†™å…¥æˆåŠŸï¼Œå¦åˆ™åŠ Sychronizedé”</p>

<p>å¯¹äºè¯»æ“ä½œï¼Œç”±äºæ•°ç»„è¢«volatileå…³é”®å­—ä¿®é¥°ï¼Œå› æ­¤ä¸ç”¨æ‹…å¿ƒæ•°ç»„çš„å¯è§æ€§é—®é¢˜ã€‚åŒæ—¶æ¯ä¸ªå…ƒç´ æ˜¯ä¸€ä¸ªNodeå®ä¾‹ï¼ˆJava 7ä¸­æ¯ä¸ªå…ƒç´ æ˜¯ä¸€ä¸ªHashEntryï¼‰ï¼Œå®ƒçš„Keyå€¼å’Œhashå€¼éƒ½ç”±finalä¿®é¥°ï¼Œä¸å¯å˜æ›´ï¼Œæ— é¡»å…³å¿ƒå®ƒä»¬è¢«ä¿®æ”¹åçš„å¯è§æ€§é—®é¢˜ã€‚è€Œå…¶ValueåŠå¯¹ä¸‹ä¸€ä¸ªå…ƒç´ çš„å¼•ç”¨ç”±volatileä¿®é¥°ï¼Œå¯è§æ€§ä¹Ÿæœ‰ä¿éšœã€‚</p>

<pre><code class="language-text">static class Node&lt;K,V&gt; implements Map.Entry&lt;K,V&gt; {
  final int hash;
  final K key;
  volatile V val;
  volatile Node&lt;K,V&gt; next;
}
</code></pre>

<p>å¯¹äºKeyå¯¹åº”çš„æ•°ç»„å…ƒç´ çš„å¯è§æ€§ï¼Œç”±Unsafeçš„getObjectVolatileæ–¹æ³•ä¿è¯ã€‚</p>

<pre><code class="language-text">static final &lt;K,V&gt; Node&lt;K,V&gt; tabAt(Node&lt;K,V&gt;[] tab, int i) {
  return (Node&lt;K,V&gt;)U.getObjectVolatile(tab, ((long)i &lt;&lt; ASHIFT) + ABASE);
}
</code></pre>

<h4 id="toc_7">TreeMap</h4>

<p>çº¢é»‘æ ‘ï¼ŒNode.Key å³ä¸º keyï¼ŒNode.value å³ä¸º value</p>

<p>å› æ­¤ï¼š</p>

<ul>
<li>ä¸å…è®¸é‡å¤Key</li>
<li>å¯ä»¥æ’åºï¼Œéœ€è¦å®éªŒCompartable</li>
</ul>

<h3 id="toc_8">BlockingQueue</h3>

<p>é˜»å¡é˜Ÿåˆ—ï¼Œç”¨äºç”Ÿäº§è€…æ¶ˆè´¹è€…</p>

<ul>
<li>ArrayBlockingQueue (ReentrantLock.Conditionæ¥å®ç°ï¼‰</li>
<li>LinkedBlockingQueue</li>
<li>PriorityBlockingQueue ä¼˜å…ˆçº§é˜Ÿåˆ—</li>
<li>DelayQueue å»¶æ—¶é˜Ÿåˆ—</li>
<li>SynchronousQueue ï¼ˆæ— ç¼“å­˜ï¼Œç”Ÿäº§è€…ç›´æ¥å¯¹æ¥æ¶ˆè´¹è€…ï¼‰</li>
</ul>

<h2 id="toc_9">å¼‚å¸¸</h2>

<p><img src="https://img-blog.csdnimg.cn/20200314173417278.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L1RoaW5rV29u,size_16,color_FFFFFF,t_70" alt=""/></p>

<h3 id="toc_10">try-with-resource</h3>

<p>è‡ªåŠ¨å…³é—­èµ„æºï¼Œéœ€è¦å®ç°AutoCloseAbleæ¥å£</p>

<pre><code class="language-java">try (Scanner scanner = new Scanner(new FileInputStream(&quot;c:/abc&quot;),&quot;UTF-8&quot;)){
    // code
} catch (IOException e){
    // handle exception
}
</code></pre>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Javaå¹¶å‘]]></title>
    <link href="https://chenrenyi.github.io/15980740537693.html"/>
    <updated>2020-08-22T13:27:33+08:00</updated>
    <id>https://chenrenyi.github.io/15980740537693.html</id>
    <content type="html"><![CDATA[
<h2 id="toc_0">æ¦‚å¿µ</h2>

<h3 id="toc_1">å¹¶å‘ç¼–ç¨‹ä¸‰è¦ç´ ï¼š</h3>

<ul>
<li>åŸå­æ€§ï¼šè¦ä¹ˆæˆåŠŸè¦ä¹ˆå¤±è´¥</li>
<li>å¯è§æ€§ï¼šçº¿ç¨‹Aä¿®æ”¹å®Œå˜é‡åï¼Œçº¿ç¨‹Bèƒ½å¦æ„ŸçŸ¥</li>
<li>æœ‰åºæ€§ï¼šæŒ‡ä»¤æ‰§è¡Œé¡ºåº</li>
</ul>

<h3 id="toc_2">Javaå†…å­˜æ¨¡å‹</h3>

<p>å³Javaè™šæ‹Ÿæœºçš„å†…å­˜è§„èŒƒï¼Œç”¨äºå±è”½å„æ“ä½œç³»ç»Ÿå’Œå¹³å°é—´çš„å·®å¼‚</p>

<p>å…·ä½“å†…å®¹ï¼š</p>

<ul>
<li>å˜é‡åœ¨ä¸»å­˜ä¸­ï¼ˆå†…å­˜ï¼‰</li>
<li>çº¿ç¨‹æœ‰è‡ªå·±çš„å·¥ä½œå†…å­˜ï¼ˆç±»ä¼¼é«˜é€Ÿç¼“å­˜ï¼‰</li>
<li>çº¿ç¨‹å¯¹å˜é‡æ“ä½œåªèƒ½åœ¨è‡ªèº«å·¥ä½œå†…å­˜ä¸­æ‰§è¡Œï¼Œä¸èƒ½ç›´æ¥æ“ä½œä¸»å­˜</li>
</ul>

<p>å†…å­˜æ¨¡å‹å…³äºä¸‰è¦ç´ çš„ä¿è¯ï¼š</p>

<ul>
<li>åŸå­æ€§
<ul>
<li>ç®€å•ç±»å‹çš„èµ‹å€¼æ‰æ˜¯åŸå­æ“ä½œï¼ˆx = 10 æ˜¯ï¼Œx = y ä¸æ˜¯ï¼‰</li>
</ul></li>
<li>å¯è§æ€§
<ul>
<li>ä¸ä¿è¯ï¼Œéœ€è¦ä½¿ç”¨volatileå…³é”®å­—</li>
</ul></li>
<li>æœ‰åºæ€§
<ul>
<li>å…è®¸ä½¿ç”¨æŒ‡ä»¤é‡æ’åºï¼Œå¯¹å•çº¿ç¨‹æ— å½±å“ï¼Œå¯¹å¤šçº¿ç¨‹ä¼šé€ æˆå½±å“</li>
<li>èƒ½å¤Ÿä¿è¯çš„æœ‰ï¼š
<ul>
<li>ä¿è¯å•çº¿ç¨‹å†…æŒ‡ä»¤é‡æ’åºå¯¹æœ€ç»ˆç»“æœæ— å½±å“ï¼ˆä¹Ÿå³å®é™…æ‰§è¡Œé¡ºåºå¯èƒ½ä¼šå˜ï¼Œä½†ç»“æœä¸å˜ï¼‰</li>
<li>è‹¥ unlock å†™åœ¨å‰é¢ï¼Œlockå†™åœ¨åé¢ï¼Œä¸ä¼šé‡æ’åºé€ æˆlockåœ¨å‰</li>
<li>volatileå˜é‡ï¼Œå¯¹å®ƒçš„å…ˆå†™åè¯»æ“ä½œï¼Œä¸ä¼šé‡æ’åºæˆå…ˆè¯»åå†™</li>
<li>çº¿ç¨‹4ä¸ªé¡ºåºï¼Œä¸é‡è¦</li>
</ul></li>
</ul></li>
</ul>

<h3 id="toc_3">æŒ‡ä»¤é‡æ’åº</h3>

<p>æ“ä½œç³»ç»Ÿä¸ºäº†æ€§èƒ½ä¼˜åŒ–ï¼Œå®é™…æ‰§è¡ŒæŒ‡ä»¤çš„é¡ºåºå¯èƒ½ä¸ä¹¦å†™é¡ºåºä¸ä¸€è‡´</p>

<p>è¿™ç§ä¼˜åŒ–ä¸ä¼šæ”¹å˜å•çº¿ç¨‹çš„å®é™…æ‰§è¡Œç»“æœï¼Œä½†å¯¹å¤šçº¿ç¨‹æœ‰å½±å“</p>

<p>ä¸¾ä¾‹ï¼š</p>

<pre><code class="language-java">x = y;
z = 1;
z++;
x = x + z
</code></pre>

<pre><code class="language-text">å¯¹åº”cpuè¡Œä¸ºï¼Œx = yï¼Œå»å†…å­˜ä¸­å–yçš„å€¼ï¼Œè¾ƒæ…¢
z = 1;z++;
å¯èƒ½å¯¹åº”è®¾ç½®å¯„å­˜å™¨ä¸º1ï¼Œå¯„å­˜å™¨è¿›è¡ŒåŠ 1æ“ä½œã€‚
æ˜¾ç„¶ï¼Œç­‰å¾… x = yçš„è¿™æ®µæ—¶é—´ï¼Œå…ˆåšåé¢ä¸¤è¡Œä»£ç æ“ä½œæ˜¯æ²¡é—®é¢˜çš„
</code></pre>

<h2 id="toc_4">Volatile</h2>

<p><strong>ä½œç”¨</strong></p>

<ul>
<li>ç¦æ­¢æŒ‡ä»¤é‡æ’åº
<ul>
<li>å½“ç¨‹åºæ‰§è¡Œåˆ°volatileå˜é‡çš„è¯»æˆ–å†™æ—¶ï¼Œä¿è¯å‰é¢çš„è¯»å†™å·²å‘ç”Ÿä¸”å·²å¯è§ï¼Œåé¢çš„è¯»å†™æœªå‘ç”Ÿ</li>
<li>ä¹¦å†™é¡ºåºåœ¨volatileå˜é‡æ“ä½œå‰é¢çš„æŒ‡ä»¤ä¸ä¼šæ’åˆ°åé¢ï¼Œåä¹‹ä¸€æ ·</li>
</ul></li>
<li>åªä¿è¯å¯è§æ€§ï¼Œä¸ä¿è¯åŸå­æ€§</li>
</ul>

<p><strong>å®ç°åŸç†</strong><br/>
å†…å­˜å±éšœï¼Œä¼°è®¡æ˜¯cpuæä¾›çš„åŠŸèƒ½ï¼š</p>

<ul>
<li>ç¦æ­¢æŒ‡ä»¤é‡æ’åºï¼ŒåŒä¸Š</li>
<li>å†™æ“ä½œç«‹å³åˆ·æ–°è¿›ä¸»å†…å­˜</li>
<li>çº¿ç¨‹çš„è¯»volatileå˜é‡æ“ä½œï¼Œä¸ä¼šä½¿ç”¨é«˜é€Ÿç¼“å­˜ï¼Œè€Œæ˜¯ä¼šå»ä¸»å­˜å†è¯»ä¸€é</li>
</ul>

<p><strong>åœºæ™¯ä¸¾ä¾‹</strong></p>

<pre><code class="language-java">//çº¿ç¨‹1
volatile boolean stop = false;
while(!stop){
    doSomething();
}
 
//çº¿ç¨‹2
stop = true;
</code></pre>

<h2 id="toc_5">é”</h2>

<h3 id="toc_6">æ¦‚å¿µ</h3>

<ul>
<li>å¯é‡å…¥é”
<ul>
<li>å†…éƒ¨å¯ä»¥å†æ¬¡è¿›å…¥</li>
<li>å‡å¦‚ç”¨å˜é‡ x æ¥è¡¨ç¤ºï¼Œè¿›å…¥é”å³åŠ 1ï¼Œè¶…è¿‡1å³ä¸èƒ½å†è¿›å…¥é”ã€‚é‚£ä¹ˆå·²ç»è·å¾—é”çš„æ–¹æ³•ï¼Œé€’å½’è°ƒç”¨è‡ªå·±ï¼Œæ˜¯ä¸èƒ½è·å¾—é”çš„ï¼Œå³ä¸ºä¸å¯é‡å…¥é”ã€‚åä¹‹ä¸ºå¯é‡å…¥é”ã€‚</li>
</ul></li>
<li>å…¬å¹³é”ï¼šå…ˆç­‰é”çš„å…ˆè·å¾—é”</li>
<li>éå…¬å¹³é”ï¼šç­‰å¾…é˜Ÿåˆ—ä¸Šçš„çº¿ç¨‹ï¼Œä¸åˆ†å…ˆåé¡ºåºï¼Œæ¯æ¬¡æœ‰æœºä¼šæ—¶éƒ½éšæœºæŒ‡å®šä¸€ä¸ª</li>
<li>è‡ªæ—‹é”ï¼šæ‹¿ä¸åˆ°é”æ—¶ä¸æ˜¯çº¿ç¨‹é˜»å¡ï¼Œè€Œæ˜¯ç©ºç™½æ­»å¾ªç¯å»ä¸€ç›´æ‹¿</li>
<li>ä¹è§‚é”ï¼šé»˜è®¤æ— å†²çªï¼Œå…ˆæ“ä½œå†æ£€æµ‹å†²çª</li>
<li>æ‚²è§‚é”ï¼šé»˜è®¤æœ‰å†²çªï¼Œå…ˆåŠ é”å†æ“ä½œ</li>
<li>ç‹¬å é”ï¼šReentrantLock/Synchronized</li>
<li>å…±äº«é”ï¼šReentrantReadWriteLockï¼Œè¯»é”ä¸ºå…±äº«é”ï¼Œå†™é”ä¸ºç‹¬å é”</li>
</ul>

<h3 id="toc_7">Synchronized</h3>

<h4 id="toc_8">ç‰¹æ€§</h4>

<ul>
<li>å¯é‡å…¥</li>
<li>æŠ›å‡ºå¼‚å¸¸ä¼šè‡ªåŠ¨é‡Šæ”¾é”</li>
</ul>

<h4 id="toc_9">ç‰ˆæœ¬å·®å¼‚</h4>

<p>ç‰ˆæœ¬1.6åŠä¹‹å‰</p>

<pre><code class="language-text">è°ƒç”¨æ“ä½œç³»ç»ŸåŸç”Ÿæ–¹æ³•è¿›è¡ŒåŒæ­¥æ§åˆ¶
</code></pre>

<p>ç‰ˆæœ¬1.6ä¹‹å</p>

<ul>
<li>åˆ†ä¸ºæ— çŠ¶æ€é”ã€åå‘é”ã€è½»é‡çº§é”ã€é‡é‡çº§é”
<ul>
<li>é»˜è®¤ç”¨å¼€é”€å°‘çš„é”ï¼Œç«äº‰å¤§çš„æ—¶å€™å†å‡çº§ï¼Œå°‘çš„æ—¶å€™é™çº§ã€‚å› è€Œå¯ä»¥ä¼˜åŒ–æ€§èƒ½</li>
</ul></li>
<li>é”ç²—åŒ–ï¼Œå³åˆå¹¶åŠ é”</li>
<li>é”æ¶ˆé™¤ï¼Œåˆ¤æ–­ä»£ç æœ‰æ²¡æœ‰çº¿ç¨‹å¤–çš„å˜é‡ï¼Œæ¥åˆ¤æ–­æ˜¯å¦éœ€è¦åŠ é”</li>
<li>é€‚åº”æ€§è‡ªæ—‹ï¼Œå³æˆåŠŸè¿‡ä¸€ä¸‹ä¸€æ¬¡å¾ªç¯å°±ä¹…ä¸€ç‚¹ï¼Œå¦åˆ™å°±çŸ­ä¸€ç‚¹</li>
</ul>

<h4 id="toc_10">å•ä¾‹æ¨¡å¼</h4>

<pre><code class="language-java">public class Singleton {

    private volatile static Singleton uniqueInstance;

    private Singleton() {
    }

    public static Singleton getUniqueInstance() {
       //å…ˆåˆ¤æ–­å¯¹è±¡æ˜¯å¦å·²ç»å®ä¾‹è¿‡ï¼Œæ²¡æœ‰å®ä¾‹åŒ–è¿‡æ‰è¿›å…¥åŠ é”ä»£ç 
        if (uniqueInstance == null) {
            //ç±»å¯¹è±¡åŠ é”
            synchronized (Singleton.class) {
                if (uniqueInstance == null) {
                    uniqueInstance = new Singleton();
                }
            }
        }
        return uniqueInstance;
    }
}
</code></pre>

<pre><code class="language-text">volatileé˜»æ­¢çš„ä¸æ˜¯singleton = newSingleton()è¿™å¥è¯å†…éƒ¨[åˆ†é…ç©ºé—´ã€åˆå§‹åŒ–ã€èµ‹å€¼]çš„æŒ‡ä»¤é‡æ’ï¼Œè€Œæ˜¯ä¿è¯äº†åœ¨ä¸€ä¸ªå†™æ“ä½œï¼ˆ[1-2-3]ï¼‰å®Œæˆä¹‹å‰ï¼Œä¸ä¼šè°ƒç”¨è¯»æ“ä½œï¼ˆif (instance == null)ï¼‰
</code></pre>

<h3 id="toc_11">Lock</h3>

<h4 id="toc_12">ReadWriteLock</h4>

<p>è¯»å†™é”</p>

<h4 id="toc_13">ReentrantLock - æ’å®ƒé”</h4>

<p><strong>æ”¯æŒå…¬å¹³ä¸éå…¬å¹³</strong></p>

<pre><code class="language-java">// æ„é€ å‚æ•°ï¼šisFair
Lock NonFairlock = new ReentrantLock(false);
Lock fairLock = new ReentrantLock(true);
</code></pre>
<br>
<p><strong>ç”Ÿäº§è€…æ¶ˆè´¹è€…ç¤ºä¾‹</strong></p>

<pre><code class="language-java">// é¦’å¤´ç”Ÿäº§æ¶ˆè´¹ç¤ºä¾‹
package cn.chenrenyi.start;

import java.util.ArrayList;
import java.util.List;
import java.util.Random;
import java.util.concurrent.ExecutorService;
import java.util.concurrent.Executors;
import java.util.concurrent.TimeUnit;
import java.util.concurrent.locks.Condition;
import java.util.concurrent.locks.Lock;
import java.util.concurrent.locks.ReentrantLock;

/**
 * @author chenrenyi
 **/
public class ProductAndConsumeQueue {

    public List&lt;Integer&gt; queue;

    private int maxQueueSize;

    private Lock lock;

    private Condition notFull;

    private Condition notEmpty;

    public ProductAndConsumeQueue(int maxQueueSize) {
        this.queue = new ArrayList&lt;&gt;();
        this.maxQueueSize = maxQueueSize;
        this.lock = new ReentrantLock(true);
        this.notFull = lock.newCondition();
        this.notEmpty = lock.newCondition();
    }

    public void push() {
        try {
            lock.lock();
            while (queue.size() == maxQueueSize) {
                try {
                    // wait until not full
                    System.out.println(&quot;é˜Ÿåˆ—å·²æ»¡ï¼Œç”Ÿäº§è€…ä¼‘çœ ä¸­ï¼Œç­‰å¾…é˜Ÿåˆ—ä¸æ»¡å†ç”Ÿäº§&quot;);
                    notFull.await();
                    System.out.println(&quot;ç”Ÿäº§è€…è¢«å”¤é†’&quot;);
                } catch (InterruptedException e) {
                    e.printStackTrace();
                }
            }

            // start to push because of not empty
            queue.add(new Random().nextInt());
            System.out.println(&quot;ç”Ÿäº§è€…ç”Ÿäº§äº†é¦’å¤´&quot;);

            // signal to public that queue is not empty now.
            notEmpty.signal();

        } finally {
            lock.unlock();
        }
    }

    public void pop() {
        try {
            lock.lock();
            while (queue.size() == 0) {
                try {
                    // wait until not empty
                    System.out.println(&quot;é˜Ÿåˆ—å·²ç©ºï¼Œæ¶ˆè´¹è€…è¿›å…¥ä¼‘çœ ï¼Œç­‰å¾…é˜Ÿåˆ—ä¸ç©ºæ—¶å†æ¶ˆè´¹&quot;);
                    notEmpty.await();
                    System.out.println(&quot;æ¶ˆè´¹è€…è¢«å”¤é†’&quot;);
                } catch (InterruptedException e) {
                    e.printStackTrace();
                }
            }

            // start to push because of not empty
            queue.remove(0);
            System.out.println(&quot;æ¶ˆè´¹äº†é¦’å¤´&quot;);

            // signal to public that queue is not full now.
            notFull.signal();

        } finally {
            lock.unlock();
        }
    }

    public static void test() {
        ProductAndConsumeQueue queue = new ProductAndConsumeQueue(4);

        Runnable productor = new Runnable() {
            @Override
            public void run() {
                while (true) {
                    try {
                        TimeUnit.SECONDS.sleep(new Random().nextInt(5));
                    } catch (InterruptedException e) {
                        e.printStackTrace();
                    }
                    queue.push();
                }
            }
        };

        Runnable consumer = new Runnable() {
            @Override
            public void run() {
                while(true) {
                    try {
                        TimeUnit.SECONDS.sleep(new Random().nextInt(5));
                    } catch (InterruptedException e) {
                        e.printStackTrace();
                    }
                    queue.pop();
                }
            }
        };

        ExecutorService executorService = Executors.newCachedThreadPool();
        executorService.execute(productor);
        executorService.execute(consumer);
        executorService.shutdown();
    }
}
</code></pre>

<h3 id="toc_14">ç›¸å…³ç±»</h3>

<h4 id="toc_15">Atomic</h4>

<pre><code class="language-java">åŒ…ï¼šjava.util.concurrent.atomic
ç¤ºä¾‹ï¼šAtomicInteger.incrementAndGet()
</code></pre>
<br>
<p><strong>å®ç°åŸç†</strong><br/>
è‡ªæ—‹åŠ CAS+volatileï¼š<code>while(cas(old, new)){}</code></p>

<p><strong>CAS</strong><br/>
compare and swapï¼Œcpuæä¾›çš„æŒ‡ä»¤ï¼Œæ¯”è¾ƒå¹¶æ›¿æ¢ã€‚ä¸Šè¿°ç±»çš„åŸç†ã€‚</p>

<p><strong>ABAé—®é¢˜</strong><br/>
çº¿ç¨‹1å°†å˜é‡æ›¿æ¢2ï¼Œçº¿ç¨‹2åˆæ›¿æ¢ä¸º1ï¼Œçº¿ç¨‹3ä»¥ä¸ºæ²¡å˜å…¶å®å·²ç»å˜è¿‡ä¸€è½®äº†<br/>
è§£å†³æ–¹æ³•ï¼š</p>

<ul>
<li>AtomicStampedReferenceï¼šç‰ˆæœ¬å·è§£å†³ï¼Œå¯¹åŸæ•°åŠ 1æ—¶ï¼Œå¯¹ç‰ˆæœ¬å·ä¹ŸåŠ 1</li>
</ul>

<h4 id="toc_16">å¹¶å‘å·¥å…·åŒ…</h4>

<ul>
<li>Semaphoreï¼ˆä¿¡å·é‡ï¼‰-å…è®¸å¤šä¸ªçº¿ç¨‹åŒæ—¶è®¿é—®</li>
<li>CountDownLatchï¼ˆå€’è®¡æ—¶å™¨ï¼‰
<ul>
<li>ä¸€èˆ¬ç”¨äºæŸä¸ªçº¿ç¨‹Aç­‰å¾…è‹¥å¹²ä¸ªå…¶ä»–çº¿ç¨‹æ‰§è¡Œå®Œä»»åŠ¡ä¹‹åï¼Œå®ƒæ‰æ‰§è¡Œ</li>
</ul></li>
<li>CyclicBarrierï¼ˆå¾ªç¯æ …æ ï¼‰
<ul>
<li>ä¸€èˆ¬ç”¨äºä¸€ç»„çº¿ç¨‹äº’ç›¸ç­‰å¾…è‡³æŸä¸ªçŠ¶æ€ï¼Œç„¶åè¿™ä¸€ç»„çº¿ç¨‹å†åŒæ—¶æ‰§è¡Œ</li>
</ul></li>
</ul>

<h2 id="toc_17">çº¿ç¨‹</h2>

<h3 id="toc_18">çº¿ç¨‹æ± </h3>

<p>æ„é€ å‡½æ•°</p>

<pre><code class="language-java">/**
 * Creates a new {@code ThreadPoolExecutor} with the given initial
 * parameters.
 *
 * @param corePoolSize the number of threads to keep in the pool, even
 *        if they are idle, unless {@code allowCoreThreadTimeOut} is set
 * @param maximumPoolSize the maximum number of threads to allow in the
 *        pool
 * @param keepAliveTime when the number of threads is greater than
 *        the core, this is the maximum time that excess idle threads
 *        will wait for new tasks before terminating.
 * @param unit the time unit for the {@code keepAliveTime} argument
 * @param workQueue the queue to use for holding tasks before they are
 *        executed.  This queue will hold only the {@code Runnable}
 *        tasks submitted by the {@code execute} method.
 * @param threadFactory the factory to use when the executor
 *        creates a new thread
 * @param handler the handler to use when execution is blocked
 *        because the thread bounds and queue capacities are reached
 * @throws IllegalArgumentException if one of the following holds:&lt;br&gt;
 *         {@code corePoolSize &lt; 0}&lt;br&gt;
 *         {@code keepAliveTime &lt; 0}&lt;br&gt;
 *         {@code maximumPoolSize &lt;= 0}&lt;br&gt;
 *         {@code maximumPoolSize &lt; corePoolSize}
 * @throws NullPointerException if {@code workQueue}
 *         or {@code threadFactory} or {@code handler} is null
 */
public ThreadPoolExecutor(int corePoolSize, 
                          int maximumPoolSize,
                          long keepAliveTime,
                          @NotNull TimeUnit unit,
                          @NotNull BlockingQueue&lt;Runnable&gt; workQueue,
                          @NotNull ThreadFactory threadFactory,
                          @NotNull RejectedExecutionHandler handler
</code></pre>

<h4 id="toc_19">å¤±è´¥å¤„ç†ç­–ç•¥</h4>

<pre><code class="language-text">AbortPolicyï¼šA handler for rejected tasks that throws a RejectedExecutionException

DiscardPolicyï¼šA handler for rejected tasks that silently discards the rejected task

DiscardOldestPolicyï¼šA handler for rejected tasks that discards the oldest unhandled request and then retries execute, unless the executor is shut down, in which case the task is discarded.

CallerRunsPolicyï¼šA handler for rejected tasks that runs the rejected task directly in the calling thread of the execute method, unless the executor has been shut down, in which case the task is discarded.
</code></pre>

<h4 id="toc_20">çº¿ç¨‹æ± ç§ç±»</h4>

<p>newSingleThreadExecutorï¼šå•çº¿ç¨‹ï¼Œæ— é™é˜Ÿåˆ—ï¼Œä¸å›æ”¶</p>

<pre><code class="language-java">public static ExecutorService newSingleThreadExecutor() {
        return new FinalizableDelegatedExecutorService
            (new ThreadPoolExecutor(1, 1,
                                    0L, TimeUnit.MILLISECONDS,
                                    new LinkedBlockingQueue&lt;Runnable&gt;()));
    }
</code></pre>

<p>newFixedThreadPoolï¼šå›ºå®šçº¿ç¨‹æ•°ï¼Œæ— é™é˜Ÿåˆ—ï¼Œä¸å›æ”¶</p>

<pre><code class="language-java">public static ExecutorService newFixedThreadPool(int nThreads) {
        return new ThreadPoolExecutor(nThreads, nThreads,
                                      0L, TimeUnit.MILLISECONDS,
                                      new LinkedBlockingQueue&lt;Runnable&gt;());
    }
</code></pre>

<p>newScheduledThreadPoolï¼šå»¶è¿Ÿæˆ–å‘¨æœŸæ‰§è¡Œä»»åŠ¡ã€‚</p>

<pre><code class="language-java">public ScheduledThreadPoolExecutor(int corePoolSize) {
        super(corePoolSize, Integer.MAX_VALUE, 0, NANOSECONDS,
              new DelayedWorkQueue());
    }
</code></pre>

<p>newCachedThreadPool</p>

<pre><code class="language-java">// æ— é™é˜Ÿåˆ—ï¼ŒåŠ¨æ€åˆ›å»ºï¼Œ60ç§’ç©ºé—²å³å›æ”¶ã€‚ä½¿ç”¨åŒæ­¥é˜Ÿåˆ— SynchronousQueueï¼Œæäº¤ä»»åŠ¡æ“ä½œä¼šé˜»å¡ç›´åˆ°çº¿ç¨‹åˆ›å»ºå¥½å¹¶å–å‡ºä»»åŠ¡
public static ExecutorService newCachedThreadPool() {
        return new ThreadPoolExecutor(0, Integer.MAX_VALUE,
                                      60L, TimeUnit.SECONDS,
                                      new SynchronousQueue&lt;Runnable&gt;());
    }
</code></pre>

<pre>
newWorkStealingPoolï¼šForkJoinPoolï¼Œ1.7ä¹‹åæ–°å¢
</pre>

<h3 id="toc_21">ThreadLocal</h3>

<p>çº¿ç¨‹æœ¬åœ°å˜é‡ï¼Œçº¿ç¨‹å†…å¯è§ï¼Œçº¿ç¨‹å¤–ä¸å¯è§</p>

<pre><code class="language-java">// åˆ›å»º
ThreadLocal&lt;String&gt; mStringThreadLocal = new ThreadLocal&lt;&gt;();
ThreadLocal&lt;String&gt; mThreadLocal = new ThreadLocal&lt;String&gt;() {
    @Override
    protected String initialValue() {
      return Thread.currentThread().getName();
    }
};

// ä½¿ç”¨
mStringThreadLocal.set(&quot;chenrenyi&quot;);
mStringThreadLocal.get();
</code></pre>

<p><strong>Set åˆ›å»ºè¿‡ç¨‹</strong>ï¼š</p>

<ul>
<li>é¦–å…ˆè·å–å½“å‰çº¿ç¨‹çš„æˆå‘˜å˜é‡ï¼šthreadLocalsï¼Œç±»å‹ï¼šThreadLocalMap</li>
<li>å¦‚æœä¸Šè¿°ThreadLocalMapå¯¹è±¡ä¸ä¸ºç©ºï¼Œåˆ™è®¾ç½®å€¼ï¼Œå¦åˆ™åˆ›å»ºè¿™ä¸ªThreadLocalMapå¯¹è±¡å¹¶è®¾ç½®å€¼</li>
<li>ä»¥å½“å‰ ThreadLocal å¯¹è±¡ä¸º keyï¼Œset çš„å‚æ•°å€¼ä¸ºå€¼</li>
</ul>

<p>å³åˆ›å»ºä¸€ä¸ª ThreadLocalMap ï¼Œå†èµ‹å€¼ç»™ Thread.threadLocals å±æ€§ä¸Šã€‚map çš„ key ä¸ºåˆ›å»ºçš„ ThreadLocal å¯¹è±¡ï¼Œå€¼ä¸ºå€¼ã€‚å…¶ä¸­ key å¼±å¼•ç”¨ï¼Œé¿å…å†…å­˜æ³„æ¼</p>

<p><strong>ä¸ºä½•åªåœ¨çº¿ç¨‹å†…å¯è§</strong>ï¼š</p>

<p>å› ä¸º threadLocalMap æ˜¯ thread çš„ä¸€ä¸ªæˆå‘˜å˜é‡ï¼Œè€Œæ¯ä¸ª thread çš„æˆå‘˜å˜é‡è‡ªç„¶ä¸ä¸€æ ·ï¼Œæ‰€ä»¥åªåœ¨çº¿ç¨‹å†…å¯è§</p>

<p><strong>å¯¹è±¡å­˜æ”¾åœ¨å“ªé‡Œ</strong>ï¼š</p>

<p>å †ä¸Š</p>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Java Jvm]]></title>
    <link href="https://chenrenyi.github.io/15980814209679.html"/>
    <updated>2020-08-22T15:30:20+08:00</updated>
    <id>https://chenrenyi.github.io/15980814209679.html</id>
    <content type="html"><![CDATA[
<h2 id="toc_0">ç»„æˆ</h2>

<h3 id="toc_1">JVMç»„æˆ</h3>

<p>ä¸¤ä¸ªå­ç³»ç»Ÿï¼š</p>

<ul>
<li>ç±»åŠ è½½</li>
<li>æ‰§è¡Œå¼•æ“</li>
</ul>

<p>ä¸¤ä¸ªç»„ä»¶ï¼š</p>

<ul>
<li>è¿è¡Œæ—¶æ•°æ®åŒº - JVMå†…å­˜åŒºåŸŸ</li>
<li>æœ¬åœ°æ–¹æ³•æ¥å£</li>
</ul>

<p><img src="https://img-blog.csdnimg.cn/20200103213149526.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly90aGlua3dvbi5ibG9nLmNzZG4ubmV0,size_16,color_FFFFFF,t_70" alt=""/></p>

<h3 id="toc_2">JVMå†…å­˜ç»“æ„ - è¿è¡Œæ—¶æ•°æ®åŒº ç»„æˆ</h3>

<h4 id="toc_3">æ¦‚è¿°</h4>

<ul>
<li>å †å†…å­˜
<ul>
<li>å¹´è½»ä»£
<ul>
<li>edenSpace</li>
<li>FromSpace</li>
<li>ToSpace</li>
</ul></li>
<li>è€å¹´ä»£</li>
</ul></li>
<li>æ–¹æ³•åŒº
<ul>
<li>çº¿ç¨‹å…±äº«ï¼Œä¿å­˜ç±»ã€å¸¸é‡ã€é™æ€å˜é‡ç­‰æ•°æ®</li>
</ul></li>
<li>è™šæ‹Ÿæœºæ ˆ</li>
<li>æœ¬åœ°æ–¹æ³•æ ˆ</li>
<li>ç¨‹åºè®¡æ•°å™¨</li>
</ul>

<p><img src="media/15980814209679/15980817654033.jpg" alt=""/></p>

<p><img src="media/15980814209679/15980819260266.jpg" alt=""/></p>

<p>å¤§å°å‚æ•°æ§åˆ¶ï¼š</p>

<ul>
<li>-Xmsè®¾ç½®å †çš„æœ€å°ç©ºé—´å¤§å°ã€‚</li>
<li>-Xmxè®¾ç½®å †çš„æœ€å¤§ç©ºé—´å¤§å°ã€‚</li>
<li>-XX:NewSizeè®¾ç½®æ–°ç”Ÿä»£æœ€å°ç©ºé—´å¤§å°ã€‚</li>
<li>-XX:MaxNewSizeè®¾ç½®æ–°ç”Ÿä»£æœ€å¤§ç©ºé—´å¤§å°ã€‚</li>
<li>-XX:PermSizeè®¾ç½®æ°¸ä¹…ä»£æœ€å°ç©ºé—´å¤§å°ã€‚</li>
<li>-XX:MaxPermSizeè®¾ç½®æ°¸ä¹…ä»£æœ€å¤§ç©ºé—´å¤§å°ã€‚</li>
<li>-Xssè®¾ç½®æ¯ä¸ªçº¿ç¨‹çš„å †æ ˆå¤§å°ã€‚</li>
</ul>

<h4 id="toc_4">å †</h4>

<p>å‡ ä¹æ‰€æœ‰çš„å¯¹è±¡å®ä¾‹éƒ½åœ¨è¿™é‡Œåˆ†é…å†…å­˜</p>

<h4 id="toc_5">æ–¹æ³•åŒº</h4>

<p>å„çº¿ç¨‹å…±äº«</p>

<p><strong>1.6åŠä¹‹å‰ç‰ˆæœ¬</strong></p>

<ul>
<li>ç±»ä¿¡æ¯ã€ç±»æ–¹æ³•ç­‰</li>
<li>è¿è¡Œæ—¶å¸¸é‡æ± ï¼ˆåŒ…å«å­—ç¬¦ä¸²å¸¸é‡æ± ï¼‰</li>
<li>é™æ€å˜é‡å’Œå…¨å±€å˜é‡ç­‰</li>
<li>ç¬¦å·å¼•ç”¨</li>
</ul>

<p><strong>1.7ç‰ˆæœ¬</strong></p>

<ul>
<li>é™æ€å˜é‡å’Œå­—ç¬¦ä¸²å¸¸é‡æ± è¢«ç§»åˆ°å †ä¸­</li>
<li>ç¬¦å·å¼•ç”¨è¢«ç§»åˆ°æœ¬åœ°å †ä¸­</li>
</ul>

<p><strong>1.8ç‰ˆæœ¬</strong></p>

<ul>
<li>åŸºæœ¬ä¸ŠåªåŒ…å«ç±»ä¿¡æ¯</li>
</ul>

<p><img src="media/15980814209679/15980825256187.jpg" alt=""/></p>

<h4 id="toc_6">ç¨‹åºè®¡æ•°å™¨</h4>

<p>åŒæ±‡ç¼–ä¸­çš„ PC å¯„å­˜å™¨ï¼Œå­˜å‚¨ä¸‹ä¸€æ¡è¦æ‰§è¡Œçš„æŒ‡ä»¤ä½ç½®ï¼Œç†è®ºä¸Šæ¯ä¸ªçº¿ç¨‹éœ€è¦æœ‰ä¸€ä¸ª</p>

<h4 id="toc_7">JVMæ ˆ</h4>

<p>æ¯ä¸ªæ–¹æ³•è¢«æ‰§è¡Œçš„æ—¶å€™éƒ½ä¼šåŒæ—¶åˆ›å»ºä¸€ä¸ªæ ˆå¸§ï¼ˆStack Frameï¼‰ç”¨äºå­˜å‚¨å±€éƒ¨å˜é‡è¡¨ã€æ“ä½œæ ˆã€åŠ¨æ€é“¾æ¥ã€æ–¹æ³•å‡ºå£ç­‰ä¿¡æ¯ã€‚</p>

<p>æ¯ä¸€ä¸ªæ–¹æ³•è¢«è°ƒç”¨ç›´è‡³æ‰§è¡Œå®Œæˆçš„è¿‡ç¨‹ï¼Œå°±å¯¹åº”ç€ä¸€ä¸ªæ ˆå¸§åœ¨è™šæ‹Ÿæœºæ ˆä¸­ä»å…¥æ ˆåˆ°å‡ºæ ˆçš„è¿‡ç¨‹ã€‚</p>

<p><strong>å±€éƒ¨å˜é‡è¡¨</strong></p>

<ul>
<li>åŸºæœ¬ç±»å‹çš„å±€éƒ¨å˜é‡</li>
<li>éåŸºæœ¬ç±»å‹å¯¹è±¡çš„å¼•ç”¨æŒ‡é’ˆ</li>
</ul>

<h4 id="toc_8">å…³äºæ°¸ä¹…ä»£ã€æ–¹æ³•åŒºã€å…ƒç©ºé—´</h4>

<p><strong>1.7 ç‰ˆæœ¬å‰ï¼š</strong></p>

<p>ä»HotSpotè™šæ‹Ÿæœºå®ç°ä¸Šæ¥è¯´ï¼Œæ–¹æ³•åŒºå­˜åœ¨äºæ°¸ä¹…ä»£ä¸­ã€‚ä»è§„èŒƒä¸Šæ¥è®²æ²¡æœ‰æ°¸ä¹…ä»£è¿™ä¸€æ¦‚å¿µã€‚</p>

<p>æ°¸ä¹…ä»£çš„å†å²åŸå› æ˜¯ï¼šHotSpotè™šæ‹Ÿæœºçš„å®ç°ä¸Šï¼Œæ— è®ºè€å¹´ä»£ã€è¿˜æ˜¯æ–¹æ³•åŒºå†…å­˜æ»¡äº†ï¼Œéƒ½ä¼šè§¦å‘æ–¹æ³•åŒºå’Œè€å¹´ä»£çš„GCï¼Œå› æ­¤ç§°ä¹‹ä¸ºæ°¸ä¹…ä»£</p>

<p>æ°¸ä¹…ä»£ä¸å †éš”ç¦»ï¼Œä½†ç‰©ç†å†…å­˜ä¸Šè¿ç»­</p>

<p><strong>1.8 ç‰ˆæœ¬ï¼š</strong></p>

<p>æ–¹æ³•åŒºå­˜åœ¨äºå…ƒç©ºé—´ä¸­ï¼Œå…ƒç©ºé—´å­˜åœ¨äºæœ¬åœ°å†…å­˜ä¸­</p>

<ul>
<li><p>-XX:MetaspaceSizeï¼Œclass metadataçš„åˆå§‹ç©ºé—´é…é¢ï¼Œä»¥bytesä¸ºå•ä½ï¼Œè¾¾åˆ°è¯¥å€¼å°±ä¼šè§¦å‘åƒåœ¾æ”¶é›†è¿›è¡Œç±»å‹å¸è½½ï¼ŒåŒæ—¶GCä¼šå¯¹è¯¥å€¼è¿›è¡Œè°ƒæ•´ï¼šå¦‚æœé‡Šæ”¾äº†å¤§é‡çš„ç©ºé—´ï¼Œå°±é€‚å½“çš„é™ä½è¯¥å€¼ï¼›å¦‚æœé‡Šæ”¾äº†å¾ˆå°‘çš„ç©ºé—´ï¼Œé‚£ä¹ˆåœ¨ä¸è¶…è¿‡MaxMetaspaceSizeï¼ˆå¦‚æœè®¾ç½®äº†çš„è¯ï¼‰ï¼Œé€‚å½“çš„æé«˜è¯¥å€¼ã€‚</p></li>
<li><p>-XXï¼šMaxMetaspaceSizeï¼Œå¯ä»¥ä¸ºclass metadataåˆ†é…çš„æœ€å¤§ç©ºé—´ã€‚é»˜è®¤æ˜¯æ²¡æœ‰é™åˆ¶çš„ã€‚</p></li>
<li><p>-XXï¼šMinMetaspaceFreeRatioï¼Œåœ¨GCä¹‹åï¼Œæœ€å°çš„Metaspaceå‰©ä½™ç©ºé—´å®¹é‡çš„ç™¾åˆ†æ¯”ï¼Œå‡å°‘ä¸ºclass metadataåˆ†é…ç©ºé—´å¯¼è‡´çš„åƒåœ¾æ”¶é›†ã€‚</p></li>
<li><p>-XX:MaxMetaspaceFreeRatioï¼Œåœ¨GCä¹‹åï¼Œæœ€å¤§çš„Metaspaceå‰©ä½™ç©ºé—´å®¹é‡çš„ç™¾åˆ†æ¯”ï¼Œå‡å°‘ä¸ºclass metadataé‡Šæ”¾ç©ºé—´å¯¼è‡´çš„åƒåœ¾æ”¶é›†ã€‚</p></li>
</ul>

<p><strong>ä¸ºä»€ä¹ˆæ›¿ä»£</strong></p>

<p>æ—§æ–¹æ³•ä¸­ï¼Œæ°¸ä¹…ä»£å¤§å°ç”± -XX:PermSizeï¼Œ-XX:MaxPermSizeæŒ‡å®šï¼Œæ— æ³•å‡†ç¡®çŸ¥é“è¯¥è®¾ç½®çš„åˆé€‚å€¼ã€‚</p>

<p>æ–°æ–¹æ³•ä¸­ï¼Œå…ƒç©ºé—´ç§»åˆ°äº†æœ¬åœ°å†…å­˜ï¼Œå¯ä»¥ç”±ç³»ç»Ÿå®é™…å‰©ä½™å†…å­˜æ§åˆ¶</p>

<h2 id="toc_9">ç±»åŠ è½½æœºåˆ¶</h2>

<p><img src="https://img-blog.csdnimg.cn/2020031416414486.jpeg?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L1RoaW5rV29u,size_16,color_FFFFFF,t_70" alt=""/></p>

<h4 id="toc_10">åŠ è½½è¿‡ç¨‹</h4>

<p><img src="media/15980814209679/15980830126011.jpg" alt=""/></p>

<p><strong>åŠ è½½ï¼šåŠ è½½å¯¹åº”çš„.classæ–‡ä»¶ï¼Œå¹¶åˆ†é…å†…å­˜å’Œå¯¹è±¡</strong></p>

<ul>
<li><p>é€šè¿‡ä¸€ä¸ªç±»çš„å…¨é™å®šåæ¥è·å–å…¶å®šä¹‰çš„äºŒè¿›åˆ¶å­—èŠ‚æµã€‚</p></li>
<li><p>å°†è¿™ä¸ªå­—èŠ‚æµæ‰€ä»£è¡¨çš„é™æ€å­˜å‚¨ç»“æ„è½¬åŒ–ä¸ºæ–¹æ³•åŒºçš„è¿è¡Œæ—¶æ•°æ®ç»“æ„ã€‚</p></li>
<li><p>åœ¨Javaå †ä¸­ç”Ÿæˆä¸€ä¸ªä»£è¡¨è¿™ä¸ªç±»çš„ java.lang.Classå¯¹è±¡ï¼Œä½œä¸ºå¯¹æ–¹æ³•åŒºä¸­è¿™äº›æ•°æ®çš„è®¿é—®å…¥å£ã€‚</p></li>
</ul>

<p><strong>éªŒè¯ï¼šéªŒè¯ç±»æ ¼å¼æ˜¯å¦åˆæ³•</strong></p>

<ul>
<li><p>æ–‡ä»¶æ ¼å¼éªŒè¯ï¼šéªŒè¯å­—èŠ‚æµæ˜¯å¦ç¬¦åˆClassæ–‡ä»¶æ ¼å¼çš„è§„èŒƒï¼›ä¾‹å¦‚ï¼šæ˜¯å¦ä»¥ 0xCAFEBABEå¼€å¤´ã€ä¸»æ¬¡ç‰ˆæœ¬å·æ˜¯å¦åœ¨å½“å‰è™šæ‹Ÿæœºçš„å¤„ç†èŒƒå›´ä¹‹å†…ã€å¸¸é‡æ± ä¸­çš„å¸¸é‡æ˜¯å¦æœ‰ä¸è¢«æ”¯æŒçš„ç±»å‹ã€‚</p></li>
<li><p>å…ƒæ•°æ®éªŒè¯ï¼šå¯¹å­—èŠ‚ç æè¿°çš„ä¿¡æ¯è¿›è¡Œè¯­ä¹‰åˆ†æï¼ˆæ³¨æ„ï¼šå¯¹æ¯”javacç¼–è¯‘é˜¶æ®µçš„è¯­ä¹‰åˆ†æï¼‰ï¼Œä»¥ä¿è¯å…¶æè¿°çš„ä¿¡æ¯ç¬¦åˆJavaè¯­è¨€è§„èŒƒçš„è¦æ±‚ï¼›ä¾‹å¦‚ï¼šè¿™ä¸ªç±»æ˜¯å¦æœ‰çˆ¶ç±»ï¼Œé™¤äº† java.lang.Objectä¹‹å¤–ã€‚</p></li>
<li><p>å­—èŠ‚ç éªŒè¯ï¼šé€šè¿‡æ•°æ®æµå’Œæ§åˆ¶æµåˆ†æï¼Œç¡®å®šç¨‹åºè¯­ä¹‰æ˜¯åˆæ³•çš„ã€ç¬¦åˆé€»è¾‘çš„ã€‚</p></li>
<li><p>ç¬¦å·å¼•ç”¨éªŒè¯ï¼šç¡®ä¿è§£æåŠ¨ä½œèƒ½æ­£ç¡®æ‰§è¡Œã€‚</p></li>
</ul>

<p><strong>å‡†å¤‡ï¼šä¸ºç±»çš„é™æ€å˜é‡åˆ†é…å†…å­˜ï¼Œå¹¶å°†å…¶åˆå§‹åŒ–ä¸ºé»˜è®¤å€¼</strong></p>

<ul>
<li><p>å‡†å¤‡é˜¶æ®µæ˜¯æ­£å¼ä¸ºç±»å˜é‡åˆ†é…å†…å­˜å¹¶è®¾ç½®ç±»å˜é‡åˆå§‹å€¼çš„é˜¶æ®µï¼Œè¿™äº›å†…å­˜éƒ½å°†åœ¨æ–¹æ³•åŒºä¸­åˆ†é…ã€‚å¯¹äºè¯¥é˜¶æ®µæœ‰ä»¥ä¸‹å‡ ç‚¹éœ€è¦æ³¨æ„ï¼š</p></li>
<li><p>è¿™æ—¶å€™è¿›è¡Œå†…å­˜åˆ†é…çš„ä»…åŒ…æ‹¬ç±»å˜é‡ï¼ˆstaticï¼‰ï¼Œè€Œä¸åŒ…æ‹¬å®ä¾‹å˜é‡ï¼Œå®ä¾‹å˜é‡ä¼šåœ¨å¯¹è±¡å®ä¾‹åŒ–æ—¶éšç€å¯¹è±¡ä¸€å—åˆ†é…åœ¨Javaå †ä¸­ã€‚</p></li>
<li><p>è¿™é‡Œæ‰€è®¾ç½®çš„åˆå§‹å€¼é€šå¸¸æƒ…å†µä¸‹æ˜¯æ•°æ®ç±»å‹é»˜è®¤çš„é›¶å€¼ï¼ˆå¦‚0ã€0Lã€nullã€falseç­‰ï¼‰ï¼Œè€Œä¸æ˜¯è¢«åœ¨Javaä»£ç ä¸­è¢«æ˜¾å¼åœ°èµ‹äºˆçš„å€¼</p></li>
<li><p>public static int value = 3ï¼Œå‡†å¤‡åå…¶å€¼ä¸º 0</p></li>
<li><p>public final static int value = 3ï¼Œå‡†å¤‡åå…¶å€¼ä¸º 3</p></li>
</ul>

<p><strong>è§£æï¼šæŠŠç±»ä¸­çš„ç¬¦å·å¼•ç”¨è½¬æ¢ä¸ºç›´æ¥å¼•ç”¨</strong></p>

<ul>
<li><p>è§£æé˜¶æ®µæ˜¯è™šæ‹Ÿæœºå°†å¸¸é‡æ± å†…çš„ç¬¦å·å¼•ç”¨æ›¿æ¢ä¸ºç›´æ¥å¼•ç”¨çš„è¿‡ç¨‹ï¼Œè§£æåŠ¨ä½œä¸»è¦é’ˆå¯¹ç±»æˆ–æ¥å£ã€å­—æ®µã€ç±»æ–¹æ³•ã€æ¥å£æ–¹æ³•ã€æ–¹æ³•ç±»å‹ã€æ–¹æ³•å¥æŸ„å’Œè°ƒç”¨ç‚¹é™å®šç¬¦7ç±»ç¬¦å·å¼•ç”¨è¿›è¡Œã€‚ç¬¦å·å¼•ç”¨å°±æ˜¯ä¸€ç»„ç¬¦å·æ¥æè¿°ç›®æ ‡ï¼Œå¯ä»¥æ˜¯ä»»ä½•å­—é¢é‡ã€‚</p></li>
<li><p>ç›´æ¥å¼•ç”¨å°±æ˜¯ç›´æ¥æŒ‡å‘ç›®æ ‡çš„æŒ‡é’ˆã€ç›¸å¯¹åç§»é‡æˆ–ä¸€ä¸ªé—´æ¥å®šä½åˆ°ç›®æ ‡çš„å¥æŸ„</p></li>
</ul>

<p><strong>åˆå§‹åŒ–ï¼šä¸ºé™æ€æˆå‘˜å˜é‡èµ‹äºˆåˆå§‹å€¼</strong></p>

<p>åˆå§‹åŒ–ï¼Œä¸ºç±»çš„<strong>é™æ€å˜é‡</strong>èµ‹äºˆæ­£ç¡®çš„åˆå§‹å€¼ï¼ŒJVMè´Ÿè´£å¯¹ç±»è¿›è¡Œåˆå§‹åŒ–ï¼Œä¸»è¦å¯¹ç±»å˜é‡è¿›è¡Œåˆå§‹åŒ–ã€‚åœ¨Javaä¸­å¯¹ç±»å˜é‡è¿›è¡Œåˆå§‹å€¼è®¾å®šæœ‰ä¸¤ç§æ–¹å¼ï¼š</p>

<ol>
<li>å£°æ˜ç±»å˜é‡æ˜¯æŒ‡å®šåˆå§‹å€¼</li>
<li>ä½¿ç”¨é™æ€ä»£ç å—ä¸ºç±»å˜é‡æŒ‡å®šåˆå§‹å€¼</li>
</ol>

<p>JVMåˆå§‹åŒ–æ­¥éª¤</p>

<ol>
<li>å‡å¦‚è¿™ä¸ªç±»è¿˜æ²¡æœ‰è¢«åŠ è½½å’Œè¿æ¥ï¼Œåˆ™ç¨‹åºå…ˆåŠ è½½å¹¶è¿æ¥è¯¥ç±»</li>
<li>å‡å¦‚è¯¥ç±»çš„ç›´æ¥çˆ¶ç±»è¿˜æ²¡æœ‰è¢«åˆå§‹åŒ–ï¼Œåˆ™å…ˆåˆå§‹åŒ–å…¶ç›´æ¥çˆ¶ç±»</li>
<li>å‡å¦‚ç±»ä¸­æœ‰åˆå§‹åŒ–è¯­å¥ï¼Œåˆ™ç³»ç»Ÿä¾æ¬¡æ‰§è¡Œè¿™äº›åˆå§‹åŒ–è¯­å¥</li>
</ol>

<p>ç±»åˆå§‹åŒ–æ—¶æœºï¼šåªæœ‰å½“å¯¹ç±»çš„ä¸»åŠ¨ä½¿ç”¨çš„æ—¶å€™æ‰ä¼šå¯¼è‡´ç±»çš„åˆå§‹åŒ–ï¼Œç±»çš„ä¸»åŠ¨ä½¿ç”¨åŒ…æ‹¬ä»¥ä¸‹å…­ç§ï¼š</p>

<ul>
<li>åˆ›å»ºç±»çš„å®ä¾‹ï¼Œä¹Ÿå°±æ˜¯newçš„æ–¹å¼</li>
<li>è®¿é—®æŸä¸ªç±»æˆ–æ¥å£çš„é™æ€å˜é‡ï¼Œæˆ–è€…å¯¹è¯¥é™æ€å˜é‡èµ‹å€¼</li>
<li>è°ƒç”¨ç±»çš„é™æ€æ–¹æ³•</li>
<li>åå°„ï¼ˆå¦‚ Class.forName(â€œcom.shengsiyuan.Testâ€)ï¼‰</li>
<li>åˆå§‹åŒ–æŸä¸ªç±»çš„å­ç±»ï¼Œåˆ™å…¶çˆ¶ç±»ä¹Ÿä¼šè¢«åˆå§‹åŒ–</li>
<li>Javaè™šæ‹Ÿæœºå¯åŠ¨æ—¶è¢«æ ‡æ˜ä¸ºå¯åŠ¨ç±»çš„ç±»ï¼ˆ JavaTestï¼‰ï¼Œç›´æ¥ä½¿ç”¨ java.exeå‘½ä»¤æ¥è¿è¡ŒæŸä¸ªä¸»ç±»</li>
</ul>

<p><strong>æ³¨æ„</strong><br/>
ç±»çš„éé™æ€æˆå‘˜å˜é‡ï¼Œåªæœ‰åœ¨åˆ›å»ºå®ä¾‹æ—¶ï¼Œæ‰ä¼šè¢«åˆå§‹åŒ–åˆ°å †ä¸­</p>

<h4 id="toc_11">åŠ è½½å™¨</h4>

<p><img src="media/15980814209679/15980841148150.jpg" alt=""/></p>

<p><strong>å¯åŠ¨ç±»åŠ è½½å™¨</strong>ï¼š BootstrapClassLoaderï¼ŒåŠ è½½è™šæ‹Ÿæœºç±»åº“ï¼Œæœ¬åœ°æ–¹æ³•<br/>
<strong>æ‰©å±•ç±»åŠ è½½å™¨</strong>ï¼š ExtensionClassLoaderï¼ŒåŠ è½½ç³»ç»Ÿç±»åº“<br/>
<strong>åº”ç”¨ç¨‹åºç±»åŠ è½½å™¨</strong>ï¼šApplicationClassLoaderï¼ŒåŠ è½½ç”¨æˆ·ç±»çš„è·¯å¾„</p>

<h4 id="toc_12">åŠ è½½æœºåˆ¶</h4>

<p><strong>å…¨ç›˜è´Ÿè´£</strong><br/>
å½“ä¸€ä¸ªç±»åŠ è½½å™¨è´Ÿè´£åŠ è½½æŸä¸ªClassæ—¶ï¼Œè¯¥Classæ‰€ä¾èµ–çš„å’Œå¼•ç”¨çš„å…¶ä»–Classä¹Ÿå°†ç”±è¯¥ç±»åŠ è½½å™¨è´Ÿè´£è½½å…¥ï¼Œé™¤éæ˜¾ç¤ºä½¿ç”¨å¦å¤–ä¸€ä¸ªç±»åŠ è½½å™¨æ¥è½½å…¥</p>

<p><strong>åŒäº²å§”æ´¾</strong><br/>
å…ˆè®©çˆ¶ç±»åŠ è½½å™¨è¯•å›¾åŠ è½½è¯¥ç±»ï¼Œåªæœ‰åœ¨çˆ¶ç±»åŠ è½½å™¨æ— æ³•åŠ è½½è¯¥ç±»æ—¶æ‰å°è¯•ä»è‡ªå·±çš„ç±»è·¯å¾„ä¸­åŠ è½½è¯¥ç±»</p>

<p><strong>ç¼“å­˜æœºåˆ¶</strong><br/>
ç¼“å­˜æœºåˆ¶å°†ä¼šä¿è¯æ‰€æœ‰åŠ è½½è¿‡çš„Classéƒ½ä¼šè¢«ç¼“å­˜ï¼Œå½“ç¨‹åºä¸­éœ€è¦ä½¿ç”¨æŸä¸ªClassæ—¶ï¼Œç±»åŠ è½½å™¨å…ˆä»ç¼“å­˜åŒºå¯»æ‰¾è¯¥Classï¼Œåªæœ‰ç¼“å­˜åŒºä¸å­˜åœ¨ï¼Œç³»ç»Ÿæ‰ä¼šè¯»å–è¯¥ç±»å¯¹åº”çš„äºŒè¿›åˆ¶æ•°æ®ï¼Œå¹¶å°†å…¶è½¬æ¢æˆClasså¯¹è±¡ï¼Œå­˜å…¥ç¼“å­˜åŒºã€‚è¿™å°±æ˜¯ä¸ºä»€ä¹ˆä¿®æ”¹äº†Classåï¼Œå¿…é¡»é‡å¯JVMï¼Œç¨‹åºçš„ä¿®æ”¹æ‰ä¼šç”Ÿæ•ˆ</p>

<h2 id="toc_13">åƒåœ¾å›æ”¶ç®—æ³•</h2>

<h3 id="toc_14">å¯¹è±¡å­˜æ´»åˆ¤æ–­</h3>

<p><strong>å¼•ç”¨è®¡æ•°</strong>ï¼š<br/>
æœ‰å¾ªç¯å¼•ç”¨é—®é¢˜</p>

<p><strong>å¯è¾¾æ€§åˆ†æ</strong><br/>
GC Rootsï¼š</p>

<ul>
<li>è™šæ‹Ÿæœºæ ˆä¸­å¼•ç”¨çš„å¯¹è±¡ã€‚</li>
<li>æœ¬åœ°æ–¹æ³•æ ˆä¸­JNIå¼•ç”¨çš„å¯¹è±¡ã€‚</li>
<li>æ–¹æ³•åŒºä¸­ç±»é™æ€å±æ€§å®ä½“å¼•ç”¨çš„å¯¹è±¡ã€‚</li>
<li>æ–¹æ³•åŒºä¸­å¸¸é‡å¼•ç”¨çš„å¯¹è±¡ã€‚</li>
</ul>

<h3 id="toc_15">åƒåœ¾æ”¶é›†ç®—æ³•</h3>

<h4 id="toc_16">æ ‡è®° - æ¸…é™¤ç®—æ³•</h4>

<p>è¿‡ç¨‹ï¼š</p>

<ul>
<li>æ ‡è®°ä¸éœ€è¦çš„å¯¹è±¡</li>
<li>æ¸…é™¤</li>
</ul>

<p>ç‰¹ç‚¹ï¼š</p>

<ul>
<li>æ ‡è®°æ•ˆç‡ä¸é«˜</li>
<li>æ¸…é™¤åäº§ç”Ÿå¤§é‡å†…å­˜ç¢ç‰‡</li>
</ul>

<h4 id="toc_17">å¤åˆ¶ç®—æ³•</h4>

<p>è¿‡ç¨‹ï¼š</p>

<ul>
<li>å†…å­˜åˆ†ä¸ºä¸¤å—</li>
<li>å°†ä¸€å—ä¸­çš„å­˜æ´»å¯¹è±¡ï¼Œå¤åˆ¶åˆ°å¦ä¸€åŠ</li>
</ul>

<p>ç‰¹ç‚¹ï¼š</p>

<ul>
<li>æ²¡æœ‰å†…å­˜ç¢ç‰‡</li>
<li>å†…å­˜åˆ©ç”¨ç‡ä¸é«˜</li>
<li>å­˜æ´»å¯¹è±¡å¤šæ—¶è¦å¤åˆ¶å¤§é‡æ•°æ®ï¼Œæ€§èƒ½æ…¢ã€‚é€‚åˆäºæ–°ç”Ÿä»£ï¼Œå­˜æ´»å¯¹è±¡å¾ˆå°‘çš„æƒ…å†µ</li>
</ul>

<h4 id="toc_18">æ ‡è®° - å‹ç¼©/æ•´ç†ç®—æ³•</h4>

<p>è¿‡ç¨‹ï¼š</p>

<ul>
<li>æ ‡è®°</li>
<li>å‘ä¸€ç«¯ç§»åŠ¨</li>
</ul>

<h4 id="toc_19">åˆ†ä»£æ”¶é›†ç®—æ³•</h4>

<p>å³æ ¹æ®æ–°ç”Ÿä»£ã€è€å¹´ä»£ç‰¹æ€§ï¼Œé‡‡ç”¨ä¸åŒçš„æ”¶é›†ç®—æ³•</p>

<h3 id="toc_20">åƒåœ¾æ”¶é›†å™¨</h3>

<h4 id="toc_21">Serialæ”¶é›†å™¨</h4>

<p>æœ€å¤è€ç‰ˆæœ¬</p>

<p>ç‰¹ç‚¹ï¼š</p>

<ul>
<li>å•çº¿ç¨‹å›æ”¶</li>
<li>æ–°ç”Ÿä»£å¤åˆ¶ï¼Œè€å¹´ä»£æ ‡è®°-å‹ç¼©</li>
<li>è¿‡ç¨‹ä¸­ STW</li>
</ul>

<p>ä½¿ç”¨ï¼š-XX:+UseSerialGC</p>

<h4 id="toc_22">ParNewæ”¶é›†å™¨</h4>

<p>Serialæ”¶é›†å™¨å¹¶è¡Œç‰ˆæœ¬</p>

<p>ç‰¹ç‚¹ï¼š</p>

<ul>
<li>æ–°ç”Ÿä»£å¤šçº¿ç¨‹å¤åˆ¶</li>
<li>è€å¹´ä»£ä¸²è¡Œæ ‡è®°-å‹ç¼©</li>
</ul>

<p>ä½¿ç”¨ï¼š-XX:+UseParNewGC</p>

<h4 id="toc_23">Parallel</h4>

<p>ç±»ä¼¼äºParNewï¼Œæ›´å…³æ³¨ç³»ç»Ÿååé‡</p>

<p>å¯ä»¥é€šè¿‡å‚æ•°æ¥æ‰“å¼€è‡ªé€‚åº”è°ƒèŠ‚ç­–ç•¥ï¼Œè™šæ‹Ÿæœºä¼šæ ¹æ®å½“å‰ç³»ç»Ÿçš„è¿è¡Œæƒ…å†µæ”¶é›†æ€§èƒ½ç›‘æ§ä¿¡æ¯ï¼ŒåŠ¨æ€è°ƒæ•´è¿™äº›å‚æ•°ä»¥æä¾›æœ€åˆé€‚çš„åœé¡¿æ—¶é—´æˆ–æœ€å¤§çš„ååé‡ï¼›ä¹Ÿå¯ä»¥é€šè¿‡å‚æ•°æ§åˆ¶GCçš„æ—¶é—´ä¸å¤§äºå¤šå°‘æ¯«ç§’æˆ–è€…æ¯”ä¾‹ï¼›æ–°ç”Ÿä»£å¤åˆ¶ç®—æ³•ã€è€å¹´ä»£æ ‡è®°-å‹ç¼©</p>

<p>ä½¿ç”¨ï¼š-XX:+UseParallelGC è€å¹´ä»£ä¸²è¡Œ</p>

<h4 id="toc_24">Parallel Old æ”¶é›†å™¨</h4>

<p>Parallelçš„è€å¹´ä»£ç‰ˆæœ¬ï¼Œè€å¹´ä»£å¹¶è¡Œæ ‡è®° - å‹ç¼©</p>

<p>ä½¿ç”¨ï¼š-XX:+UseParallelOldGC ä½¿ç”¨Parallelæ”¶é›†å™¨ + è€å¹´ä»£å¹¶è¡Œ</p>

<h4 id="toc_25">CMSæ”¶é›†å™¨</h4>

<p>Concurrent Mark Sweepï¼šå¹¶è¡Œæ ‡è®°æ¸…é™¤</p>

<p>ç›®æ ‡ï¼šè¿½æ±‚æœ€çŸ­åœé¡¿æ—¶é—´</p>

<p>è¿‡ç¨‹ï¼š</p>

<ul>
<li>è§¦å‘æ¡ä»¶
<ul>
<li>è€å¹´ä»£ã€æ°¸ä¹…ä»£ä½¿ç”¨ç‡è¾¾åˆ°92%</li>
<li>æ–°ç”Ÿä»£æ²¡æœ‰è¶³å¤Ÿçš„ç©ºé—´æ™‹å‡ä¸ºè€å¹´ä»£</li>
</ul></li>
<li>åˆå§‹æ ‡è®°
<ul>
<li>STW</li>
<li>æ ‡è®°GC rootsç›´æ¥å…³è”çš„è€å¹´ä»£å¯¹è±¡ã€æ ‡è®°æ–°ç”Ÿä»£å¯è¾¾çš„è€å¹´ä»£å¯¹è±¡</li>
<li>é€Ÿåº¦å¿«</li>
</ul></li>
<li>å¹¶å‘æ ‡è®°
<ul>
<li>é€’å½’æ ‡è®°ä¸Šä¸€æ­¥éª¤ä¸­ï¼Œå·²æ ‡è®°å¯¹è±¡çš„å†…éƒ¨å¯å¼•ç”¨å¯¹è±¡</li>
<li>å¹¶å‘æ ‡è®°è¿‡ç¨‹ä¸­å‘ç”Ÿå˜åŒ–çš„ï¼Œè®°å·ä¸ºdirty</li>
<li>æ—¶é—´é•¿ï¼Œä½†å¹¶å‘æ‰§è¡Œ</li>
</ul></li>
<li>å¹¶å‘é¢„æ¸…ç†
<ul>
<li>æ ‡è®°æ–°ç”Ÿä»£ä¸­çš„æ–°å‡ºç°å¯¹è±¡å¼•ç”¨çš„è€å¹´ä»£å¯¹è±¡ï¼Œæ–°æ™‹å‡çš„è€å¹´ä»£å¯¹è±¡</li>
<li>æ‰«æä¸Šä¸€é˜¶æ®µä¸­çš„dirtyå¯¹è±¡ï¼Œé‡æ–°å¤„ç†</li>
<li>å¾ªç¯ç›´è‡³è¾¾åˆ°æœ€å¤§å¾ªç¯æ¬¡æ•°ï¼ˆé»˜è®¤æ— ï¼‰ï¼Œæœ€é•¿æ—¶é—´ï¼ˆé»˜è®¤5ç§’ï¼‰</li>
<li>ç›®çš„æ˜¯å°½é‡å‡å°‘ä¸‹ä¸€é˜¶æ®µçš„æš‚åœæ—¶é—´</li>
</ul></li>
<li>é‡æ–°æ ‡è®°
<ul>
<li>STW</li>
<li>ä¿®æ­£å¹¶å‘æ ‡è®°æœŸé—´ï¼Œå› ç¨‹åºè¿ä½œå¯¼è‡´çš„è¯¯å·®
<ul>
<li>é‡æ–°æ‰«ææ–°ç”Ÿä»£</li>
<li>é‡æ–°æ‰«ç GC rootså¯è¾¾å¯¹è±¡</li>
<li>å¤„ç†æ ‡è®°ä¸ºdirtyçš„å¯¹è±¡</li>
</ul></li>
<li>æ—¶é—´ä¸­ç­‰</li>
</ul></li>
<li>å¹¶å‘æ¸…é™¤
<ul>
<li>ä¸ä¼šSTW</li>
</ul></li>
</ul>

<p>ä¼˜ç‚¹ï¼š</p>

<ul>
<li>å¹¶å‘æ”¶é›†ï¼Œä½åœé¡¿</li>
</ul>

<p>ç¼ºç‚¹ï¼š</p>

<ul>
<li>æ ‡è®° - æ¸…é™¤ç®—æ³•ä¼šäº§ç”Ÿå¤§é‡ç¢ç‰‡ã€å¹¶å‘é˜¶æ®µä¼šé™ä½ååé‡</li>
</ul>

<p>å‚æ•°ä½¿ç”¨ï¼š</p>

<ul>
<li>-XX:+UseConcMarkSweepGC ä½¿ç”¨CMSæ”¶é›†å™¨</li>
<li>-XX:+ UseCMSCompactAtFullCollection Full GCåï¼Œè¿›è¡Œä¸€æ¬¡ç¢ç‰‡æ•´ç†ï¼›æ•´ç†è¿‡ç¨‹æ˜¯ç‹¬å çš„ï¼Œä¼šå¼•èµ·åœé¡¿æ—¶é—´å˜é•¿</li>
<li>-XX:+CMSFullGCsBeforeCompaction è®¾ç½®è¿›è¡Œå‡ æ¬¡Full GCåï¼Œè¿›è¡Œä¸€æ¬¡ç¢ç‰‡æ•´ç†</li>
<li>-XX:ParallelCMSThreads è®¾å®šCMSçš„çº¿ç¨‹æ•°é‡ï¼ˆä¸€èˆ¬æƒ…å†µçº¦ç­‰äºå¯ç”¨CPUæ•°é‡ï¼‰</li>
</ul>

<h4 id="toc_26">G1æ”¶é›†å™¨</h4>

<p>ç‰¹ç‚¹ï¼š</p>

<ul>
<li>æ ‡è®° - å‹ç¼©ï¼Œä¸ä¼šäº§ç”Ÿç¢ç‰‡</li>
<li>å°†å†…å­˜åˆ’åˆ†ä¸ºè‹¥å¹²åŒºåŸŸï¼Œæ–°ç”Ÿä»£ã€è€å¹´ä»£ç­‰æ˜¯å„ä¸ªåŒºåŸŸçš„ç»„åˆ</li>
<li>æ¯ä¸ªåŒºå—ä¸€ä¸ªrememberd setï¼Œè®°å½•è¿›å…¥çš„æŒ‡é’ˆ</li>
<li>é¢„æµ‹å„åŒºå—çš„å›æ”¶æ—¶é—´ï¼Œå›æ”¶éƒ¨åˆ†åŒºå—ï¼Œä»è€Œè¾¾åˆ°å¯é¢„æµ‹æ—¶é—´çš„ç›®çš„</li>
</ul>

<p><img src="media/15980814209679/15980908684125.jpg" alt=""/></p>

<p><img src="media/15980814209679/15981482084026.jpg" alt=""/></p>

<h3 id="toc_27">GCè°ƒä¼˜å·¥å…·</h3>

<h4 id="toc_28">è‡ªå¸¦å›¾å½¢å·¥å…·</h4>

<ul>
<li>jconsole</li>
<li>jvisualvm</li>
</ul>

<h4 id="toc_29">å‘½ä»¤è¡Œå·¥å…·</h4>

<ul>
<li><p>jpsï¼šæ‰“å°java process status</p>
<p><img src="media/15980814209679/15980939009037.jpg" alt="" style="width:303px;"/></p></li>
<li><p>jstatï¼š</p>
<ul>
<li>JVM statistics Monitoring</li>
<li>ç”¨äºç›‘è§†è™šæ‹Ÿæœºè¿è¡Œæ—¶çŠ¶æ€ä¿¡æ¯çš„å‘½ä»¤ï¼Œå®ƒå¯ä»¥æ˜¾ç¤ºå‡ºè™šæ‹Ÿæœºè¿›ç¨‹ä¸­çš„ç±»è£…è½½ã€å†…å­˜ã€åƒåœ¾æ”¶é›†ã€JITç¼–è¯‘ç­‰è¿è¡Œæ•°æ®</li>
</ul></li>
</ul>

<p><img src="media/15980814209679/15980939723822.jpg" alt="" style="width:411px;"/></p>

<ul>
<li>jmapï¼šç”Ÿæˆå †å¿«ç…§</li>
<li>jhatï¼šåˆ†æå †å¿«ç…§</li>
<li>jstackï¼šç”Ÿæˆçº¿ç¨‹å¿«ç…§</li>
<li>jinfoï¼šæŸ¥çœ‹è™šæ‹Ÿæœºå‚æ•°</li>
</ul>

<h4 id="toc_30">GCä¼˜åŒ–</h4>

<ul>
<li>-Xms -Xmxè°ƒæ•´åˆå§‹å †å¤§å°å’Œæœ€å¤§å †å¤§å°é€‚é…æœºå™¨å†…å­˜å¤§å°</li>
</ul>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[ForkJoinPool ç›¸å…³]]></title>
    <link href="https://chenrenyi.github.io/15922331141719.html"/>
    <updated>2020-06-15T22:58:34+08:00</updated>
    <id>https://chenrenyi.github.io/15922331141719.html</id>
    <content type="html"><![CDATA[
<pre><code class="language-java">package fighting.threads;

import java.util.Arrays;
import java.util.List;
import java.util.concurrent.*;

/**
 * ForkJoinPoolå­¦ä¹ 
 * ä¸åŒä¹‹å¤„ï¼š
 * 1ã€æ²¡æœ‰ä¸€ä¸ªå…¬å…±çš„ä»»åŠ¡é˜Ÿåˆ—ï¼Œè€Œæ˜¯æ¯ä¸ªå·¥ä½œçº¿ç¨‹éƒ½æœ‰è‡ªå·±ä¸¤ä¸ªä»»åŠ¡é˜Ÿåˆ—ï¼ˆå¤–éƒ¨å’Œå†…éƒ¨äº§ç”Ÿçš„å­ä»»åŠ¡ï¼‰
 * 2ã€ç›®çš„æ˜¯é¿å…å¤„ç†å¤§é‡çŸ­å¹³å¿«ä»»åŠ¡æ—¶ï¼Œå¯¹å…¬å…±é˜Ÿåˆ—ä»»åŠ¡çš„äº‰æŠ¢å¼•å‘æ€§èƒ½é—®é¢˜ã€‚å³æ¯ä¸ªä»»åŠ¡æ‰§è¡Œéƒ½å¾ˆå¿«ï¼Œä½†å¤šå¹¶å‘æƒ…å†µä¸‹å…¬å…±ä»»åŠ¡é˜Ÿåˆ—pushå’Œpopçš„åŠ é”æˆä¸ºäº†ç“¶é¢ˆ
 *
 * ä¸¤ä¸ªä½œç”¨ï¼š
 * 1ã€åˆ†è€Œæ²»ä¹‹ï¼Œå…è®¸ä»»åŠ¡æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œå†æ¬¡æäº¤å­ä»»åŠ¡ï¼Œä»è€Œç¼©çŸ­æ—¶é—´
 * 2ã€å·¥ä½œçªƒå–ï¼Œçº¿ç¨‹æ± ä¸­å·²å®Œæˆçš„å·¥ä½œçº¿ç¨‹ï¼Œå°†ä¸»åŠ¨è·å–æ‰€æœ‰çº¿ç¨‹é˜Ÿåˆ—ä¸­å·²æäº¤æœªå®Œæˆçš„ä»»åŠ¡æˆ–å­ä»»åŠ¡
 *
 * å¯¹åº”çš„ç±»ï¼š
 * ForkJoinPoolï¼šçº¿ç¨‹æ± 
 * ForkJoinPool.commonï¼šå…¨å±€å…¬ç”¨çš„çº¿ç¨‹æ± 
 * ForkJoinTaskï¼šæœ‰è¿”å›å€¼çš„ä»»åŠ¡
 * ForkJoinActionï¼šæ²¡æœ‰è¿”å›å€¼ä»»åŠ¡
 *
 * ç›¸å…³ç±»ï¼š
 * Executors.newWorkStealingPool()
 * stream.parallelStream()
 */
public class ForkJoinPoolTest {

    /**
     * æµ‹è¯•å…¥å£
     */
    public static void main(String[] args) throws ExecutionException, InterruptedException {
        ForkJoinPool pool = new ForkJoinPool(10);
        ForkJoinTask&lt;Integer&gt; result = pool.submit(new CalcIntegerTask(0, 100000));
        System.out.println(result.get());
        pool.shutdown();

        // é€šè¿‡executorsåˆ›å»ºçº¿ç¨‹æ± 
        Executors.newWorkStealingPool().submit(() -&gt; System.out.println(&quot;a runnable task&quot;));

        // parallelStreamï¼ˆpÃ¦rÉ™lelï¼‰ï¼Œé»˜è®¤ä½¿ç”¨ ForkJoinPool.common
        List&lt;Integer&gt; numbers = Arrays.asList(1, 2, 3, 4, 5, 6, 7, 8, 9);
        numbers.parallelStream().forEach(System.out::println);
    }

}

/**
 * æ•°å­—è®¡ç®—ä»»åŠ¡
 */
class CalcIntegerTask extends RecursiveTask&lt;Integer&gt; {

    private Integer start;

    private Integer end;

    public CalcIntegerTask(Integer start, Integer end) {
        this.start = start;
        this.end = end;
    }

    @Override
    protected Integer compute() {
        int sum = 0;
        if (end - start &lt;= 100) {
            // æ•°æ®é‡å°‘æ—¶ç›´æ¥è®¡ç®—
            for (int i = start; i &lt;= end; i++) {
                sum += i;
            }
        } else {
            // æ•°æ®é‡å¤§æ—¶ï¼Œåˆ†è€Œæ²»ä¹‹ã€‚æ‹†åˆ†å­ä»»åŠ¡æäº¤
            int middle = (end - start) / 2 + start;
            CalcIntegerTask leftTask = new CalcIntegerTask(start, middle);
            CalcIntegerTask rightTask = new CalcIntegerTask(middle + 1, end);

            // å­ä»»åŠ¡éœ€è¦è°ƒç”¨ fork æ–¹æ³•
            leftTask.fork();
            rightTask.fork();

            // ä½¿ç”¨ join æ–¹æ³•ç­‰å¾…å¹¶è·å–å€¼
            sum = leftTask.join() + rightTask.join();
        }

        return sum;
    }
}

</code></pre>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Spring]]></title>
    <link href="https://chenrenyi.github.io/15980950267265.html"/>
    <updated>2020-08-22T19:17:06+08:00</updated>
    <id>https://chenrenyi.github.io/15980950267265.html</id>
    <content type="html"><![CDATA[
<h2 id="toc_0">ä»‹ç»</h2>

<p>Springçš„æ ¸å¿ƒæ˜¯IOCå®¹å™¨å’ŒAOPæ”¯æŒï¼Œé€šè¿‡IOCå®¹å™¨ç®¡ç†å„ç§ç±»ï¼Œé€šè¿‡AOPå¢å¼ºæœåŠ¡</p>

<h2 id="toc_1">IOC æ§åˆ¶åè½¬</h2>

<p>æ¦‚è¿°ï¼šInversion of Control</p>

<p>æ§åˆ¶æŒ‡çš„æ˜¯ï¼šå½“å‰å¯¹è±¡å¯¹å†…éƒ¨æˆå‘˜çš„æ§åˆ¶æƒã€‚</p>

<p>åè½¬æŒ‡çš„æ˜¯ï¼šè¿™ç§æ§åˆ¶æƒä¸ç”±å½“å‰å¯¹è±¡ç®¡ç†äº†ï¼Œç”±å…¶ä»–(ç±»,ç¬¬ä¸‰æ–¹å®¹å™¨)æ¥ç®¡ç†</p>

<p>å®ç°é€”å¾„ï¼šä¾èµ–æŸ¥æ‰¾ï¼Œä¾èµ–æ³¨å…¥</p>

<p><strong>ä¼˜ç‚¹</strong>ï¼š</p>

<ul>
<li>ä¸ç”¨è‡ªå·±ç»„è£…ï¼Œæ‹¿æ¥å°±ç”¨ã€‚</li>
<li>äº«å—å•ä¾‹çš„å¥½å¤„ï¼Œæ•ˆç‡é«˜ï¼Œä¸æµªè´¹ç©ºé—´ã€‚</li>
<li>ä¾¿äºå•å…ƒæµ‹è¯•ï¼Œæ–¹ä¾¿åˆ‡æ¢mockç»„ä»¶ã€‚</li>
<li>ä¾¿äºè¿›è¡ŒAOPæ“ä½œï¼Œå¯¹äºä½¿ç”¨è€…æ˜¯é€æ˜çš„ã€‚</li>
<li>ç»Ÿä¸€é…ç½®ï¼Œä¾¿äºä¿®æ”¹ã€‚</li>
</ul>

<h2 id="toc_2">DI ä¾èµ–æ³¨å…¥</h2>

<p>Dependency injection</p>

<p>å°±æ˜¯ä¼ å…¥ä¸€ä¸ªå®ä¾‹ç»™ä¸€ä¸ªå¯¹è±¡</p>

<h2 id="toc_3">AOP åˆ‡é¢ç¼–ç¨‹</h2>

<p>å°†ä¸šåŠ¡é€»è¾‘ä¸æ ·æ¿é€»è¾‘åˆ†å¼€ï¼Œå®ç°é€»è¾‘çš„ç»„åˆï¼Œå®ç°åŸç†ï¼šåŠ¨æ€ä»£ç†</p>

<h2 id="toc_4">åŠ¨é™æ€ä»£ç†</h2>

<ul>
<li>é™æ€ä»£ç†
<ul>
<li>å°±æ˜¯æ”¹ä»£ç ï¼Œç”¨ä»£ç†æ¨¡å¼åœ¨ä»£ç é‡Œé¢å†™æ­»</li>
</ul></li>
<li>åŠ¨æ€ä»£ç†
<ul>
<li>ä½¿ç”¨ java.lang.reflect.Proxy</li>
<li>åªèƒ½ä»£ç†æ¥å£</li>
<li>ä½¿ç”¨åå°„æ‰€ä»¥æ€§èƒ½ä¸å¤ªå¥½</li>
</ul></li>
</ul>

<pre><code class="language-java">package com.proxy;

import java.lang.reflect.InvocationHandler;
import java.lang.reflect.Method;
import java.lang.reflect.Proxy;

public class ProxyFactory {

    private Object target;// ç»´æŠ¤ä¸€ä¸ªç›®æ ‡å¯¹è±¡

    public ProxyFactory(Object target) {
        this.target = target;
    }

    // ä¸ºç›®æ ‡å¯¹è±¡ç”Ÿæˆä»£ç†å¯¹è±¡
    public Object getProxyInstance() {
        return Proxy.newProxyInstance(target.getClass().getClassLoader(), target.getClass().getInterfaces(),
                new InvocationHandler() {

                    @Override
                    public Object invoke(Object proxy, Method method, Object[] args) throws Throwable {
                        System.out.println(&quot;å¼€å¯äº‹åŠ¡&quot;);

                        // æ‰§è¡Œç›®æ ‡å¯¹è±¡æ–¹æ³•
                        Object returnValue = method.invoke(target, args);

                        System.out.println(&quot;æäº¤äº‹åŠ¡&quot;);
                        return null;
                    }
                });
    }
}
</code></pre>

<ul>
<li>cglibä»£ç†
<ul>
<li>cglib (Code Generation Library )æ˜¯ä¸€ä¸ªç¬¬ä¸‰æ–¹ä»£ç ç”Ÿæˆç±»åº“ï¼Œè¿è¡Œæ—¶åœ¨å†…å­˜ä¸­åŠ¨æ€ç”Ÿæˆä¸€ä¸ªå­ç±»å¯¹è±¡ä»è€Œå®ç°å¯¹ç›®æ ‡å¯¹è±¡åŠŸèƒ½çš„æ‰©å±•</li>
<li>ä¼˜ç‚¹ï¼šè§£å†³åŠ¨æ€ä»£ç†åªèƒ½ä»£ç†å®ç°æ¥å£çš„ç±»çš„é—®é¢˜ï¼Œç”Ÿæˆå®é™…å­ç±»å’Œå­—èŠ‚ç æ•…æ€§èƒ½ä¼˜äºåŠ¨æ€ä»£ç†</li>
</ul></li>
</ul>

<h2 id="toc_5">å¾ªç¯ä¾èµ–</h2>

<p>Açš„å®ä¾‹ä¾èµ–Bï¼ŒBçš„å®ä¾‹ä¾èµ–A</p>

<h5 id="toc_6">è§£å†³åŠæ³•ï¼š</h5>

<ul>
<li>æƒ°æ€§åŠ è½½ï¼Œéœ€è¦çš„æ—¶å€™å†åŠ è½½è¿›è¡Œ</li>
<li>Springé»˜è®¤è§£å†³åŠæ³•ï¼š
<ul>
<li>åˆ›å»ºAä½†ä¸åˆå§‹åŒ–ï¼Œåˆ›å»ºå¹¶åˆå§‹åŒ–Bï¼Œæ­¤æ—¶Bæ‹¥æœ‰çš„æ˜¯Açš„æœªåˆå§‹åŒ–çš„å¼•ç”¨ã€‚å®ä¾‹åŒ–Båï¼Œå†å›æ¥åˆå§‹åŒ–A</li>
<li>å½“å‰åˆ›å»ºbeanæ± ï¼šåˆ›å»ºè¿‡ç¨‹ä¸­ä¸€ç›´ä¿æŒåœ¨æ± é‡Œé¢ï¼Œç”¨äºåˆ¤æ–­æ˜¯å¦å¾ªç¯ä¾èµ–</li>
<li>ä¸‰çº§ç¼“å­˜ï¼š
<ul>
<li>ä¸‰çº§ï¼šè¿›å…¥å®ä¾‹åŒ–é˜¶æ®µçš„å•ä¾‹å¯¹è±¡å·¥å‚çš„cache</li>
<li>äºŒçº§ï¼šå·²åˆ›å»ºæœªåˆå§‹åŒ–</li>
<li>ä¸€çº§ï¼šå·²å®ä¾‹åŒ–</li>
</ul></li>
<li>åˆ›å»ºè¿‡ç¨‹ï¼š
<ul>
<li>Aåˆ›å»ºåˆ°ä¸€åŠï¼Œå°†è‡ªå·±ç½®äºä¸‰çº§ç¼“å­˜ä¸­ï¼Œå‘ç°ä¾èµ–Bã€‚è½¬è€Œåˆ›å»ºBï¼Œå¹¶ä¸€çº§ä¸€çº§æ‰¾Aç¼“å­˜ï¼Œåˆ›å»ºBå®Œæˆåå›åˆ°Açš„åˆ›å»ºè¿‡ç¨‹ç»§ç»­</li>
</ul></li>
</ul></li>
</ul>

<h2 id="toc_7">æ‚é¡¹</h2>

<h3 id="toc_8">AutoWireä¸Resource</h3>

<ul>
<li>autowireï¼šæŒ‰ç±»å‹æ³¨å…¥ï¼Œspringæä¾›çš„æ³¨è§£</li>
<li>resourceï¼šæŒ‰åç§°æ³¨å…¥ï¼Œjavaè‡ªå¸¦ï¼Œä¹Ÿæ”¯æŒè¾“å…¥å‚æ•°æŒ‰ç±»å‹ã€‚æ‰¾ä¸åˆ°æ—¶å±‚å±‚é€€åŒ–<br/></li>
<li>@Qualifierï¼šå­˜åœ¨å¤šä¸ªåŒç±»å‹beanæ—¶ï¼Œå¯ä»¥ä½¿ç”¨å®ƒæ¥ä½œåŒºåˆ†</li>
</ul>

<h3 id="toc_9">beançš„ä½œç”¨åŸŸ</h3>

<ul>
<li><p>singleton : beanåœ¨æ¯ä¸ªSpring ioc å®¹å™¨ä¸­åªæœ‰ä¸€ä¸ªå®ä¾‹ã€‚</p></li>
<li><p>prototypeï¼šä¸€ä¸ªbeançš„å®šä¹‰å¯ä»¥æœ‰å¤šä¸ªå®ä¾‹ã€‚</p></li>
<li><p>requestï¼šæ¯æ¬¡httpè¯·æ±‚éƒ½ä¼šåˆ›å»ºä¸€ä¸ªbeanï¼Œè¯¥ä½œç”¨åŸŸä»…åœ¨åŸºäºwebçš„Spring ApplicationContextæƒ…å½¢ä¸‹æœ‰æ•ˆã€‚</p></li>
<li><p>sessionï¼šåœ¨ä¸€ä¸ªHTTP Sessionä¸­ï¼Œä¸€ä¸ªbeanå®šä¹‰å¯¹åº”ä¸€ä¸ªå®ä¾‹ã€‚è¯¥ä½œç”¨åŸŸä»…åœ¨åŸºäºwebçš„Spring ApplicationContextæƒ…å½¢ä¸‹æœ‰æ•ˆã€‚</p></li>
<li><p>global-sessionï¼šåœ¨ä¸€ä¸ªå…¨å±€çš„HTTP Sessionä¸­ï¼Œä¸€ä¸ªbeanå®šä¹‰å¯¹åº”ä¸€ä¸ªå®ä¾‹ã€‚è¯¥ä½œç”¨åŸŸä»…åœ¨åŸºäºwebçš„Spring ApplicationContextæƒ…å½¢ä¸‹æœ‰æ•ˆã€‚</p></li>
</ul>

<h3 id="toc_10">äº‹åŠ¡ä¼ æ’­æœºåˆ¶</h3>

<pre><code class="language-text">â‘  PROPAGATION_REQUIREDï¼šå¦‚æœå½“å‰æ²¡æœ‰äº‹åŠ¡ï¼Œå°±åˆ›å»ºä¸€ä¸ªæ–°äº‹åŠ¡ï¼Œå¦‚æœå½“å‰å­˜åœ¨äº‹åŠ¡ï¼Œå°±åŠ å…¥è¯¥äº‹åŠ¡ï¼Œè¯¥è®¾ç½®æ˜¯æœ€å¸¸ç”¨çš„è®¾ç½®ã€‚

â‘¡ PROPAGATION_SUPPORTSï¼šæ”¯æŒå½“å‰äº‹åŠ¡ï¼Œå¦‚æœå½“å‰å­˜åœ¨äº‹åŠ¡ï¼Œå°±åŠ å…¥è¯¥äº‹åŠ¡ï¼Œå¦‚æœå½“å‰ä¸å­˜åœ¨äº‹åŠ¡ï¼Œå°±ä»¥éäº‹åŠ¡æ‰§è¡Œã€‚

â‘¢ PROPAGATION_MANDATORYï¼šæ”¯æŒå½“å‰äº‹åŠ¡ï¼Œå¦‚æœå½“å‰å­˜åœ¨äº‹åŠ¡ï¼Œå°±åŠ å…¥è¯¥äº‹åŠ¡ï¼Œå¦‚æœå½“å‰ä¸å­˜åœ¨äº‹åŠ¡ï¼Œå°±æŠ›å‡ºå¼‚å¸¸ã€‚

â‘£ PROPAGATION_REQUIRES_NEWï¼šåˆ›å»ºæ–°äº‹åŠ¡ï¼Œæ— è®ºå½“å‰å­˜ä¸å­˜åœ¨äº‹åŠ¡ï¼Œéƒ½åˆ›å»ºæ–°äº‹åŠ¡ã€‚

â‘¤ PROPAGATION_NOT_SUPPORTEDï¼šä»¥éäº‹åŠ¡æ–¹å¼æ‰§è¡Œæ“ä½œï¼Œå¦‚æœå½“å‰å­˜åœ¨äº‹åŠ¡ï¼Œå°±æŠŠå½“å‰äº‹åŠ¡æŒ‚èµ·ã€‚

â‘¥ PROPAGATION_NEVERï¼šä»¥éäº‹åŠ¡æ–¹å¼æ‰§è¡Œï¼Œå¦‚æœå½“å‰å­˜åœ¨äº‹åŠ¡ï¼Œåˆ™æŠ›å‡ºå¼‚å¸¸ã€‚

â‘¦ PROPAGATION_NESTEDï¼šå¦‚æœå½“å‰å­˜åœ¨äº‹åŠ¡ï¼Œåˆ™åœ¨åµŒå¥—äº‹åŠ¡å†…æ‰§è¡Œã€‚å¦‚æœå½“å‰æ²¡æœ‰äº‹åŠ¡ï¼Œåˆ™æŒ‰REQUIREDå±æ€§æ‰§è¡Œã€‚
</code></pre>

]]></content>
  </entry>
  
</feed>
