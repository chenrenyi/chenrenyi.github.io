<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[ç™½é©¼å±±åº„]]></title>
  <link href="https://chenrenyi.github.io/atom.xml" rel="self"/>
  <link href="https://chenrenyi.github.io/"/>
  <updated>2020-06-18T11:42:14+08:00</updated>
  <id>https://chenrenyi.github.io/</id>
  <author>
    <name><![CDATA[]]></name>
    
  </author>
  <generator uri="http://www.mweb.im">MWeb</generator>

  
  <entry>
    <title type="html"><![CDATA[å›æº¯ç®—æ³•]]></title>
    <link href="https://chenrenyi.github.io/15924514980743.html"/>
    <updated>2020-06-18T11:38:18+08:00</updated>
    <id>https://chenrenyi.github.io/15924514980743.html</id>
    <content type="html"><![CDATA[
<h2 id="toc_0">æ¡†æ¶</h2>

<p>å›æº¯é—®é¢˜ç®—æ³•æ¡†æ¶<br/>
for é€‰æ‹© in é€‰æ‹©åˆ—è¡¨:<br/>
    # åšé€‰æ‹©<br/>
    å°†è¯¥é€‰æ‹©ä»é€‰æ‹©åˆ—è¡¨ç§»é™¤<br/>
    è·¯å¾„.add(é€‰æ‹©)<br/>
    backtrack(è·¯å¾„, é€‰æ‹©åˆ—è¡¨)<br/>
    # æ’¤é”€é€‰æ‹©<br/>
    è·¯å¾„.remove(é€‰æ‹©)<br/>
    å°†è¯¥é€‰æ‹©å†åŠ å…¥å¯é€‰åˆ—è¡¨</p>

<h2 id="toc_1">å…¨æ’åˆ—é—®é¢˜</h2>

<pre><code class="language-java">package fighting.algorithm.backtrack;

import java.util.ArrayList;
import java.util.LinkedList;
import java.util.List;

/**
 * å…¨æ’åˆ—é—®é¢˜
 */
public class Sequence {

    public static int answer_num = 0;

    /**
     * å›æº¯
     *
     * @param numbers ç”¨äºæ’åˆ—çš„æ•°å­—
     * @param track   è·¯å¾„
     */
    public static void backtrack(List&lt;Integer&gt; numbers, LinkedList&lt;Integer&gt; track) {
        if (numbers.size() == track.size()) {
            System.out.println(track);
            answer_num++;
            return;
        }

        for (int i : numbers) {
            // å¦‚æœè¯¥æ•°å·²åœ¨è·¯å¾„ä¸­ï¼Œå¿½ç•¥
            if (track.contains(i)) {
                continue;
            }
            // åšé€‰æ‹©
            track.add(i);
            // é€’å½’è¿›å…¥ä¹‹åçš„é€‰æ‹©
            backtrack(numbers, track);
            // æ’¤é”€é€‰æ‹©
            track.removeLast();
        }
    }

    /**
     * æµ‹è¯•
     */
    public static void main(String ars[]) {
        List&lt;Integer&gt; numbers = new ArrayList&lt;&gt;();
        numbers.add(1);
        numbers.add(2);
        numbers.add(3);
        numbers.add(4);

        LinkedList&lt;Integer&gt; chooseList = new LinkedList&lt;&gt;();

        backtrack(numbers, chooseList);

        System.out.println(answer_num);
    }
}

</code></pre>

<h2 id="toc_2">Nçš‡åé—®é¢˜</h2>

<pre><code class="language-java">package fighting.algorithm.backtrack;

import java.util.ArrayList;
import java.util.Collections;
import java.util.List;

/**
 * Nçš‡åé—®é¢˜
 */
public class Queen {

    public static final int QUEEN_NUM = 8;

    public static List&lt;List&lt;List&lt;String&gt;&gt;&gt; results = new ArrayList&lt;&gt;();

    public static void queen(List&lt;List&lt;String&gt;&gt; board, int row) {
        if (row &gt;= QUEEN_NUM) {
            List&lt;List&lt;String&gt;&gt; boardCopy = initBoard();
            Collections.copy(boardCopy, board);
            results.add(boardCopy);
            return;
        }
        for (int column = 0; column &lt; QUEEN_NUM; column++) {
            if (isValid(board, row, column)) {
                board.get(row).set(column, &quot;Q&quot;);
                queen(board, row + 1);
                board.get(row).set(column, &quot;&quot;);
            }
        }
    }

    public static boolean isValid(List&lt;List&lt;String&gt;&gt; board, int row, int column) {
        // false if q exists in the same column
        for (int i = 0; i &lt; row; i++) {
            if (board.get(i).get(column).equals(&quot;Q&quot;)) {
                return false;
            }
        }

        for (int i = row - 1, j = column - 1; i &gt;= 0 &amp;&amp; j &gt;= 0; i--, j--) {
            if (board.get(i).get(j).equals(&quot;Q&quot;)) {
                return false;
            }
        }

        for (int i = row - 1, j = column + 1; i &gt;= 0 &amp;&amp; j &lt; QUEEN_NUM; i--, j++) {
            if (board.get(i).get(j).equals(&quot;Q&quot;)) {
                return false;
            }
        }

        return true;
    }

    public static List&lt;List&lt;String&gt;&gt; initBoard() {
        List&lt;List&lt;String&gt;&gt; board = new ArrayList&lt;&gt;();
        for (int i = 0; i &lt; QUEEN_NUM; i++) {
            board.add(new ArrayList&lt;&gt;());
            for (int j = 0; j &lt; QUEEN_NUM; j++) {
                board.get(i).add(&quot;&quot;);
            }
        }

        return board;
    }

    public static void printBoard(List&lt;List&lt;String&gt;&gt; board) {
        for (int i = 0; i &lt; QUEEN_NUM; i++) {
            for (int j = 0; j &lt; QUEEN_NUM; j++) {
                if (board.get(i).get(j).equals(&quot;Q&quot;)) {
                    System.out.print(&quot; â— &quot;);
                } else {
                    System.out.print(&quot; â—‹ &quot;);
                }
            }
            System.out.println();
        }
        System.out.println();
    }

    public static void main(String args[]) {
        List&lt;List&lt;String&gt;&gt; board = initBoard();
        queen(board, 0);

        System.out.println(results.size());
    }
}

</code></pre>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[ForkJoinPool ç›¸å…³]]></title>
    <link href="https://chenrenyi.github.io/15922331141719.html"/>
    <updated>2020-06-15T22:58:34+08:00</updated>
    <id>https://chenrenyi.github.io/15922331141719.html</id>
    <content type="html"><![CDATA[
<pre><code class="language-java">package fighting.threads;

import java.util.Arrays;
import java.util.List;
import java.util.concurrent.*;

/**
 * ForkJoinPoolå­¦ä¹ 
 * ä¸åŒä¹‹å¤„ï¼š
 * 1ã€æ²¡æœ‰ä¸€ä¸ªå…¬å…±çš„ä»»åŠ¡é˜Ÿåˆ—ï¼Œè€Œæ˜¯æ¯ä¸ªå·¥ä½œçº¿ç¨‹éƒ½æœ‰è‡ªå·±ä¸¤ä¸ªä»»åŠ¡é˜Ÿåˆ—ï¼ˆå¤–éƒ¨å’Œå†…éƒ¨äº§ç”Ÿçš„å­ä»»åŠ¡ï¼‰
 * 2ã€ç›®çš„æ˜¯é¿å…å¤„ç†å¤§é‡çŸ­å¹³å¿«ä»»åŠ¡æ—¶ï¼Œå¯¹å…¬å…±é˜Ÿåˆ—ä»»åŠ¡çš„äº‰æŠ¢å¼•å‘æ€§èƒ½é—®é¢˜ã€‚å³æ¯ä¸ªä»»åŠ¡æ‰§è¡Œéƒ½å¾ˆå¿«ï¼Œä½†å¤šå¹¶å‘æƒ…å†µä¸‹å…¬å…±ä»»åŠ¡é˜Ÿåˆ—pushå’Œpopçš„åŠ é”æˆä¸ºäº†ç“¶é¢ˆ
 *
 * ä¸¤ä¸ªä½œç”¨ï¼š
 * 1ã€åˆ†è€Œæ²»ä¹‹ï¼Œå…è®¸ä»»åŠ¡æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œå†æ¬¡æäº¤å­ä»»åŠ¡ï¼Œä»è€Œç¼©çŸ­æ—¶é—´
 * 2ã€å·¥ä½œçªƒå–ï¼Œçº¿ç¨‹æ± ä¸­å·²å®Œæˆçš„å·¥ä½œçº¿ç¨‹ï¼Œå°†ä¸»åŠ¨è·å–æ‰€æœ‰çº¿ç¨‹é˜Ÿåˆ—ä¸­å·²æäº¤æœªå®Œæˆçš„ä»»åŠ¡æˆ–å­ä»»åŠ¡
 *
 * å¯¹åº”çš„ç±»ï¼š
 * ForkJoinPoolï¼šçº¿ç¨‹æ± 
 * ForkJoinPool.commonï¼šå…¨å±€å…¬ç”¨çš„çº¿ç¨‹æ± 
 * ForkJoinTaskï¼šæœ‰è¿”å›å€¼çš„ä»»åŠ¡
 * ForkJoinActionï¼šæ²¡æœ‰è¿”å›å€¼ä»»åŠ¡
 *
 * ç›¸å…³ç±»ï¼š
 * Executors.newWorkStealingPool()
 * stream.parallelStream()
 */
public class ForkJoinPoolTest {

    /**
     * æµ‹è¯•å…¥å£
     */
    public static void main(String[] args) throws ExecutionException, InterruptedException {
        ForkJoinPool pool = new ForkJoinPool(10);
        ForkJoinTask&lt;Integer&gt; result = pool.submit(new CalcIntegerTask(0, 100000));
        System.out.println(result.get());
        pool.shutdown();

        // é€šè¿‡executorsåˆ›å»ºçº¿ç¨‹æ± 
        Executors.newWorkStealingPool().submit(() -&gt; System.out.println(&quot;a runnable task&quot;));

        // parallelStreamï¼ˆpÃ¦rÉ™lelï¼‰ï¼Œé»˜è®¤ä½¿ç”¨ ForkJoinPool.common
        List&lt;Integer&gt; numbers = Arrays.asList(1, 2, 3, 4, 5, 6, 7, 8, 9);
        numbers.parallelStream().forEach(System.out::println);
    }

}

/**
 * æ•°å­—è®¡ç®—ä»»åŠ¡
 */
class CalcIntegerTask extends RecursiveTask&lt;Integer&gt; {

    private Integer start;

    private Integer end;

    public CalcIntegerTask(Integer start, Integer end) {
        this.start = start;
        this.end = end;
    }

    @Override
    protected Integer compute() {
        int sum = 0;
        if (end - start &lt;= 100) {
            // æ•°æ®é‡å°‘æ—¶ç›´æ¥è®¡ç®—
            for (int i = start; i &lt;= end; i++) {
                sum += i;
            }
        } else {
            // æ•°æ®é‡å¤§æ—¶ï¼Œåˆ†è€Œæ²»ä¹‹ã€‚æ‹†åˆ†å­ä»»åŠ¡æäº¤
            int middle = (end - start) / 2 + start;
            CalcIntegerTask leftTask = new CalcIntegerTask(start, middle);
            CalcIntegerTask rightTask = new CalcIntegerTask(middle + 1, end);

            // å­ä»»åŠ¡éœ€è¦è°ƒç”¨ fork æ–¹æ³•
            leftTask.fork();
            rightTask.fork();

            // ä½¿ç”¨ join æ–¹æ³•ç­‰å¾…å¹¶è·å–å€¼
            sum = leftTask.join() + rightTask.join();
        }

        return sum;
    }
}

</code></pre>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[æ¦‚å¿µç†è®º]]></title>
    <link href="https://chenrenyi.github.io/15922330840064.html"/>
    <updated>2020-06-15T22:58:04+08:00</updated>
    <id>https://chenrenyi.github.io/15922330840064.html</id>
    <content type="html"><![CDATA[
<h2 id="toc_0">CAP</h2>

<p>åˆ†å¸ƒå¼ç³»ç»Ÿçš„3ä¸ªæŒ‡æ ‡ï¼Œè¿™3ä¸ªæŒ‡æ ‡åªèƒ½åŒæ—¶æ»¡è¶³ä¸¤ä¸ª</p>

<ul>
<li>Consistencyï¼šä¸€è‡´æ€§</li>
<li>Availabilityï¼šå¯ç”¨æ€§</li>
<li>Partition toleranceï¼šåˆ†åŒºå®¹é”™æ€§</li>
</ul>

<h3 id="toc_1">Consistencyï¼šä¸€è‡´æ€§</h3>

<p><strong>æ¦‚å¿µ</strong></p>

<p>å†™ä¹‹åè¿›è¡Œè¯»ï¼Œèƒ½è¯»åˆ°å€¼å³æ»¡è¶³ä¸€è‡´æ€§</p>

<p><strong>ä¸»è¦é—®é¢˜</strong></p>

<p>å†™å…¥é›†ç¾¤ä¸­Aæœºå™¨ï¼Œè¯»Bæœºå™¨ã€‚Bæœºå™¨æ•°æ®æœªåŒæ­¥å‰æ•°æ®ä¸æ˜¯æœ€æ–°çš„ã€‚</p>

<p><strong>è§£å†³åŠæ³•</strong></p>

<p>å†™å…¥åˆ°é›†ç¾¤ä¸­Aæœºå™¨æ—¶ï¼Œåœ¨è‡ªèº«ä¿å­˜å®Œæ¯•å¹¶ç¡®ä¿åŒæ­¥åˆ°Bæœºå™¨åï¼Œå†è¿”å›å†™å…¥æˆåŠŸã€‚å› æ­¤å†™å…¥æœ‰å»¶æ—¶ã€‚</p>

<h3 id="toc_2">Availabilityï¼šå¯ç”¨æ€§</h3>

<p><strong>æ¦‚å¿µ</strong></p>

<p>æœåŠ¡æ”¶åˆ°è¯·æ±‚åï¼Œè¦ç«‹å³å›ç­”</p>

<p><strong>ä¸»è¦é—®é¢˜</strong></p>

<p>ä¸ä¸Šè¿°ä¸€è‡´æ€§æœ‰å†²çªï¼Œç½‘ç»œæ•…éšœæ—¶ä¹Ÿæœ‰å½±å“</p>

<h3 id="toc_3">Partition toleranceï¼šåˆ†åŒºå®¹é”™æ€§</h3>

<p><strong>æ¦‚å¿µ</strong></p>

<p>é›†ç¾¤ä¸­å„ä¸ªåŒºä¹‹é—´æ˜¯å¦å…è®¸æœ‰ç½‘ç»œæ•…éšœé—®é¢˜</p>

<p><strong>ä¸»è¦é—®é¢˜</strong></p>

<p>åˆ†å¸ƒå¼ç³»ç»Ÿå¿…ç„¶è‚¯å®šè¦å…è®¸ï¼Œæ‰€ä»¥på¿…é¡»ä¿è¯ã€‚ä»è€Œ cã€a åªèƒ½é€‰ä¸€</p>

<h3 id="toc_4">å¯ç”¨æ€§ä¸ä¸€è‡´æ€§çŸ›ç›¾</h3>

<pre><code class="language-text">ä¸€è‡´æ€§å’Œå¯ç”¨æ€§ï¼Œä¸ºä»€ä¹ˆä¸å¯èƒ½åŒæ—¶æˆç«‹ï¼Ÿç­”æ¡ˆå¾ˆç®€å•ï¼Œå› ä¸ºå¯èƒ½é€šä¿¡å¤±è´¥ï¼ˆå³å‡ºç°åˆ†åŒºå®¹é”™ï¼‰ã€‚

å¦‚æœä¿è¯ G2 çš„ä¸€è‡´æ€§ï¼Œé‚£ä¹ˆ G1 å¿…é¡»åœ¨å†™æ“ä½œæ—¶ï¼Œé”å®š G2 çš„è¯»æ“ä½œå’Œå†™æ“ä½œã€‚åªæœ‰æ•°æ®åŒæ­¥åï¼Œæ‰èƒ½é‡æ–°å¼€æ”¾è¯»å†™ã€‚é”å®šæœŸé—´ï¼ŒG2 ä¸èƒ½è¯»å†™ï¼Œæ²¡æœ‰å¯ç”¨æ€§ä¸ã€‚

å¦‚æœä¿è¯ G2 çš„å¯ç”¨æ€§ï¼Œé‚£ä¹ˆåŠ¿å¿…ä¸èƒ½é”å®š G2ï¼Œæ‰€ä»¥ä¸€è‡´æ€§ä¸æˆç«‹ã€‚

ç»¼ä¸Šæ‰€è¿°ï¼ŒG2 æ— æ³•åŒæ—¶åšåˆ°ä¸€è‡´æ€§å’Œå¯ç”¨æ€§ã€‚ç³»ç»Ÿè®¾è®¡æ—¶åªèƒ½é€‰æ‹©ä¸€ä¸ªç›®æ ‡ã€‚å¦‚æœè¿½æ±‚ä¸€è‡´æ€§ï¼Œé‚£ä¹ˆæ— æ³•ä¿è¯æ‰€æœ‰èŠ‚ç‚¹çš„å¯ç”¨æ€§ï¼›å¦‚æœè¿½æ±‚æ‰€æœ‰èŠ‚ç‚¹çš„å¯ç”¨æ€§ï¼Œé‚£å°±æ²¡æ³•åšåˆ°ä¸€è‡´æ€§ã€‚
</code></pre>

<h2 id="toc_5">RPC</h2>

<p>æ„æˆï¼š</p>

<ul>
<li>RPCåè®®ï¼šåŸºäºhttpï¼Œæˆ–è€…åŸºäºtcpè‡ªå·±å®šä¹‰åè®®</li>
<li>åºåˆ—åŒ–æœºåˆ¶ï¼šJSONã€xmlã€javaè‡ªå¸¦çš„ï¼Œæˆ–è€…å¼€æºç¬¬ä¸‰æ–¹çš„ã€‚å‘é€å‚æ•°ã€è¿”å›ç»“æœå¯¹è±¡</li>
<li>ä»£ç†ï¼šjavaçš„åŠ¨æ€ä»£ç†ï¼Œåˆ‡å…¥è½¬å‘é€»è¾‘</li>
</ul>

<h3 id="toc_6">åºåˆ—åŒ–åè®®</h3>

<ul>
<li>javaåŸç”Ÿï¼ˆObjectInputStream)
<ul>
<li>ä¸èƒ½è·¨å¹³å°</li>
<li>ä½“ç§¯å¤§ï¼Œæ€§èƒ½å·®</li>
</ul></li>
<li>protobufï¼ˆpotike)
<ul>
<li>è°·æ­Œå‡ºå“ï¼Œæœ¬è´¨æ˜¯ä¸€ç§ç»“æ„åŒ–æ•°æ®æè¿°æ–‡ä»¶</li>
</ul></li>
<li>Thrift(Î¸rÉªft)</li>
</ul>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[spring cloud ç³»åˆ—]]></title>
    <link href="https://chenrenyi.github.io/15922330508180.html"/>
    <updated>2020-06-15T22:57:30+08:00</updated>
    <id>https://chenrenyi.github.io/15922330508180.html</id>
    <content type="html"><![CDATA[
<h2 id="toc_0">æœåŠ¡æ³¨å†Œ</h2>

<p>æä¾›æœåŠ¡çš„æ³¨å†Œä¸æŸ¥è¯¢åŠŸèƒ½</p>

<h3 id="toc_1">Eureka</h3>

<p>ä¿è¯capä¸­çš„apï¼Œå³å¯ç”¨æ€§ã€‚<br/>
æœåŠ¡æ³¨å†Œç›¸å¯¹è¦å¿«ï¼Œå› ä¸ºä¸éœ€è¦ç­‰æ³¨å†Œä¿¡æ¯replicateåˆ°å…¶ä»–èŠ‚ç‚¹ï¼Œä¹Ÿä¸ä¿è¯æ³¨å†Œä¿¡æ¯æ˜¯å¦replicateæˆåŠŸ<br/>
å½“æ•°æ®å‡ºç°ä¸ä¸€è‡´æ—¶ï¼Œè™½ç„¶A, Bä¸Šçš„æ³¨å†Œä¿¡æ¯ä¸å®Œå…¨ç›¸åŒï¼Œä½†æ¯ä¸ªEurekaèŠ‚ç‚¹ä¾ç„¶èƒ½å¤Ÿæ­£å¸¸å¯¹å¤–æä¾›æœåŠ¡ï¼Œè¿™ä¼šå‡ºç°æŸ¥è¯¢æœåŠ¡ä¿¡æ¯æ—¶å¦‚æœè¯·æ±‚AæŸ¥ä¸åˆ°ï¼Œä½†è¯·æ±‚Bå°±èƒ½æŸ¥åˆ°ã€‚å¦‚æ­¤ä¿è¯äº†å¯ç”¨æ€§ä½†ç‰ºç‰²äº†ä¸€è‡´æ€§</p>

<h3 id="toc_2">Consule</h3>

<p>ä¿è¯capä¸­çš„cpï¼Œå³å¼ºä¸€è‡´æ€§ã€‚<br/>
æœåŠ¡æ³¨å†Œç›¸æ¯”Eurekaä¼šç¨æ…¢ä¸€äº›ã€‚å› ä¸ºConsulçš„raftåè®®è¦æ±‚å¿…é¡»è¿‡åŠæ•°çš„èŠ‚ç‚¹éƒ½å†™å…¥æˆåŠŸæ‰è®¤ä¸ºæ³¨å†ŒæˆåŠŸ<br/>
LeaderæŒ‚æ‰æ—¶ï¼Œé‡æ–°é€‰ä¸¾æœŸé—´æ•´ä¸ªconsulä¸å¯ç”¨ã€‚ä¿è¯äº†å¼ºä¸€è‡´æ€§ä½†ç‰ºç‰²äº†å¯ç”¨æ€§ã€‚</p>

<h2 id="toc_3">ç½‘å…³ - Api Gateway</h2>

<h3 id="toc_4">ä»‹ç»</h3>

<p>ç½‘å…³ï¼šè·¯ç”±åˆ†å‘å’Œè¿‡æ»¤</p>

<ul>
<li>ä½œä¸ºä»£ç†ï¼Œå¦‚nginxä¸€èˆ¬è½¬å‘è¯·æ±‚åˆ°åç«¯æœåŠ¡</li>
<li>é…ç½®æœåŠ¡æ³¨å†Œä¸­å¿ƒï¼Œæ ¹æ®æœåŠ¡åè‡ªåŠ¨è½¬å‘</li>
<li>ç»Ÿä¸€è¯·æ±‚å…¥å£ï¼Œè¿›è¡Œå…¬å…±å¤„ç†ï¼Œå¦‚ï¼š
<ul>
<li>èº«ä»½è®¤è¯</li>
<li>æ—¥å¿—è®°å½•</li>
<li>é…åˆé™æµåº“ï¼šhystrixï¼Œç†”æ–­é™æµé™çº§ä¾èµ–éš”ç¦»ç­‰</li>
<li>é…åˆè´Ÿè½½å‡è¡¡åº“ï¼šribbonï¼Œæµé‡è´Ÿè½½å‡è¡¡</li>
</ul></li>
</ul>

<h3 id="toc_5">zuul</h3>

<p><em>è·¯ç”±è½¬å‘</em></p>

<blockquote>
<p>ä¸æœåŠ¡æ³¨å†Œä¸­å¿ƒé…ç½®æ—¶ä¸éœ€è¦é…ç½®</p>
</blockquote>

<pre><code class="language-text">zuul:
    routes:
        bms-biz:
            path: /api/bms/biz/**
            sensitiveHeaders: Content-Length
            url: http://bms-biz.dsg.cfpamf.com
</code></pre>

<p><em>è¿‡æ»¤</em></p>

<pre><code class="language-text">preFilter  # è½¬å‘å‰æ‹¦æˆªå¤„ç†
routeFilter # å®é™…è·¯ç”±
postFilter  # è½¬å‘åæ‹¦æˆªå¤„ç†
</code></pre>

<h3 id="toc_6">spring cloud gateway</h3>

<p>åŒä¸Š</p>

<h2 id="toc_7">ç½‘ç»œç›¸å…³</h2>

<h3 id="toc_8">feign</h3>

<p>httpè°ƒç”¨å®¢æˆ·ç«¯ï¼Œé€šè¿‡æ³¨è§£è°ƒç”¨æ¥å£<br/>
æœ¬è´¨æ˜¯ ribbon + hystrix</p>

<h3 id="toc_9">ribbon</h3>

<p>è´Ÿè½½å‡è¡¡ï¼Œé‡è¯•</p>

<h3 id="toc_10">Hystrix</h3>

<blockquote>
<p>[hIst&#39;rIks](å—¨æ–¯æ¶å…‹æ–¯ï¼‰</p>
</blockquote>

<p>å®¢æˆ·ç«¯å®¹é”™ä¿æŠ¤ï¼Œç‰¹æ€§æœ‰æœåŠ¡é™çº§ã€æœåŠ¡ç†”æ–­ã€è¯·æ±‚ç¼“å­˜ã€è¯·æ±‚åˆå¹¶ã€ä¾èµ–éš”ç¦»</p>

<p><strong>æ–­è·¯å™¨</strong></p>

<pre><code class="language-text">@HystrixCommand(fallbackMethod = &quot;processHystrix_Get&quot;)
</code></pre>

<p>è¾¾åˆ°ä¸€å®šæ¡ä»¶æ—¶ï¼Œä¸å†æ‰§è¡ŒåŸæ–¹æ³•ï¼Œè€Œæ”¹ä¸ºæ‰§è¡Œ fallback æ–¹æ³•</p>

<h2 id="toc_11">é…ç½®ä¸­å¿ƒ</h2>

<h3 id="toc_12">spring cloud config</h3>

<p>æä¾›é…ç½®ä¿¡æ¯</p>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Dockerç¬”è®°]]></title>
    <link href="https://chenrenyi.github.io/15916082982624.html"/>
    <updated>2020-06-08T17:24:58+08:00</updated>
    <id>https://chenrenyi.github.io/15916082982624.html</id>
    <content type="html"><![CDATA[
<h2 id="toc_0">Hello World!</h2>

<p>ä¸‹è½½ä¸€ä¸ªé•œåƒå¹¶è¿è¡Œ</p>

<pre><code class="language-text">docker image pull library/hello-world

docker image ls 

docker run hello-world
</code></pre>

<h2 id="toc_1">åŸºæœ¬æ“ä½œ</h2>

<p>é•œåƒç›¸å…³</p>

<pre><code class="language-text">docker image help   # å¸®åŠ©
docker image ls     # æŸ¥çœ‹
docker image rm     # åˆ é™¤
</code></pre>
<br>
<p>å®¹å™¨ç›¸å…³</p>

<blockquote>
<p>å®¹å™¨æœ‰å¯èƒ½åœ¨è¿è¡Œå®Œæ¯•åè‡ªåŠ¨ç»“æŸï¼Œä¹Ÿå¯èƒ½æ˜¯å¸¸é©»æœåŠ¡ï¼Œåè€…å¯ç”¨killå‘½ä»¤æ€æ‰</p>
</blockquote>

<pre><code class="language-text">docker container help   # å¸®åŠ©
docker container ls     # æŸ¥çœ‹
docker container ls --all     # æŸ¥çœ‹åŒ…æ‹¬å·²ç»ˆæ­¢çš„æ‰€æœ‰å®¹å™¨

docker container run    # æ–°å»ºå®¹å™¨
docker container start  # å¯åŠ¨
docker container stop   # åœæ­¢ï¼Œæ¯” kill æ›´æŸ”å’Œ
docker container exec -it  # è¿›å…¥ä¸€ä¸ªæ­£åœ¨è¿è¡Œçš„å®¹å™¨
docker container cp  [containID]:[/path/to/file] .    # å¤åˆ¶æ–‡ä»¶

docker container logs [containerID] # æŸ¥çœ‹å®¹å™¨æ—¥å¿—è¾“å‡º

docker container rm     # æ€æ‰å®¹å™¨
docker container rm     # åˆ é™¤å®¹å™¨æ–‡ä»¶
</code></pre>

<h2 id="toc_2">Dockfile</h2>

<blockquote>
<p>Dockfileç”¨äºé…ç½®ç”Ÿæˆimageï¼Œå³å¦‚æœè¦è‡ªå®šä¹‰imageéœ€è¦ä½¿ç”¨å®ƒ</p>
</blockquote>

<p>ç¤ºä¾‹ï¼šæ‰“åŒ…ä¸€ä¸ª npm å‰ç«¯ç½‘ç«™</p>
<br>
<p>1ã€åˆ›å»º .dockerignore æ–‡ä»¶ï¼Œå³æ‰“åŒ…æ—¶éœ€è¦æ’é™¤çš„æ–‡ä»¶</p>

<pre><code class="language-text">.git
node_modules
npm-debug.log
</code></pre>
<br>
<p>2ã€ç¼–å†™Dockerfile</p>

<pre><code class="language-text">FROM node:8.4   # åœ¨è¯¥å®˜æ–¹åŒ…çš„åŸºç¡€ä¸Šè¿›è¡Œ
COPY . /app     # å°†ç›®å½• . çš„å†…å®¹å¤åˆ¶è¿›é•œåƒçš„ /app ç›®å½•ä¸­
WORKDIR /app    # ä»¥ /app ç›®å½•ä½œä¸ºå·¥ä½œæ‰€åœ¨ç›®å½•
RUN npm install --registry=https://registry.npm.taobao.org # è¿è¡Œ npm å‘½ä»¤ï¼Œè¯¥é˜¶æ®µäº§ç”Ÿçš„æ–‡ä»¶å°†è¢«æ‰“åŒ…è¿› image æ–‡ä»¶ä¸­
EXPOSE 3000     # æš´éœ² 3000 ç«¯å£

CMD npm run dev # å¯åŠ¨å‘½ä»¤ã€‚RUN ç¼–è¯‘é•œåƒæ–‡ä»¶æ—¶è¿è¡Œï¼Œç»“æœä¼šæ‰“åŒ…è¿›å»ã€‚è€Œ CMD ä¸ºå®¹å™¨å¯åŠ¨æ—¶è¿è¡Œï¼Œåªæœ‰ä¸€ä¸ª
</code></pre>
<br>
<p>3ã€ç¼–è¯‘ç”Ÿæˆ image æ–‡ä»¶</p>

<pre><code class="language-bash">docker image build -t front-demo .      # -t æŒ‡å®šåå­—å’Œç‰ˆæœ¬å·
docker image ls                         # æŸ¥çœ‹
</code></pre>
<br>
<p>4ã€è¿è¡Œ</p>

<pre><code class="language-bash">docker container run -p 8000:3000 -it front-demo /bin/bash # äº¤äº’æ¨¡å¼è¿è¡Œå¹¶æ˜ å°„ç«¯å£ï¼ŒåŒæ—¶å¯åŠ¨ /bin/bashï¼Œä¼šè¦†ç›– CMD å‘½ä»¤
docker container run -rm -p 8000:3000 -it front-demo /bin/bash # è¿è¡Œå®Œæ¯•åå³åˆ é™¤å®¹å™¨æ–‡ä»¶
</code></pre>

<h2 id="toc_3">çœŸå®æ¡ˆä¾‹ï¼šç”Ÿæˆç½‘ç«™</h2>

<h3 id="toc_4">mysqlå®¹å™¨</h3>

<pre><code class="language-bash">docker container run --name wordpressdb --env MYSQL_ROOT_PASSWORD=123456 --env MYSQL_DATABASE=wordpress -d mysql:5.7
</code></pre>

<h3 id="toc_5">å•ç‹¬phpå®¹å™¨</h3>

<p>ç¼–å†™Dockerfile</p>

<pre><code class="language-dockerfile"># dockerfile
FROM php:5.6-apache
RUN docker-php-ext-install mysqli
CMD apache2-foreground
</code></pre>

<p>åˆ¶ä½œé•œåƒ</p>

<pre><code class="language-bash">docker image build -t php-demo:1.0 .
</code></pre>

<p>è¿è¡Œå®¹å™¨</p>

<pre><code class="language-bash">docker run --name php-demo --rm -p 7000:80 --volume &quot;$PWD&quot;:/var/www/html --link wordpressdb:mysql php-demo:1.0
</code></pre>

<h2 id="toc_6">Docker compose</h2>

<p>ç¼–å†™ docker-compose.yml</p>

<pre><code class="language-yaml">mysql:
  image: mysql:5.7
  environment:
    MYSQL_ROOT_PASSWORD: 123456
    MYSQL_DATABASE: wordpress

web:
  image: php-demo:1.0
  links:
    - mysql
  ports:
    - &quot;7000:80&quot;
  working_dir: /var/www/html
  volumes:
    - /tmp/docker-demo/wordpress:/var/www/html
</code></pre>

<p>è¿è¡Œ</p>

<pre><code class="language-text">docker-compose up
</code></pre>

<h2 id="toc_7">å®¹å™¨åŸç†</h2>

<h3 id="toc_8">Namespace</h3>

<p>Linuxçš„å‘½åç©ºé—´æŠ€æœ¯ï¼Œç”¨äºå®ç°è¿›ç¨‹ã€æ–‡ä»¶ã€ç½‘ç»œç­‰èµ„æºçš„éš”ç¦»</p>

<h3 id="toc_9">Control Groups CGroup</h3>

<p>æ§åˆ¶ç»„ï¼Œç”¨äºé™åˆ¶å®¹å™¨çš„ cpuã€å†…å­˜ã€ç½‘ç»œç­‰ä½¿ç”¨</p>

<h3 id="toc_10">UnionFS</h3>

<p>è”åˆæŒ‚è½½æŠ€æœ¯ï¼ŒDockfileçš„æ¯ä¸€æ¡æ–‡ä»¶å˜æ›´å‘½ä»¤éƒ½ä¼šäº§ç”Ÿä¸€ä¸ª layer å±‚ï¼Œå³æ–‡ä»¶è¯»å†™å±‚ã€‚</p>

<p>ç”¨äºå®ç° docker çš„é•œåƒå®¹å™¨æ–‡ä»¶ç­‰çš„åˆ†å±‚æŠ€æœ¯</p>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Zuul ç½‘å…³è®°å½•è¯·æ±‚å…¨ç”Ÿå‘½å‘¨æœŸæ—¥å¿—]]></title>
    <link href="https://chenrenyi.github.io/15913291441737.html"/>
    <updated>2020-06-05T11:52:24+08:00</updated>
    <id>https://chenrenyi.github.io/15913291441737.html</id>
    <content type="html"><![CDATA[
<p>å¾®æœåŠ¡æ¶æ„ä¸­ç½‘å…³æ˜¯æ‰€æœ‰å¯¹å¤–æä¾›æœåŠ¡çš„å…¥å£ï¼Œä¸€ä¸ªå¸¸è§çš„éœ€æ±‚æ˜¯å¯¹æ¯ä¸ªè¯·æ±‚è®°å½•è¯¦ç»†æ—¥å¿—ï¼ŒåŒ…æ‹¬urlã€methodã€headerã€request bodyã€response statusã€response bodyç­‰ï¼Œæ–¹ä¾¿é—®é¢˜æ’æŸ¥è€Œä¸ç”¨æ¯ä¸ªå†…éƒ¨æœåŠ¡å†åšä¸€å¥—æ—¥å¿—äº†ã€‚</p>

<p>ä»¥ä¸‹ä¸ºzuulæ¡†æ¶æ­å»ºçš„ç½‘å…³è®°å½•å…¨é“¾è·¯æ—¥å¿—çš„æ–¹æ³•ã€‚</p>

<h3 id="toc_0">æ€è·¯ä»‹ç»</h3>

<p>zuulæœ‰ä¸ªå¤„ç†ä»£ç†è¯·æ±‚å·¥å…·ç±»<code>ProxyRequestHelper</code>ï¼Œç”¨åœ¨å…³é”®çš„è¯·æ±‚è½¬å‘å¤„ç†ä¸Šã€‚å¹¶ä¸”å®˜æ–¹å¸¦ä¸€ä¸ªå­ç±»<code>TraceProxyRequestHelper</code>ï¼Œå…¶ä¸­è®°å½•äº†ä¸å°‘debugä¿¡æ¯å’Œä¸€äº›å…³é”®çš„é’©å­æ–¹æ³•ï¼ŒåŒ…æ‹¬æˆ‘ä»¬éœ€è¦çš„è¯·æ±‚æ•°æ®ã€è½¬å‘æ¨¡å¼ç­‰ã€‚å› æ­¤ç»§æ‰¿è¿™ä¸ªå­ç±»ï¼Œé‡å†™ä¸€äº›æ–¹æ³•å¹¶æŠŠéœ€è¦çš„ä¿¡æ¯ï¼Œå¯¼å‡ºæ¥å­˜æˆæ—¥å¿—å³okã€‚</p>

<h3 id="toc_1">æ­¥éª¤æºç </h3>

<p>1ã€å¦‚ä¸Šé¢æ€è·¯ä»‹ç»ï¼Œæ–°å»ºå­ç±»å¹¶ç»§æ‰¿<code>TraceProxyRequestHelper</code>ï¼Œå…·ä½“ä¸ºä»€ä¹ˆè¿™ä¹ˆæ”¹å¯ä»¥å‚è§æ³¨é‡Š</p>

<pre><code class="language-java">import com.netflix.zuul.context.RequestContext;
import com.netflix.zuul.util.HTTPRequestUtils;
import lombok.extern.slf4j.Slf4j;
import org.springframework.cloud.netflix.zuul.filters.TraceProxyRequestHelper;
import org.springframework.http.HttpHeaders;
import org.springframework.util.CollectionUtils;
import org.springframework.util.MultiValueMap;
import org.springframework.util.StreamUtils;
import org.springframework.util.StringUtils;

import java.io.ByteArrayInputStream;
import java.io.IOException;
import java.io.InputStream;
import java.io.InputStreamReader;
import java.nio.charset.StandardCharsets;
import java.util.ArrayList;
import java.util.HashMap;
import java.util.List;
import java.util.Map;

import static org.springframework.http.HttpHeaders.CONTENT_ENCODING;
import static org.springframework.http.HttpHeaders.CONTENT_LENGTH;

/**
 * ç»§æ‰¿zuulçš„å®ç°ï¼Œæ·»åŠ è°ƒè¯•æ—¥å¿—
 */
@Slf4j
public class MyTraceProxyRequestHelper extends TraceProxyRequestHelper {

    public static final String REQUEST_TRACE_DATA_KEY = &quot;MyRequestTraceData&quot;;

    public static final String RESPONSE_TRACE_DATA_KEY = &quot;MyResponseTraceData&quot;;

    /**
     * åœ¨è¿™é‡Œä¿å­˜ request çš„ç›¸å…³ä¿¡æ¯ä¾›ä¹‹åå¯¼å‡ºæ¥
     */
    @Override
    public Map&lt;String, Object&gt; debug(String verb, String uri, MultiValueMap&lt;String, String&gt; headers, MultiValueMap&lt;String, String&gt; params, InputStream requestEntity) throws IOException {
        Map&lt;String, Object&gt; result = super.debug(verb, uri, headers, params, requestEntity);
        RequestContext.getCurrentContext().getRequest().setAttribute(REQUEST_TRACE_DATA_KEY, result);
        return result;
    }

    /**
     * åœ¨è¿™é‡Œä¿å­˜ response çš„ç›¸å…³ä¿¡æ¯ä¾›ä¹‹åå¯¼å‡ºæ¥
     * å¤§éƒ¨åˆ†ä»£ç å¤åˆ¶è‡ªçˆ¶ç±»
     */
    @Override
    public void setResponse(int status, InputStream entity, MultiValueMap&lt;String, String&gt; headers) throws IOException {
        RequestContext context = RequestContext.getCurrentContext();
        context.setResponseStatusCode(status);

        // è®°å½•responseæ—¥å¿—
        debugResponse(status, entity, headers);

        HttpHeaders httpHeaders = new HttpHeaders();
        for (Map.Entry&lt;String, List&lt;String&gt;&gt; header : headers.entrySet()) {
            List&lt;String&gt; values = header.getValue();
            for (String value : values) {
                httpHeaders.add(header.getKey(), value);
            }
        }
        boolean isOriginResponseGzipped = false;
        if (httpHeaders.containsKey(CONTENT_ENCODING)) {
            List&lt;String&gt; collection = httpHeaders.get(CONTENT_ENCODING);
            for (String header : collection) {
                if (HTTPRequestUtils.getInstance().isGzipped(header)) {
                    isOriginResponseGzipped = true;
                    break;
                }
            }
        }
        context.setResponseGZipped(isOriginResponseGzipped);

        for (Map.Entry&lt;String, List&lt;String&gt;&gt; header : headers.entrySet()) {
            String name = header.getKey();
            for (String value : header.getValue()) {
                context.addOriginResponseHeader(name, value);
                if (name.equalsIgnoreCase(CONTENT_LENGTH)) {
                    context.setOriginContentLength(value);
                }
                if (isIncludedHeader(name)) {
                    context.addZuulResponseHeader(name, value);
                }
            }
        }
    }

    /**
     * æ–°å¢çš„è¾…åŠ©æ–¹æ³•ï¼Œåªæœ‰jsonç­‰è¿”å›ç±»å‹æ—¶æ‰è®°å½•responseæ—¥å¿—
     * åˆ¤æ–­response content-typeæ˜¯å¦æ˜¯jsonã€xmlç­‰æ­£å¸¸æ¥å£è¿”å›ç±»å‹
     */
    private boolean matchesMimeType(MultiValueMap&lt;String, String&gt; headers) {
        if (CollectionUtils.isEmpty(headers)) {
            return false;
        }
        String contentType = null;
        for (Map.Entry entry : headers.entrySet()) {
            if (entry.getKey().toString().equalsIgnoreCase(HttpHeaders.CONTENT_TYPE)) {
                List list = (ArrayList) entry.getValue();
                contentType = (String) list.get(0);
                break;
            }
        }
        if (StringUtils.isEmpty(contentType)) {
            return false;
        }
        String[] mimeTypes = new String[]{&quot;text/html&quot;, &quot;text/xml&quot;, &quot;application/xml&quot;, &quot;application/json&quot;};
        for (String mimeType : mimeTypes) {
            if (contentType.contains(mimeType)) {
                return true;
            }
        }
        return false;
    }

    /**
     * è¾…åŠ©æ–¹æ³•
     * å®é™…è®°å½•responseè¿”å›æ—¥å¿—
     */
    private void debugResponse(int status, InputStream entity, MultiValueMap&lt;String, String&gt; headers) throws IOException {
        if (entity == null) {
            return;
        }

        // ééœ€è¦è§£æçš„content-typeï¼Œä¸åšå¤„ç†
        RequestContext context = RequestContext.getCurrentContext();
        if (!matchesMimeType(headers)) {
            context.setResponseDataStream(entity);
            return;
        }

        byte[] entityByteArray = StreamUtils.copyToByteArray(entity);
        InputStream wrappedEntity = new ByteArrayInputStream(entityByteArray);

        //è®°å½•response
        char[] buffer = new char[4096];
        int count;
        boolean isSmallBody = true;
        try (InputStreamReader input = new InputStreamReader(wrappedEntity, StandardCharsets.UTF_8)) {
            count = input.read(buffer, 0, buffer.length);
            if (input.read() != -1) {
                isSmallBody = false;
            }
        }
        if (count &gt; 0) {
            String resp = new String(buffer).substring(0, count);
            context.getRequest().setAttribute(RESPONSE_TRACE_DATA_KEY, (isSmallBody ? resp : resp + &quot;&lt;truncated&gt;&quot;));
        }
        wrappedEntity.reset();
        context.setResponseDataStream(wrappedEntity);
    }

}
</code></pre>
<br>
<p>2ã€å¯ç”¨æ–°å»ºå¥½çš„å­ç±»ã€‚æ–°å»ºä¸ªé…ç½®é¡¹ï¼Œå°†è‡ªå®šä¹‰çš„å­ç±»ï¼Œè®¾ç½®ä¸º<code>proxyRequestHelper</code>è¿™ä¸ª<code>bean</code>çš„é»˜è®¤å®ç°(<code>@Primary</code>)</p>

<pre><code class="language-java">import org.springframework.boot.actuate.trace.InMemoryTraceRepository;
import org.springframework.cloud.netflix.zuul.ZuulProxyAutoConfiguration;
import org.springframework.cloud.netflix.zuul.filters.ProxyRequestHelper;
import org.springframework.cloud.netflix.zuul.filters.ZuulProperties;
import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;
import org.springframework.context.annotation.Primary;

@Configuration
public class MyZuulAutoConfiguration extends ZuulProxyAutoConfiguration {
    @Bean
    @Primary
    public ProxyRequestHelper proxyRequestHelper(ZuulProperties zuulProperties) {
        MyTraceProxyRequestHelper helper = new MyTraceProxyRequestHelper();
        helper.setTraces(new InMemoryTraceRepository());
        helper.setIgnoredHeaders(zuulProperties.getIgnoredHeaders());
        helper.setTraceRequestBody(zuulProperties.isTraceRequestBody());
        return helper;
    }
}

</code></pre>
<br>
<p>3ã€è·å–æ—¥å¿—å†…å®¹å¹¶å®é™…å†™å…¥æ—¥å¿—ã€‚è¿™å„¿å¯ä»¥å»ºä¸€ä¸ªspringçš„è¯·æ±‚æ‹¦æˆªå™¨<code>OncePerRequestFilter</code>ï¼Œè®°å½•è¯·æ±‚è€—æ—¶å¹¶åœ¨å¤„ç†å®Œæ¯•åå†™å…¥æ—¥å¿—ã€‚</p>

<pre><code class="language-java">import lombok.extern.slf4j.Slf4j;
import org.apache.commons.lang.StringUtils;
import org.springframework.context.annotation.Configuration;
import org.springframework.web.filter.OncePerRequestFilter;

import javax.servlet.FilterChain;
import javax.servlet.ServletException;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;
import java.io.IOException;
import java.util.LinkedHashMap;
import java.util.Map;

/**
 * æ·»åŠ è°ƒè¯•æ—¥å¿—ä¿¡æ¯
 */
@Configuration
@Slf4j
public class LogFilter extends OncePerRequestFilter {

    public static final String REQUEST_BEGIN_TIME = &quot;REQUEST_BEGIN_TIME&quot;;

    @Override
    protected void doFilterInternal(HttpServletRequest httpServletRequest, HttpServletResponse httpServletResponse, FilterChain filterChain) throws ServletException, IOException {
        httpServletRequest.setAttribute(REQUEST_BEGIN_TIME, System.currentTimeMillis());
        filterChain.doFilter(httpServletRequest, httpServletResponse);
        traceLog(httpServletRequest);
    }

    /**
     * è®°å½•æ—¥å¿—
     */
    private void traceLog(HttpServletRequest request) {
        Long begin = (Long) request.getAttribute(REQUEST_BEGIN_TIME);
        if (begin == null || begin == 0L) {
            begin = System.currentTimeMillis();
        }

        Map&lt;String, Object&gt; logData = new LinkedHashMap&lt;&gt;();
        Map&lt;String, Object&gt; requestMap = (Map&lt;String, Object&gt;) request.getAttribute(REQUEST_TRACE_DATA_KEY);
        logData.put(&quot;url&quot;, request.getRequestURL());
        logData.put(&quot;uri&quot;, request.getRequestURI());
        logData.put(&quot;timeCost&quot;, System.currentTimeMillis() - begin);
        if (requestMap != null) {
            logData.putAll(requestMap);
        }
        logData.put(&quot;responseBody&quot;, StringUtils.abbreviate(String.valueOf(request.getAttribute(RESPONSE_TRACE_DATA_KEY)), 128));

        log.info(&quot;{}&quot;, logData);
    }
}

</code></pre>
<br>
<p><strong>okäº†ï¼Œè‡³æ­¤å¤§åŠŸå‘Šæˆï¼</strong></p>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[iText ç”Ÿåƒ»å­—æ˜¾ç¤ºè®¾ç½®ä¸æ±‰å­—æ•°å­—åŒ–]]></title>
    <link href="https://chenrenyi.github.io/15827936185226.html"/>
    <updated>2020-02-27T16:53:38+08:00</updated>
    <id>https://chenrenyi.github.io/15827936185226.html</id>
    <content type="html"><![CDATA[
<h2 id="toc_0">é—®é¢˜æè¿°</h2>

<p>iText ç”Ÿæˆçš„ pdfï¼Œæ— æ³•æ˜¾ç¤ºæŸäº›ç”Ÿåƒ»å­—ï¼Œæ¯”å¦‚ã€ã™“ã€‘ã€ã€ğ …¤ã€‘ã€‚åœ¨é‡åˆ°ç”Ÿåƒ»å­—æ—¶ä¸ä¼šæ˜¾ç¤ºæˆæ–¹å—ï¼Œè€Œæ˜¯ç›´æ¥ä¸æ˜¾ç¤ºã€‚<br/>
<span id="more"></span><!-- more --></p>

<h2 id="toc_1">åŸæ¥ç”Ÿæˆ pdf çš„è¿‡ç¨‹</h2>

<p>1ã€ç”¨ FreeMarker æ¨¡æ¿å¼•æ“ç”Ÿæˆ htmlï¼Œhtml é‡Œé¢çš„ css æŒ‡å®šäº†å­—ä½“æ–‡ä»¶<br/>
<a href="media/15827936185226/docs.css">docs</a></p>

<pre><code class="language-css">body {font-family: SimSun}
</code></pre>

<p>2ã€æ·»åŠ  SimSun å­—ä½“æ–‡ä»¶</p>

<pre><code class="language-java">new ITextRenderer().getFontResolver().addFont(&quot;SimSun.ttf&quot;)
</code></pre>

<p>3ã€ç”¨ iText æ¡†æ¶å°† html è½¬åŒ–æˆ pdf æ–‡ä»¶</p>

<pre><code class="language-java">renderer.setDocumentFromString(content, storagePath);
</code></pre>

<h2 id="toc_2">åŸå› åˆ†æ</h2>

<p>åŸå› ç®€å•è¯´æ¥ï¼Œå°±æ˜¯ SimSun.ttfï¼ˆä¸­æ˜“å®‹ä½“ï¼Œä¹Ÿæ˜¯ windows ç³»ç»Ÿé»˜è®¤å­—ä½“ï¼‰ä¸­æœªæ”¶å½•æŸäº›ç”Ÿåƒ»å­—ï¼Œæ‰€ä»¥ç”Ÿæˆçš„ pdf ä¸­æ˜¾ç¤ºä¸å‡ºæ¥ã€‚</p>

<p>è‡³äºä¸ºå•¥ä¸æ”¶å½•ä»¥åŠå¯¹åº”çš„è§£å†³åŠæ³•ï¼Œéœ€è¦å…ˆäº†è§£ä¸‹è®¡ç®—æœºæ˜¯å¦‚ä½•æ˜¾ç¤ºæ±‰å­—çš„ã€‚æˆ–è€…ä¹Ÿå¯ä»¥ç›´æ¥è·³è¿‡çœ‹æœ€ç»ˆè§£å†³æ–¹æ¡ˆï¼Œå†å›è¿‡å¤´çœ‹åŸç†ã€‚</p>

<h2 id="toc_3">æ±‰å­—çš„æ•°å­—åŒ–å†å²</h2>

<h3 id="toc_4">æ±‰å­—æœ‰å¤šå°‘ä¸ª</h3>

<p>ç”Ÿæ´»ä¸­çš„æƒ…å†µï¼šæˆ‘å›½ä¹‰åŠ¡æ•™è‚²é˜¶æ®µè¦æ±‚è¯†å­— 3500 ä¸ªå·¦å³ï¼Œ2013 å¹´å›½åŠ¡é™¢å‘å¸ƒçš„ã€Šé€šç”¨è§„èŒƒæ±‰å­—è¡¨ã€‹ï¼Œæ”¶å½•æ±‰å­— 8105 ä¸ªï¼Œåˆ†ä¸ºä¸‰çº§ï¼Œå…¶ä¸­ä¸€çº§å­—ä¸ºå¸¸ç”¨å­—å…± 3500ä¸ªï¼ŒäºŒçº§å­— 3000 ä¸ªï¼Œä¸‰çº§å­— 1605 ä¸ªã€‚</p>

<p>ä¹¦æœ¬ä¸­çš„æƒ…å†µï¼šä¸œæ±‰çš„ã€Šè¯´æ–‡è§£å­—ã€‹æ”¶å­— 9353 ä¸ªï¼Œæ¸…æœã€Šåº·ç†™å­—å…¸ã€‹æ”¶å­— 47,035 ä¸ªï¼Œå½“ä»£çš„ã€Šæ±‰è¯­å¤§å­—å…¸ã€‹ï¼ˆ2010 å¹´ç‰ˆ) æ”¶å­— 60,370 ä¸ªã€‚ 1994 å¹´ä¸­åä¹¦å±€ã€ä¸­å›½å‹è°Šå‡ºç‰ˆå…¬å¸å‡ºç‰ˆçš„ã€Šä¸­åå­—æµ·ã€‹æ”¶å­— 85,568 ä¸ªã€‚</p>

<p>æ®ä¼°ç®—æ€»æ±‰å­—çº¦ 10 ä¸‡ä¸ªï¼Œå…·ä½“æ•°å­—æ— äººæ¸…æ¥šã€‚</p>

<h3 id="toc_5">æŠŠæ±‰å­—æ”¾è¿›è®¡ç®—æœºï¼Œæ±‰å­—ç¼–ç å†å²</h3>

<p>æƒ³ç”¨è®¡ç®—æœºä¼ è¾“å­˜å‚¨æ–‡å­—ï¼Œå¿…ç„¶è¦æœ‰ç¼–ç æ–¹æ¡ˆã€‚ä½†æ±‰å­—å®åœ¨å¤ªå¤šï¼Œæ‰€ä»¥ç¼–ç æ–¹æ¡ˆæ˜¯æ¼”è¿›å‹çš„ï¼ŒåˆæœŸåªæ”¶å½•çš„å­—æ•°å¾ˆå°‘ï¼Œåé¢æ‰æ…¢æ…¢æ‰©å……ã€‚</p>

<h4 id="toc_6">å›½æ ‡ï¼š</h4>

<p>1981 å¹´ï¼šå‘å¸ƒ GB2312â€”1980ï¼Œæ”¶å½•æ±‰å­— 6763 ä¸ªå’Œéæ±‰å­—å›¾å½¢å­—ç¬¦ 682 ä¸ª<br/>
1995 å¹´ï¼šå‘å¸ƒ GBKï¼Œæ”¶å½• 21886 ä¸ªæ±‰å­—å’Œå›¾å½¢ç¬¦å·<br/>
2001 å¹´ï¼šå‘å¸ƒ GB18030ï¼Œå…±æ”¶å½•æ±‰å­— 70,244 ä¸ª</p>

<h4 id="toc_7">unicodeï¼š</h4>

<p>unicode çš„ç›®çš„æ˜¯å›½é™…é€šè¡Œï¼Œè€Œå›½é™…ä¸Šæ±‰å­—ä½¿ç”¨é™¤ä¸­å›½å¤–ï¼Œè¿˜æœ‰æ—¥éŸ©ã€‚å› æ­¤ä¸ºäº†ç»Ÿä¸€æ±‰å­—ç¼–ç ï¼Œæœ‰äº†ä¸­æ—¥éŸ©ç»Ÿä¸€è¡¨æ„æ–‡å­— (å³ CJKï¼Œå„å›½è‹±æ–‡åé¦–å­—æ¯)ã€‚ä¸ºå•¥è¦è®² unicode å‘¢ï¼Œå› ä¸ºç¼–ç¨‹è¯­è¨€å¯¹å®ƒçš„æ”¯æŒå¥½å•Šã€‚</p>

<p>ä»1991å¹´åˆ°2018å¹´ï¼Œå…ˆæ˜¯å‘å¸ƒäº†ç¬¬ä¸€ç‰ˆï¼Œåæ¥é™†ç»­å¢åŠ äº†æ‰©å±•è¡¨ Aã€Bã€Cã€Dã€Eã€FåŒº</p>

<h3 id="toc_8">æŠŠæ±‰å­—æ˜¾ç¤ºå‡ºæ¥ï¼Œå­—ä½“æ–‡ä»¶</h3>

<p>æœ‰äº†ç¼–ç æ–¹æ¡ˆï¼Œè¿˜è¦æœ‰å­—ä½“æ–‡ä»¶ï¼ŒçŸ¥é“å¦‚ä½•æŠŠæ±‰å­—ç”»å‡ºæ¥ã€‚å› ä¸ºæ±‰å­—æ•°é‡å¤ªå¤šï¼Œç¼–ç æ–¹æ¡ˆæ˜¯æ¼”è¿›å‹çš„ï¼Œæ‰€ä»¥å­—ä½“æ–‡ä»¶ä¹Ÿåªæä¾›äº†ä¸€éƒ¨åˆ†æ±‰å­—ã€‚</p>

<p>å¸¸ç”¨å­—ä½“æ–‡ä»¶æ ¼å¼ï¼š<br/>
ttfï¼šæœ€å¸¸ç”¨çš„ï¼Œå¾®è½¯å’Œè‹¹æœåˆæ¨çš„<br/>
ttcï¼šæœ¬è´¨æ˜¯å¤šä¸ªttfçš„é›†åˆ<br/>
otfï¼šæ˜¯ttfçš„å‡çº§ç‰ˆï¼Œæµ‹è¯•å‘ç°iTextæ¡†æ¶è²Œä¼¼ä¸æ”¯æŒ</p>

<p>æˆ‘ä»ç½‘ä¸Šä¸‹è½½çš„è®¸å¤šå·ç§°è¶…å¤§å­—ç¬¦é›†çš„å­—ä½“æ–‡ä»¶ï¼Œé‡Œé¢éƒ½æ˜¯åˆ†ä¸ºå¥½å‡ ä¸ª ttf æ–‡ä»¶çš„ã€‚æœ‰ä¸¤ä¸ªåŸå› ï¼Œä¸€æ˜¯å¸¸ç”¨å­—å·²ç»æœ‰å­—ä½“æ–‡ä»¶äº†ï¼Œå› æ­¤åªéœ€è¦å†æä¾›ä¸€ä»½ç”Ÿåƒ»å­—çš„æ–‡ä»¶å³å¯ã€‚äºŒæ˜¯æœ‰ttfæ ¼å¼æœ‰æ•°é‡ä¸Šé™ï¼Œæ²¡æ³•æ”¾ä¸‹å…¨éƒ¨çš„å­—ã€‚</p>

<h2 id="toc_9">å­—ä½“æ˜¾ç¤ºçš„ fallback æœºåˆ¶</h2>

<p>ä¸Šé¢è§£é‡Šäº†ä¸ºä»€ä¹ˆå•ä¸ªå­—ä½“æ–‡ä»¶æ²¡åŒ…å«æ‰€æœ‰å­—ï¼Œä½†å®é™…ä¸Šçš„æƒ…å†µæ˜¯ï¼Œæœ‰äº›å­—åœ¨ç³»ç»Ÿä¸Šå’Œæµè§ˆå™¨ä¸­èƒ½çœ‹åˆ°ï¼Œæ¯”å¦‚ä¸¾ä¾‹ä¸­çš„ã€ğ …¤ã€‘ï¼Œè€Œ pdf ä¸­å´ä¸æ˜¾ç¤ºå‘¢ï¼Ÿ</p>

<h3 id="toc_10">æ“ä½œç³»ç»Ÿ/æµè§ˆå™¨æ˜¯æ€ä¹ˆå¤„ç†å­—ä½“ç¼ºå¤±çš„ï¼Ÿ</h3>

<p>fallbackï¼Œå³å›é€€æœºåˆ¶ï¼šå¦‚æœæŒ‡å®šç”¨å­—ä½“â€†Aâ€†æ¥æ˜¾ç¤ºæŸå­—ç¬¦â€†xï¼Œä½†è¯¥å­—ä½“å¹¶ä¸æ”¯æŒè¿™ä¸ªå­—ç¬¦ï¼ˆç”šè‡³è¯¥å­—ä½“å½“å‰ä¸å¯ç”¨ï¼‰ï¼Œæ’ç‰ˆå¼•æ“é€šå¸¸ä¸ä¼šç›´æ¥æ”¾å¼ƒï¼Œå®ƒä¼šæ ¹æ®ä¸€ä¸ªé¢„å…ˆè®°å¥½çš„åˆ—è¡¨æ¥å°è¯•å¯»æ‰¾èƒ½æ˜¾ç¤ºå­—ç¬¦â€†xâ€†çš„å­—ä½“ï¼Œå¦‚æœæ‰¾åˆ°å­—ä½“â€†Bâ€†èƒ½è¡Œï¼Œé‚£å°±ç”¨å­—ä½“â€†Bâ€†æ¥æ˜¾ç¤ºå­—ç¬¦â€†xã€‚å­—ä½“â€†Bâ€†å°±æ˜¯å½“å‰è¿™ä¸ªæƒ…å†µçš„ fallbackã€‚</p>

<h3 id="toc_11">ç”Ÿæˆ pdf æ—¶ä¸ºå•¥ä¸æ”¯æŒ fallbackï¼Ÿ</h3>

<p>pdfï¼šä¸»è¦ç”¨äºæ‰“å°å’Œé˜…è¯»ï¼Œè€Œéç¼–è¾‘ã€‚æœ‰ä¸€ä¸ªç‰¹ç‚¹æ˜¯ï¼šå®ƒå¯ä»¥å°†æ–‡å­—ã€å­—å‹ã€æ ¼å¼ã€é¢œè‰²åŠç‹¬ç«‹äºè®¾å¤‡å’Œåˆ†è¾¨ç‡çš„å›¾å½¢å›¾åƒç­‰å°è£…åœ¨ä¸€ä¸ªæ–‡ä»¶ä¸­ï¼Œä¸ªäººç†è§£å°±æ˜¯è·Ÿå›¾ç‰‡ä¸€æ ·ï¼Œå°è£…äº†æ‰€æœ‰çš„æ˜¾ç¤ºæ•ˆæœï¼Œæ‰€ä»¥æ— è®ºåœ¨ä»€ä¹ˆå¹³å°æ‰“å¼€ï¼Œæ’ç‰ˆæ•ˆæœéƒ½æ˜¯ä¸€æ ·çš„ã€‚</p>

<p>æ‰€ä»¥å®ƒæ˜¯ä¸€ä¸ªç‹¬ç«‹çš„ä¸ä¾èµ–äºå¹³å°çš„æ ¼å¼ï¼Œä¸ªäººçŒœæµ‹è¿™ä¹Ÿå°±æ˜¯ä¸ºä»€ä¹ˆå®ƒä¸æ”¯æŒæ“ä½œç³»ç»Ÿçš„fallbackæœºåˆ¶ã€‚</p>

<h2 id="toc_12">è§£å†³æ–¹æ¡ˆ</h2>

<p>çŸ¥é“äº†å•ä¸ªå­—ä½“ä¸åŒ…å«æ‰€æœ‰æ–‡ä»¶ï¼Œpdf ä¹Ÿä¸æ”¯æŒ fallback æœºåˆ¶åï¼Œè§£å†³æ–¹æ¡ˆå¦‚ä¸‹ï¼š</p>

<p>1ã€å¼•å…¥æœ€æ–°ç‰ˆ SimSun.ttfï¼ŒSimSun-extB.ttf ä¸¤ä¸ªæ–‡ä»¶ï¼Œæˆ‘ä» win10 æœ€æ–°ç‰ˆä¸­å¯¼å…¥çš„ï¼Œç»æµ‹è¯•å‰è€…åŒ…å« cjk ä¸æ‰©å±• A åŒºçš„å­—ä½“ï¼Œåè€…åŒ…å«å…¶å®ƒåŒºçš„å­—ä½“ã€‚</p>

<p>2ã€iText æ¡†æ¶æ·»åŠ ä¸Šé¢ä¸¤ä¸ªå­—ä½“ï¼Œå‚è§ 2.2</p>

<p>3ã€html ä¸­æŒ‡å®šé»˜è®¤å­—ä½“ä¸º SimSunï¼Œå‚è§ 2.1</p>

<p>4ã€éå† html å†…å®¹ï¼Œæ‰«æå‡º B åŒºåŠä»¥åçš„å­—ä½“ï¼Œæ‰‹åŠ¨æŒ‡å®šå­—ä½“æ ¼å¼ SimSun-ExtBã€‚ä»£ç å¦‚ä¸‹ï¼š</p>

<pre><code class="language-java">    /**
     * æ‰«æå¾…è½¬åŒ–æˆpdfçš„htmlå†…å®¹ï¼Œä¸ºç”Ÿåƒ»å­—æŒ‡å®šç”Ÿåƒ»å­—ä½“ï¼Œè§£å†³ç”Ÿåƒ»å­—ä¸æ˜¾ç¤ºçš„é—®é¢˜
     */
    private String addFontFamilyForUncommonWords(String string) {
        int[] stringUnicodes = StringUtils.toCodePoints(string);
        StringBuffer resultString = new StringBuffer();

        for (int charUnicode : stringUnicodes) {
            // ä¸­æ˜“å®‹ä½“(simsun)å«æœ‰å¸¸è§„å­—ç¬¦åŠcjkæ‰©å±•è¡¨Açš„å†…å®¹ï¼Œä¸­æ˜“å®‹ä½“æ‰©å±•ç‰ˆ(simsun-extb)æœ‰cjkå…¶å®ƒæ‰©å±•è¡¨åŒºå†…å®¹
            Character.UnicodeBlock ub = Character.UnicodeBlock.of(charUnicode);
            if (ub == Character.UnicodeBlock.CJK_UNIFIED_IDEOGRAPHS_EXTENSION_B
                    || ub == Character.UnicodeBlock.CJK_UNIFIED_IDEOGRAPHS_EXTENSION_C
                    || ub == Character.UnicodeBlock.CJK_UNIFIED_IDEOGRAPHS_EXTENSION_D) {
                resultString.append(&quot;&lt;font style=&#39;font-family: SimSun-ExtB&#39;&gt;&quot;);
                resultString.append(Character.toChars(charUnicode));
                resultString.append(&quot;&lt;/font&gt;&quot;);
            } else {
                resultString.append(Character.toChars(charUnicode));
            }
        }

        return resultString.toString();
    }
</code></pre>

<h2 id="toc_13">å…¶å®ƒæ–¹æ¡ˆ</h2>

<h3 id="toc_14">1ã€æ¢æ¡†æ¶ï¼Œä¸ç”¨ iTextã€‚</h3>

<p>ç½‘ä¸Šæœç´¢å…¶å®ƒ pdf æ¡†æ¶ç»“æœå¾ˆå°‘ï¼Œå› æ­¤æœªä½œå°è¯•</p>

<h3 id="toc_15">2ã€css ä¸­æŒ‡å®šå¤šä¸ªå­—ä½“è§£å†³</h3>

<p>ç»æµ‹è¯•ï¼Œåœ¨ css çš„ font-family ä¸­æŒ‡å®šå¤šä¸ªå­—ä½“ï¼Œç”Ÿæˆ pdf æ—¶åªæŒ‰é¡ºåºä½¿ç”¨ç¬¬ä¸€ä¸ªå­˜åœ¨çš„å­—ä½“ï¼Œå³å¸¸ç”¨å­—ä½“åœ¨å‰åªæ˜¾ç¤ºå¸¸ç”¨å­—ï¼Œç”Ÿåƒ»å­—ä½“åœ¨å‰åªæ˜¾ç¤ºç”Ÿåƒ»å­—ã€‚åŸå› ç›¸å…³çŸ¥è¯†ä¸­æœ‰å†™ï¼Œç”Ÿæˆ pdf æ—¶ä¸æ”¯æŒ fallback æœºåˆ¶ã€‚</p>

<h3 id="toc_16">3ã€é»˜è®¤å­—ä½“æŒ‡å®šä¸ºä¸€ä¸ªè¶…å…¨è¶…å¤§çš„å­—ä½“æ–‡ä»¶</h3>

<p>ç›¸å…³çŸ¥è¯†ä¸­æœ‰ä»‹ç»ï¼Œttf æ ¼å¼æœ‰å­—å½¢ä¸Šé™ï¼Œæ”¶å½•å­—å½¢æƒ³å…¨å¿…é¡»å­˜åœ¨å¤šä¸ªæ–‡ä»¶ã€‚åŒæ—¶ iText ä¸æ”¯æŒ otf æ ¼å¼ï¼Œæ”¯æŒ ttc æ ¼å¼ä½†å¿…é¡»æŒ‡å®šåºå·ï¼Œå³ç”¨ ttc ä¸­åŒ…å«çš„å“ªä¸€ä¸ª ttfï¼Œå› æ­¤ä¸è¡Œã€‚</p>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[ç¬¬ä¸€ç¯‡æ–‡ç« ]]></title>
    <link href="https://chenrenyi.github.io/15818551802185.html"/>
    <updated>2020-02-16T20:13:00+08:00</updated>
    <id>https://chenrenyi.github.io/15818551802185.html</id>
    <content type="html"><![CDATA[
<p>å› æ–°å† è‚ºç‚ç–«æƒ…å‘†åœ¨å®¶é‡Œçš„ç¬¬ 26 å¤©ï¼Œé—²æ¥æ— äº‹ç¬¬ n æ¬¡æ­å»ºåšå®¢ï¼Œå†™ä¸‹åŒæ ·ç¬¬ n æ¬¡çš„å¼€ç¯‡æ–‡ç« ã€‚</p>

<span id="more"></span><!-- more -->

<p>è¿™ä¸€æ¬¡ç”¨çš„ Mwebï¼ˆé¡µè„šæƒé™å£°æ˜é‚£æœ‰å®˜ç½‘é“¾æ¥ï¼‰ï¼ŒMac ä¸Šä¸€ä¸ª Markdown å†™ä½œè½¯ä»¶ï¼Œè‡ªå¸¦é™æ€åšå®¢åˆ›å»ºå’Œå‘å¸ƒåŠŸèƒ½ï¼Œæ”¯æŒè‡ªå®šä¹‰å‘å¸ƒè„šæœ¬ã€‚æ—¥å¸¸åœ¨ç¼–è¾‘å™¨ä¹¦å†™ï¼Œå®Œæˆåä¸€é”®å‘å¸ƒå³å¯ã€‚</p>

<p>å½“ç„¶äº†ï¼Œè¿™è½¯ä»¶æ˜¯æ”¶è´¹çš„ã€‚å›½å†…å¼€å‘è€…ï¼Œåšå¾—æŒºç”¨å¿ƒã€‚æ¯”å¦‚æˆ‘ä¸ªäººå¾ˆå–œæ¬¢çš„ä¸€ä¸ªå°åŠŸèƒ½æ˜¯ï¼Œâ€œåœ¨ä¸­æ–‡å’ŒåŠè§’çš„è‹±æ–‡ã€æ•°å­—ä¹‹é—´æ’å…¥ç©ºæ ¼â€ï¼ŒGithub ä¸Šä¹Ÿæœ‰å¼€æºå®ç°ï¼Œç§°å‘¼è¿™ç§ç©ºæ ¼ä¸ºç›˜å¤ç™½ï¼Œå„ç¼–ç¨‹è¯­è¨€ç‰ˆæœ¬éƒ½æœ‰ã€‚ä¸ Word å’Œæ‰‹æœºå¾®ä¿¡çš„èŠå¤©æ¡†æ˜¾ç¤ºæ•ˆæœç±»ä¼¼ã€‚å…¶å®ä»£ç å®ç°å¹¶ä¸å¤æ‚ï¼Œä½†èƒ½ä»ä¸­ä¸€çª¥ä½œè€…å¯¹æ’ç‰ˆå’Œç”¨æˆ·ä½“éªŒçš„ç»†èŠ‚è¿½æ±‚ã€‚</p>

<p>æœ‰ç¼˜çœ‹åˆ°çš„å…„å¼Ÿå¯ä»¥è¯•è¯•ã€‚å¦‚æœè½¯ä»¶ä½œè€…çœ‹åˆ°äº†ï¼Œè®°å¾—ç»™æˆ‘æ‰“é’±å•ŠğŸ˜†</p>

]]></content>
  </entry>
  
</feed>
