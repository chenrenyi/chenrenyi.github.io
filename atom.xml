<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[ç™½é©¼å±±åº„]]></title>
  <link href="https://chenrenyi.github.io/atom.xml" rel="self"/>
  <link href="https://chenrenyi.github.io/"/>
  <updated>2020-06-08T14:02:27+08:00</updated>
  <id>https://chenrenyi.github.io/</id>
  <author>
    <name><![CDATA[]]></name>
    
  </author>
  <generator uri="http://www.mweb.im">MWeb</generator>

  
  <entry>
    <title type="html"><![CDATA[Zuulç½‘å…³è®°å½•è¯·æ±‚å…¨é“¾è·¯è¯¦ç»†æ—¥å¿—]]></title>
    <link href="https://chenrenyi.github.io/15913291441737.html"/>
    <updated>2020-06-05T11:52:24+08:00</updated>
    <id>https://chenrenyi.github.io/15913291441737.html</id>
    <content type="html"><![CDATA[
<p>å¾®æœåŠ¡æ¶æ„ä¸­ç½‘å…³æ˜¯æ‰€æœ‰å¯¹å¤–æä¾›æœåŠ¡çš„å…¥å£ï¼Œä¸€ä¸ªå¸¸è§çš„éœ€æ±‚æ˜¯å¯¹æ¯ä¸ªè¯·æ±‚è®°å½•è¯¦ç»†æ—¥å¿—ï¼ŒåŒ…æ‹¬urlã€methodã€headerã€request bodyã€response statusã€response bodyç­‰ï¼Œæ–¹ä¾¿é—®é¢˜æ’æŸ¥è€Œä¸ç”¨æ¯ä¸ªå†…éƒ¨æœåŠ¡å†åšä¸€å¥—æ—¥å¿—äº†ã€‚</p>

<p>ä»¥ä¸‹ä¸ºzuulæ¡†æ¶æ­å»ºçš„ç½‘å…³è®°å½•å…¨é“¾è·¯æ—¥å¿—çš„æ–¹æ³•ã€‚</p>

<h3 id="toc_0">æ€è·¯ä»‹ç»</h3>

<p>zuulæœ‰ä¸ªå¤„ç†ä»£ç†è¯·æ±‚å·¥å…·ç±»<code>ProxyRequestHelper</code>ï¼Œç”¨åœ¨å…³é”®çš„è¯·æ±‚è½¬å‘å¤„ç†ä¸Šã€‚å¹¶ä¸”å®˜æ–¹å¸¦ä¸€ä¸ªå­ç±»<code>TraceProxyRequestHelper</code>ï¼Œå…¶ä¸­è®°å½•äº†ä¸å°‘debugä¿¡æ¯å’Œä¸€äº›å…³é”®çš„é’©å­æ–¹æ³•ï¼ŒåŒ…æ‹¬æˆ‘ä»¬éœ€è¦çš„è¯·æ±‚æ•°æ®ã€è½¬å‘æ¨¡å¼ç­‰ã€‚å› æ­¤ç»§æ‰¿è¿™ä¸ªå­ç±»ï¼Œé‡å†™ä¸€äº›æ–¹æ³•å¹¶æŠŠéœ€è¦çš„ä¿¡æ¯ï¼Œå¯¼å‡ºæ¥å­˜æˆæ—¥å¿—å³okã€‚</p>

<h3 id="toc_1">æ­¥éª¤æºç </h3>

<p>1ã€å¦‚ä¸Šé¢æ€è·¯ä»‹ç»ï¼Œæ–°å»ºå­ç±»å¹¶ç»§æ‰¿<code>TraceProxyRequestHelper</code>ï¼Œå…·ä½“ä¸ºä»€ä¹ˆè¿™ä¹ˆæ”¹å¯ä»¥å‚è§æ³¨é‡Š</p>

<pre><code class="language-java">import com.netflix.zuul.context.RequestContext;
import com.netflix.zuul.util.HTTPRequestUtils;
import lombok.extern.slf4j.Slf4j;
import org.springframework.cloud.netflix.zuul.filters.TraceProxyRequestHelper;
import org.springframework.http.HttpHeaders;
import org.springframework.util.CollectionUtils;
import org.springframework.util.MultiValueMap;
import org.springframework.util.StreamUtils;
import org.springframework.util.StringUtils;

import java.io.ByteArrayInputStream;
import java.io.IOException;
import java.io.InputStream;
import java.io.InputStreamReader;
import java.nio.charset.StandardCharsets;
import java.util.ArrayList;
import java.util.HashMap;
import java.util.List;
import java.util.Map;

import static org.springframework.http.HttpHeaders.CONTENT_ENCODING;
import static org.springframework.http.HttpHeaders.CONTENT_LENGTH;

/**
 * ç»§æ‰¿zuulçš„å®ç°ï¼Œæ·»åŠ è°ƒè¯•æ—¥å¿—
 */
@Slf4j
public class MyTraceProxyRequestHelper extends TraceProxyRequestHelper {

    public static final String REQUEST_TRACE_DATA_KEY = &quot;MyRequestTraceData&quot;;

    public static final String RESPONSE_TRACE_DATA_KEY = &quot;MyResponseTraceData&quot;;

    /**
     * åœ¨è¿™é‡Œä¿å­˜ request çš„ç›¸å…³ä¿¡æ¯ä¾›ä¹‹åå¯¼å‡ºæ¥
     */
    @Override
    public Map&lt;String, Object&gt; debug(String verb, String uri, MultiValueMap&lt;String, String&gt; headers, MultiValueMap&lt;String, String&gt; params, InputStream requestEntity) throws IOException {
        Map&lt;String, Object&gt; result = super.debug(verb, uri, headers, params, requestEntity);
        RequestContext.getCurrentContext().getRequest().setAttribute(REQUEST_TRACE_DATA_KEY, result);
        return result;
    }

    /**
     * åœ¨è¿™é‡Œä¿å­˜ response çš„ç›¸å…³ä¿¡æ¯ä¾›ä¹‹åå¯¼å‡ºæ¥
     * å¤§éƒ¨åˆ†ä»£ç å¤åˆ¶è‡ªçˆ¶ç±»
     */
    @Override
    public void setResponse(int status, InputStream entity, MultiValueMap&lt;String, String&gt; headers) throws IOException {
        RequestContext context = RequestContext.getCurrentContext();
        context.setResponseStatusCode(status);

        // è®°å½•responseæ—¥å¿—
        debugResponse(status, entity, headers);

        HttpHeaders httpHeaders = new HttpHeaders();
        for (Map.Entry&lt;String, List&lt;String&gt;&gt; header : headers.entrySet()) {
            List&lt;String&gt; values = header.getValue();
            for (String value : values) {
                httpHeaders.add(header.getKey(), value);
            }
        }
        boolean isOriginResponseGzipped = false;
        if (httpHeaders.containsKey(CONTENT_ENCODING)) {
            List&lt;String&gt; collection = httpHeaders.get(CONTENT_ENCODING);
            for (String header : collection) {
                if (HTTPRequestUtils.getInstance().isGzipped(header)) {
                    isOriginResponseGzipped = true;
                    break;
                }
            }
        }
        context.setResponseGZipped(isOriginResponseGzipped);

        for (Map.Entry&lt;String, List&lt;String&gt;&gt; header : headers.entrySet()) {
            String name = header.getKey();
            for (String value : header.getValue()) {
                context.addOriginResponseHeader(name, value);
                if (name.equalsIgnoreCase(CONTENT_LENGTH)) {
                    context.setOriginContentLength(value);
                }
                if (isIncludedHeader(name)) {
                    context.addZuulResponseHeader(name, value);
                }
            }
        }
    }

    /**
     * æ–°å¢çš„è¾…åŠ©æ–¹æ³•ï¼Œåªæœ‰jsonç­‰è¿”å›ç±»å‹æ—¶æ‰è®°å½•responseæ—¥å¿—
     * åˆ¤æ–­response content-typeæ˜¯å¦æ˜¯jsonã€xmlç­‰æ­£å¸¸æ¥å£è¿”å›ç±»å‹
     */
    private boolean matchesMimeType(MultiValueMap&lt;String, String&gt; headers) {
        if (CollectionUtils.isEmpty(headers)) {
            return false;
        }
        String contentType = null;
        for (Map.Entry entry : headers.entrySet()) {
            if (entry.getKey().toString().equalsIgnoreCase(HttpHeaders.CONTENT_TYPE)) {
                List list = (ArrayList) entry.getValue();
                contentType = (String) list.get(0);
                break;
            }
        }
        if (StringUtils.isEmpty(contentType)) {
            return false;
        }
        String[] mimeTypes = new String[]{&quot;text/html&quot;, &quot;text/xml&quot;, &quot;application/xml&quot;, &quot;application/json&quot;};
        for (String mimeType : mimeTypes) {
            if (contentType.contains(mimeType)) {
                return true;
            }
        }
        return false;
    }

    /**
     * è¾…åŠ©æ–¹æ³•
     * å®é™…è®°å½•responseè¿”å›æ—¥å¿—
     */
    private void debugResponse(int status, InputStream entity, MultiValueMap&lt;String, String&gt; headers) throws IOException {
        if (entity == null) {
            return;
        }

        // ééœ€è¦è§£æçš„content-typeï¼Œä¸åšå¤„ç†
        RequestContext context = RequestContext.getCurrentContext();
        if (!matchesMimeType(headers)) {
            context.setResponseDataStream(entity);
            return;
        }

        byte[] entityByteArray = StreamUtils.copyToByteArray(entity);
        InputStream wrappedEntity = new ByteArrayInputStream(entityByteArray);

        //è®°å½•response
        char[] buffer = new char[4096];
        int count;
        boolean isSmallBody = true;
        try (InputStreamReader input = new InputStreamReader(wrappedEntity, StandardCharsets.UTF_8)) {
            count = input.read(buffer, 0, buffer.length);
            if (input.read() != -1) {
                isSmallBody = false;
            }
        }
        if (count &gt; 0) {
            String resp = new String(buffer).substring(0, count);
            context.getRequest().setAttribute(RESPONSE_TRACE_DATA_KEY, (isSmallBody ? resp : resp + &quot;&lt;truncated&gt;&quot;));
        }
        wrappedEntity.reset();
        context.setResponseDataStream(wrappedEntity);
    }

}
</code></pre>
<br>
<p>2ã€å¯ç”¨æ–°å»ºå¥½çš„å­ç±»ã€‚æ–°å»ºä¸ªé…ç½®é¡¹ï¼Œå°†è‡ªå®šä¹‰çš„å­ç±»ï¼Œè®¾ç½®ä¸º<code>proxyRequestHelper</code>è¿™ä¸ª<code>bean</code>çš„é»˜è®¤å®ç°(<code>@Primary</code>)</p>

<pre><code class="language-java">import org.springframework.boot.actuate.trace.InMemoryTraceRepository;
import org.springframework.cloud.netflix.zuul.ZuulProxyAutoConfiguration;
import org.springframework.cloud.netflix.zuul.filters.ProxyRequestHelper;
import org.springframework.cloud.netflix.zuul.filters.ZuulProperties;
import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;
import org.springframework.context.annotation.Primary;

@Configuration
public class MyZuulAutoConfiguration extends ZuulProxyAutoConfiguration {
    @Bean
    @Primary
    public ProxyRequestHelper proxyRequestHelper(ZuulProperties zuulProperties) {
        MyTraceProxyRequestHelper helper = new MyTraceProxyRequestHelper();
        helper.setTraces(new InMemoryTraceRepository());
        helper.setIgnoredHeaders(zuulProperties.getIgnoredHeaders());
        helper.setTraceRequestBody(zuulProperties.isTraceRequestBody());
        return helper;
    }
}

</code></pre>
<br>
<p>3ã€è·å–æ—¥å¿—å†…å®¹å¹¶å®é™…å†™å…¥æ—¥å¿—ã€‚è¿™å„¿å¯ä»¥å»ºä¸€ä¸ªspringçš„è¯·æ±‚æ‹¦æˆªå™¨<code>OncePerRequestFilter</code>ï¼Œè®°å½•è¯·æ±‚è€—æ—¶å¹¶åœ¨å¤„ç†å®Œæ¯•åå†™å…¥æ—¥å¿—ã€‚</p>

<pre><code class="language-java">import lombok.extern.slf4j.Slf4j;
import org.apache.commons.lang.StringUtils;
import org.springframework.context.annotation.Configuration;
import org.springframework.web.filter.OncePerRequestFilter;

import javax.servlet.FilterChain;
import javax.servlet.ServletException;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;
import java.io.IOException;
import java.util.LinkedHashMap;
import java.util.Map;

/**
 * æ·»åŠ è°ƒè¯•æ—¥å¿—ä¿¡æ¯
 */
@Configuration
@Slf4j
public class LogFilter extends OncePerRequestFilter {

    public static final String REQUEST_BEGIN_TIME = &quot;REQUEST_BEGIN_TIME&quot;;

    @Override
    protected void doFilterInternal(HttpServletRequest httpServletRequest, HttpServletResponse httpServletResponse, FilterChain filterChain) throws ServletException, IOException {
        httpServletRequest.setAttribute(REQUEST_BEGIN_TIME, System.currentTimeMillis());
        filterChain.doFilter(httpServletRequest, httpServletResponse);
        traceLog(httpServletRequest);
    }

    /**
     * è®°å½•æ—¥å¿—
     */
    private void traceLog(HttpServletRequest request) {
        Long begin = (Long) request.getAttribute(REQUEST_BEGIN_TIME);
        if (begin == null || begin == 0L) {
            begin = System.currentTimeMillis();
        }

        Map&lt;String, Object&gt; logData = new LinkedHashMap&lt;&gt;();
        Map&lt;String, Object&gt; requestMap = (Map&lt;String, Object&gt;) request.getAttribute(REQUEST_TRACE_DATA_KEY);
        logData.put(&quot;url&quot;, request.getRequestURL());
        logData.put(&quot;uri&quot;, request.getRequestURI());
        logData.put(&quot;timeCost&quot;, System.currentTimeMillis() - begin);
        if (requestMap != null) {
            logData.putAll(requestMap);
        }
        logData.put(&quot;responseBody&quot;, StringUtils.abbreviate(String.valueOf(request.getAttribute(RESPONSE_TRACE_DATA_KEY)), 128));

        log.info(&quot;{}&quot;, logData);
    }
}

</code></pre>
<br>
<p><strong>okäº†ï¼Œè‡³æ­¤å¤§åŠŸå‘Šæˆï¼</strong></p>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[iText æ˜¾ç¤ºç”Ÿåƒ»å­—ä¸æ±‰å­—æ•°å­—åŒ–å†å²]]></title>
    <link href="https://chenrenyi.github.io/15827936185226.html"/>
    <updated>2020-02-27T16:53:38+08:00</updated>
    <id>https://chenrenyi.github.io/15827936185226.html</id>
    <content type="html"><![CDATA[
<h2 id="toc_0">é—®é¢˜æè¿°</h2>

<p>iText ç”Ÿæˆçš„ pdfï¼Œæ— æ³•æ˜¾ç¤ºæŸäº›ç”Ÿåƒ»å­—ï¼Œæ¯”å¦‚ã€ã™“ã€‘ã€ã€ğ …¤ã€‘ã€‚åœ¨é‡åˆ°ç”Ÿåƒ»å­—æ—¶ä¸ä¼šæ˜¾ç¤ºæˆæ–¹å—ï¼Œè€Œæ˜¯ç›´æ¥ä¸æ˜¾ç¤ºã€‚<br/>
<span id="more"></span><!-- more --></p>

<h2 id="toc_1">åŸæ¥ç”Ÿæˆ pdf çš„è¿‡ç¨‹</h2>

<p>1ã€ç”¨ FreeMarker æ¨¡æ¿å¼•æ“ç”Ÿæˆ htmlï¼Œhtml é‡Œé¢çš„ css æŒ‡å®šäº†å­—ä½“æ–‡ä»¶</p>

<pre><code class="language-css">body {font-family: SimSun}
</code></pre>

<p>2ã€æ·»åŠ  SimSun å­—ä½“æ–‡ä»¶</p>

<pre><code class="language-java">new ITextRenderer().getFontResolver().addFont(&quot;SimSun.ttf&quot;)
</code></pre>

<p>3ã€ç”¨ iText æ¡†æ¶å°† html è½¬åŒ–æˆ pdf æ–‡ä»¶</p>

<pre><code class="language-java">renderer.setDocumentFromString(content, storagePath);
</code></pre>

<h2 id="toc_2">åŸå› åˆ†æ</h2>

<p>åŸå› ç®€å•è¯´æ¥ï¼Œå°±æ˜¯ SimSun.ttfï¼ˆä¸­æ˜“å®‹ä½“ï¼Œä¹Ÿæ˜¯ windows ç³»ç»Ÿé»˜è®¤å­—ä½“ï¼‰ä¸­æœªæ”¶å½•æŸäº›ç”Ÿåƒ»å­—ï¼Œæ‰€ä»¥ç”Ÿæˆçš„ pdf ä¸­æ˜¾ç¤ºä¸å‡ºæ¥ã€‚</p>

<p>è‡³äºä¸ºå•¥ä¸æ”¶å½•ä»¥åŠå¯¹åº”çš„è§£å†³åŠæ³•ï¼Œéœ€è¦å…ˆäº†è§£ä¸‹è®¡ç®—æœºæ˜¯å¦‚ä½•æ˜¾ç¤ºæ±‰å­—çš„ã€‚æˆ–è€…ä¹Ÿå¯ä»¥ç›´æ¥è·³è¿‡çœ‹æœ€ç»ˆè§£å†³æ–¹æ¡ˆï¼Œå†å›è¿‡å¤´çœ‹åŸç†ã€‚</p>

<h2 id="toc_3">æ±‰å­—çš„æ•°å­—åŒ–å†å²</h2>

<h3 id="toc_4">æ±‰å­—æœ‰å¤šå°‘ä¸ª</h3>

<p>ç”Ÿæ´»ä¸­çš„æƒ…å†µï¼šæˆ‘å›½ä¹‰åŠ¡æ•™è‚²é˜¶æ®µè¦æ±‚è¯†å­— 3500 ä¸ªå·¦å³ï¼Œ2013 å¹´å›½åŠ¡é™¢å‘å¸ƒçš„ã€Šé€šç”¨è§„èŒƒæ±‰å­—è¡¨ã€‹ï¼Œæ”¶å½•æ±‰å­— 8105 ä¸ªï¼Œåˆ†ä¸ºä¸‰çº§ï¼Œå…¶ä¸­ä¸€çº§å­—ä¸ºå¸¸ç”¨å­—å…± 3500ä¸ªï¼ŒäºŒçº§å­— 3000 ä¸ªï¼Œä¸‰çº§å­— 1605 ä¸ªã€‚</p>

<p>ä¹¦æœ¬ä¸­çš„æƒ…å†µï¼šä¸œæ±‰çš„ã€Šè¯´æ–‡è§£å­—ã€‹æ”¶å­— 9353 ä¸ªï¼Œæ¸…æœã€Šåº·ç†™å­—å…¸ã€‹æ”¶å­— 47,035 ä¸ªï¼Œå½“ä»£çš„ã€Šæ±‰è¯­å¤§å­—å…¸ã€‹ï¼ˆ2010 å¹´ç‰ˆ) æ”¶å­— 60,370 ä¸ªã€‚ 1994 å¹´ä¸­åä¹¦å±€ã€ä¸­å›½å‹è°Šå‡ºç‰ˆå…¬å¸å‡ºç‰ˆçš„ã€Šä¸­åå­—æµ·ã€‹æ”¶å­— 85,568 ä¸ªã€‚</p>

<p>æ®ä¼°ç®—æ€»æ±‰å­—çº¦ 10 ä¸‡ä¸ªï¼Œå…·ä½“æ•°å­—æ— äººæ¸…æ¥šã€‚</p>

<h3 id="toc_5">æŠŠæ±‰å­—æ”¾è¿›è®¡ç®—æœºï¼Œæ±‰å­—ç¼–ç å†å²</h3>

<p>æƒ³ç”¨è®¡ç®—æœºä¼ è¾“å­˜å‚¨æ–‡å­—ï¼Œå¿…ç„¶è¦æœ‰ç¼–ç æ–¹æ¡ˆã€‚ä½†æ±‰å­—å®åœ¨å¤ªå¤šï¼Œæ‰€ä»¥ç¼–ç æ–¹æ¡ˆæ˜¯æ¼”è¿›å‹çš„ï¼ŒåˆæœŸåªæ”¶å½•çš„å­—æ•°å¾ˆå°‘ï¼Œåé¢æ‰æ…¢æ…¢æ‰©å……ã€‚</p>

<h4 id="toc_6">å›½æ ‡ï¼š</h4>

<p>1981 å¹´ï¼šå‘å¸ƒ GB2312â€”1980ï¼Œæ”¶å½•æ±‰å­— 6763 ä¸ªå’Œéæ±‰å­—å›¾å½¢å­—ç¬¦ 682 ä¸ª<br/>
1995 å¹´ï¼šå‘å¸ƒ GBKï¼Œæ”¶å½• 21886 ä¸ªæ±‰å­—å’Œå›¾å½¢ç¬¦å·<br/>
2001 å¹´ï¼šå‘å¸ƒ GB18030ï¼Œå…±æ”¶å½•æ±‰å­— 70,244 ä¸ª</p>

<h4 id="toc_7">unicodeï¼š</h4>

<p>unicode çš„ç›®çš„æ˜¯å›½é™…é€šè¡Œï¼Œè€Œå›½é™…ä¸Šæ±‰å­—ä½¿ç”¨é™¤ä¸­å›½å¤–ï¼Œè¿˜æœ‰æ—¥éŸ©ã€‚å› æ­¤ä¸ºäº†ç»Ÿä¸€æ±‰å­—ç¼–ç ï¼Œæœ‰äº†ä¸­æ—¥éŸ©ç»Ÿä¸€è¡¨æ„æ–‡å­— (å³ CJKï¼Œå„å›½è‹±æ–‡åé¦–å­—æ¯)ã€‚ä¸ºå•¥è¦è®² unicode å‘¢ï¼Œå› ä¸ºç¼–ç¨‹è¯­è¨€å¯¹å®ƒçš„æ”¯æŒå¥½å•Šã€‚</p>

<p>ä»1991å¹´åˆ°2018å¹´ï¼Œå…ˆæ˜¯å‘å¸ƒäº†ç¬¬ä¸€ç‰ˆï¼Œåæ¥é™†ç»­å¢åŠ äº†æ‰©å±•è¡¨ Aã€Bã€Cã€Dã€Eã€FåŒº</p>

<h3 id="toc_8">æŠŠæ±‰å­—æ˜¾ç¤ºå‡ºæ¥ï¼Œå­—ä½“æ–‡ä»¶</h3>

<p>æœ‰äº†ç¼–ç æ–¹æ¡ˆï¼Œè¿˜è¦æœ‰å­—ä½“æ–‡ä»¶ï¼ŒçŸ¥é“å¦‚ä½•æŠŠæ±‰å­—ç”»å‡ºæ¥ã€‚å› ä¸ºæ±‰å­—æ•°é‡å¤ªå¤šï¼Œç¼–ç æ–¹æ¡ˆæ˜¯æ¼”è¿›å‹çš„ï¼Œæ‰€ä»¥å­—ä½“æ–‡ä»¶ä¹Ÿåªæä¾›äº†ä¸€éƒ¨åˆ†æ±‰å­—ã€‚</p>

<p>å¸¸ç”¨å­—ä½“æ–‡ä»¶æ ¼å¼ï¼š<br/>
ttfï¼šæœ€å¸¸ç”¨çš„ï¼Œå¾®è½¯å’Œè‹¹æœåˆæ¨çš„<br/>
ttcï¼šæœ¬è´¨æ˜¯å¤šä¸ªttfçš„é›†åˆ<br/>
otfï¼šæ˜¯ttfçš„å‡çº§ç‰ˆï¼Œæµ‹è¯•å‘ç°iTextæ¡†æ¶è²Œä¼¼ä¸æ”¯æŒ</p>

<p>æˆ‘ä»ç½‘ä¸Šä¸‹è½½çš„è®¸å¤šå·ç§°è¶…å¤§å­—ç¬¦é›†çš„å­—ä½“æ–‡ä»¶ï¼Œé‡Œé¢éƒ½æ˜¯åˆ†ä¸ºå¥½å‡ ä¸ª ttf æ–‡ä»¶çš„ã€‚æœ‰ä¸¤ä¸ªåŸå› ï¼Œä¸€æ˜¯å¸¸ç”¨å­—å·²ç»æœ‰å­—ä½“æ–‡ä»¶äº†ï¼Œå› æ­¤åªéœ€è¦å†æä¾›ä¸€ä»½ç”Ÿåƒ»å­—çš„æ–‡ä»¶å³å¯ã€‚äºŒæ˜¯æœ‰ttfæ ¼å¼æœ‰æ•°é‡ä¸Šé™ï¼Œæ²¡æ³•æ”¾ä¸‹å…¨éƒ¨çš„å­—ã€‚</p>

<h2 id="toc_9">å­—ä½“æ˜¾ç¤ºçš„ fallback æœºåˆ¶</h2>

<p>ä¸Šé¢è§£é‡Šäº†ä¸ºä»€ä¹ˆå•ä¸ªå­—ä½“æ–‡ä»¶æ²¡åŒ…å«æ‰€æœ‰å­—ï¼Œä½†å®é™…ä¸Šçš„æƒ…å†µæ˜¯ï¼Œæœ‰äº›å­—åœ¨ç³»ç»Ÿä¸Šå’Œæµè§ˆå™¨ä¸­èƒ½çœ‹åˆ°ï¼Œæ¯”å¦‚ä¸¾ä¾‹ä¸­çš„ã€ğ …¤ã€‘ï¼Œè€Œ pdf ä¸­å´ä¸æ˜¾ç¤ºå‘¢ï¼Ÿ</p>

<h3 id="toc_10">æ“ä½œç³»ç»Ÿ/æµè§ˆå™¨æ˜¯æ€ä¹ˆå¤„ç†å­—ä½“ç¼ºå¤±çš„ï¼Ÿ</h3>

<p>fallbackï¼Œå³å›é€€æœºåˆ¶ï¼šå¦‚æœæŒ‡å®šç”¨å­—ä½“â€†Aâ€†æ¥æ˜¾ç¤ºæŸå­—ç¬¦â€†xï¼Œä½†è¯¥å­—ä½“å¹¶ä¸æ”¯æŒè¿™ä¸ªå­—ç¬¦ï¼ˆç”šè‡³è¯¥å­—ä½“å½“å‰ä¸å¯ç”¨ï¼‰ï¼Œæ’ç‰ˆå¼•æ“é€šå¸¸ä¸ä¼šç›´æ¥æ”¾å¼ƒï¼Œå®ƒä¼šæ ¹æ®ä¸€ä¸ªé¢„å…ˆè®°å¥½çš„åˆ—è¡¨æ¥å°è¯•å¯»æ‰¾èƒ½æ˜¾ç¤ºå­—ç¬¦â€†xâ€†çš„å­—ä½“ï¼Œå¦‚æœæ‰¾åˆ°å­—ä½“â€†Bâ€†èƒ½è¡Œï¼Œé‚£å°±ç”¨å­—ä½“â€†Bâ€†æ¥æ˜¾ç¤ºå­—ç¬¦â€†xã€‚å­—ä½“â€†Bâ€†å°±æ˜¯å½“å‰è¿™ä¸ªæƒ…å†µçš„ fallbackã€‚</p>

<h3 id="toc_11">ç”Ÿæˆ pdf æ—¶ä¸ºå•¥ä¸æ”¯æŒ fallbackï¼Ÿ</h3>

<p>pdfï¼šä¸»è¦ç”¨äºæ‰“å°å’Œé˜…è¯»ï¼Œè€Œéç¼–è¾‘ã€‚æœ‰ä¸€ä¸ªç‰¹ç‚¹æ˜¯ï¼šå®ƒå¯ä»¥å°†æ–‡å­—ã€å­—å‹ã€æ ¼å¼ã€é¢œè‰²åŠç‹¬ç«‹äºè®¾å¤‡å’Œåˆ†è¾¨ç‡çš„å›¾å½¢å›¾åƒç­‰å°è£…åœ¨ä¸€ä¸ªæ–‡ä»¶ä¸­ï¼Œä¸ªäººç†è§£å°±æ˜¯è·Ÿå›¾ç‰‡ä¸€æ ·ï¼Œå°è£…äº†æ‰€æœ‰çš„æ˜¾ç¤ºæ•ˆæœï¼Œæ‰€ä»¥æ— è®ºåœ¨ä»€ä¹ˆå¹³å°æ‰“å¼€ï¼Œæ’ç‰ˆæ•ˆæœéƒ½æ˜¯ä¸€æ ·çš„ã€‚</p>

<p>æ‰€ä»¥å®ƒæ˜¯ä¸€ä¸ªç‹¬ç«‹çš„ä¸ä¾èµ–äºå¹³å°çš„æ ¼å¼ï¼Œä¸ªäººçŒœæµ‹è¿™ä¹Ÿå°±æ˜¯ä¸ºä»€ä¹ˆå®ƒä¸æ”¯æŒæ“ä½œç³»ç»Ÿçš„fallbackæœºåˆ¶ã€‚</p>

<h2 id="toc_12">è§£å†³æ–¹æ¡ˆ</h2>

<p>çŸ¥é“äº†å•ä¸ªå­—ä½“ä¸åŒ…å«æ‰€æœ‰æ–‡ä»¶ï¼Œpdf ä¹Ÿä¸æ”¯æŒ fallback æœºåˆ¶åï¼Œè§£å†³æ–¹æ¡ˆå¦‚ä¸‹ï¼š</p>

<p>1ã€å¼•å…¥æœ€æ–°ç‰ˆ SimSun.ttfï¼ŒSimSun-extB.ttf ä¸¤ä¸ªæ–‡ä»¶ï¼Œæˆ‘ä» win10 æœ€æ–°ç‰ˆä¸­å¯¼å…¥çš„ï¼Œç»æµ‹è¯•å‰è€…åŒ…å« cjk ä¸æ‰©å±• A åŒºçš„å­—ä½“ï¼Œåè€…åŒ…å«å…¶å®ƒåŒºçš„å­—ä½“ã€‚</p>

<p>2ã€iText æ¡†æ¶æ·»åŠ ä¸Šé¢ä¸¤ä¸ªå­—ä½“ï¼Œå‚è§ 2.2</p>

<p>3ã€html ä¸­æŒ‡å®šé»˜è®¤å­—ä½“ä¸º SimSunï¼Œå‚è§ 2.1</p>

<p>4ã€éå† html å†…å®¹ï¼Œæ‰«æå‡º B åŒºåŠä»¥åçš„å­—ä½“ï¼Œæ‰‹åŠ¨æŒ‡å®šå­—ä½“æ ¼å¼ SimSun-ExtBã€‚ä»£ç å¦‚ä¸‹ï¼š</p>

<pre><code class="language-java">    /**
     * æ‰«æå¾…è½¬åŒ–æˆpdfçš„htmlå†…å®¹ï¼Œä¸ºç”Ÿåƒ»å­—æŒ‡å®šç”Ÿåƒ»å­—ä½“ï¼Œè§£å†³ç”Ÿåƒ»å­—ä¸æ˜¾ç¤ºçš„é—®é¢˜
     */
    private String addFontFamilyForUncommonWords(String string) {
        int[] stringUnicodes = StringUtils.toCodePoints(string);
        StringBuffer resultString = new StringBuffer();

        for (int charUnicode : stringUnicodes) {
            // ä¸­æ˜“å®‹ä½“(simsun)å«æœ‰å¸¸è§„å­—ç¬¦åŠcjkæ‰©å±•è¡¨Açš„å†…å®¹ï¼Œä¸­æ˜“å®‹ä½“æ‰©å±•ç‰ˆ(simsun-extb)æœ‰cjkå…¶å®ƒæ‰©å±•è¡¨åŒºå†…å®¹
            Character.UnicodeBlock ub = Character.UnicodeBlock.of(charUnicode);
            if (ub == Character.UnicodeBlock.CJK_UNIFIED_IDEOGRAPHS_EXTENSION_B
                    || ub == Character.UnicodeBlock.CJK_UNIFIED_IDEOGRAPHS_EXTENSION_C
                    || ub == Character.UnicodeBlock.CJK_UNIFIED_IDEOGRAPHS_EXTENSION_D) {
                resultString.append(&quot;&lt;font style=&#39;font-family: SimSun-ExtB&#39;&gt;&quot;);
                resultString.append(Character.toChars(charUnicode));
                resultString.append(&quot;&lt;/font&gt;&quot;);
            } else {
                resultString.append(Character.toChars(charUnicode));
            }
        }

        return resultString.toString();
    }
</code></pre>

<h2 id="toc_13">å…¶å®ƒæ–¹æ¡ˆ</h2>

<h3 id="toc_14">1ã€æ¢æ¡†æ¶ï¼Œä¸ç”¨ iTextã€‚</h3>

<p>ç½‘ä¸Šæœç´¢å…¶å®ƒ pdf æ¡†æ¶ç»“æœå¾ˆå°‘ï¼Œå› æ­¤æœªä½œå°è¯•</p>

<h3 id="toc_15">2ã€css ä¸­æŒ‡å®šå¤šä¸ªå­—ä½“è§£å†³</h3>

<p>ç»æµ‹è¯•ï¼Œåœ¨ css çš„ font-family ä¸­æŒ‡å®šå¤šä¸ªå­—ä½“ï¼Œç”Ÿæˆ pdf æ—¶åªæŒ‰é¡ºåºä½¿ç”¨ç¬¬ä¸€ä¸ªå­˜åœ¨çš„å­—ä½“ï¼Œå³å¸¸ç”¨å­—ä½“åœ¨å‰åªæ˜¾ç¤ºå¸¸ç”¨å­—ï¼Œç”Ÿåƒ»å­—ä½“åœ¨å‰åªæ˜¾ç¤ºç”Ÿåƒ»å­—ã€‚åŸå› ç›¸å…³çŸ¥è¯†ä¸­æœ‰å†™ï¼Œç”Ÿæˆ pdf æ—¶ä¸æ”¯æŒ fallback æœºåˆ¶ã€‚</p>

<h3 id="toc_16">3ã€é»˜è®¤å­—ä½“æŒ‡å®šä¸ºä¸€ä¸ªè¶…å…¨è¶…å¤§çš„å­—ä½“æ–‡ä»¶</h3>

<p>ç›¸å…³çŸ¥è¯†ä¸­æœ‰ä»‹ç»ï¼Œttf æ ¼å¼æœ‰å­—å½¢ä¸Šé™ï¼Œæ”¶å½•å­—å½¢æƒ³å…¨å¿…é¡»å­˜åœ¨å¤šä¸ªæ–‡ä»¶ã€‚åŒæ—¶ iText ä¸æ”¯æŒ otf æ ¼å¼ï¼Œæ”¯æŒ ttc æ ¼å¼ä½†å¿…é¡»æŒ‡å®šåºå·ï¼Œå³ç”¨ ttc ä¸­åŒ…å«çš„å“ªä¸€ä¸ª ttfï¼Œå› æ­¤ä¸è¡Œã€‚</p>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[ç¬¬ä¸€ç¯‡æ–‡ç« ]]></title>
    <link href="https://chenrenyi.github.io/15818551802185.html"/>
    <updated>2020-02-16T20:13:00+08:00</updated>
    <id>https://chenrenyi.github.io/15818551802185.html</id>
    <content type="html"><![CDATA[
<p>å› æ–°å† è‚ºç‚ç–«æƒ…å‘†åœ¨å®¶é‡Œçš„ç¬¬ 26 å¤©ï¼Œé—²æ¥æ— äº‹ç¬¬ n æ¬¡æ­å»ºåšå®¢ï¼Œå†™ä¸‹åŒæ ·ç¬¬ n æ¬¡çš„å¼€ç¯‡æ–‡ç« ã€‚</p>

<span id="more"></span><!-- more -->

<p>è¿™ä¸€æ¬¡ç”¨çš„ Mwebï¼ˆé¡µè„šæƒé™å£°æ˜é‚£æœ‰å®˜ç½‘é“¾æ¥ï¼‰ï¼ŒMac ä¸Šä¸€ä¸ª Markdown å†™ä½œè½¯ä»¶ï¼Œè‡ªå¸¦é™æ€åšå®¢åˆ›å»ºå’Œå‘å¸ƒåŠŸèƒ½ï¼Œæ”¯æŒè‡ªå®šä¹‰å‘å¸ƒè„šæœ¬ã€‚æ—¥å¸¸åœ¨ç¼–è¾‘å™¨ä¹¦å†™ï¼Œå®Œæˆåä¸€é”®å‘å¸ƒå³å¯ã€‚</p>

<p>å½“ç„¶äº†ï¼Œè¿™è½¯ä»¶æ˜¯æ”¶è´¹çš„ã€‚å›½å†…å¼€å‘è€…ï¼Œåšå¾—æŒºç”¨å¿ƒã€‚æ¯”å¦‚æˆ‘ä¸ªäººå¾ˆå–œæ¬¢çš„ä¸€ä¸ªå°åŠŸèƒ½æ˜¯ï¼Œâ€œåœ¨ä¸­æ–‡å’ŒåŠè§’çš„è‹±æ–‡ã€æ•°å­—ä¹‹é—´æ’å…¥ç©ºæ ¼â€ï¼ŒGithub ä¸Šä¹Ÿæœ‰å¼€æºå®ç°ï¼Œç§°å‘¼è¿™ç§ç©ºæ ¼ä¸ºç›˜å¤ç™½ï¼Œå„ç¼–ç¨‹è¯­è¨€ç‰ˆæœ¬éƒ½æœ‰ã€‚ä¸ Word å’Œæ‰‹æœºå¾®ä¿¡çš„èŠå¤©æ¡†æ˜¾ç¤ºæ•ˆæœç±»ä¼¼ã€‚å…¶å®ä»£ç å®ç°å¹¶ä¸å¤æ‚ï¼Œä½†èƒ½ä»ä¸­ä¸€çª¥ä½œè€…å¯¹æ’ç‰ˆå’Œç”¨æˆ·ä½“éªŒçš„ç»†èŠ‚è¿½æ±‚ã€‚</p>

<p>æœ‰ç¼˜çœ‹åˆ°çš„å…„å¼Ÿå¯ä»¥è¯•è¯•ã€‚å¦‚æœè½¯ä»¶ä½œè€…çœ‹åˆ°äº†ï¼Œè®°å¾—ç»™æˆ‘æ‰“é’±å•ŠğŸ˜†</p>

]]></content>
  </entry>
  
</feed>
